<?php
 namespace app\mp\service; use app\Defs; use app\index\model\Customer; use think\Db; use think\Cookie; class Users extends Bases { public function getUserById($id) { goto Zzeqh; z7DHU: $user = ["\156\151\x63\153\156\141\155\145" => '', "\150\x65\x61\x64\151\x6d\x67\137\165\x72\x6c" => '', "\162\x65\x61\x6c\137\156\141\x6d\145" => '', "\x61\x67\x65" => '', "\x6f\x72\x67\141\x6e\x69\x7a\141\164\x69\157\156\137\x69\x64" => 0, "\x70\162\x6f\146\145\163\163\151\x6f\156" => '', "\143\157\x6d\x70\141\156\x79" => '', "\x6a\157\x62" => '', "\x77\157\162\153\x5f\141\x67\145" => '', "\144\151\163\x65\x61\x73\145" => '', "\x69\x64\x63\x61\x72\x64" => '', "\x73\145\170" => 1, "\x63\x68\141\156\156\x65\154\137\x69\x64" => Defs::CHANNEL_WX]; goto UzBwR; Vt0jm: if (!empty($user)) { goto H1oqK; } goto z7DHU; Zzeqh: $user = Db::table("\x63\165\x73\x74\x6f\155\145\x72")->where(["\x69\x64" => $id])->field(true)->find(); goto Vt0jm; UzBwR: H1oqK: goto t_HPq; t_HPq: return $user; goto yoQjn; yoQjn: } public function getUserByOpenid($openid) { goto u06yD; kniY5: return []; goto mroUj; eG4MI: return $this->getUserById($uid); goto anZqJ; u06yD: $uid = Db::table("\x63\165\163\164\x6f\x6d\145\162")->where(["\x6f\160\145\156\151\x64" => $openid])->value("\151\144"); goto Pv7eZ; mroUj: CUhRg: goto eG4MI; Pv7eZ: if (!empty($uid)) { goto CUhRg; } goto kniY5; anZqJ: } public function setLoginSession($user) { session("\165\163\x65\x72", ["\151\144" => $user["\x69\144"], "\157\x70\x65\x6e\151\x64" => $user["\157\x70\145\x6e\x69\144"], "\x6e\151\143\153\156\x61\x6d\145" => $user["\x6e\151\143\153\156\141\x6d\x65"], "\150\145\141\144\151\155\147\x5f\165\x72\x6c" => $user["\x68\145\141\x64\x69\155\147\137\x75\162\154"]]); } public function saveUserFromWx($wx_user) { goto h3vEe; d2icp: return $user; goto Q3jn_; dOmr7: if (!empty($data["\151\144"])) { goto T0BIH; } goto rvd5Z; dSa_t: $data["\x69\144"] = Db::table("\x63\165\x73\164\x6f\155\x65\x72")->insertGetId($data); goto dOmr7; nKCFJ: if (!$user) { goto Wm2Ti; } goto pZq2P; Q3jn_: Wm2Ti: goto jpdf7; pZq2P: Db::table("\143\165\x73\164\x6f\155\x65\x72")->where("\157\160\x65\156\x69\x64", $wx_user["\x6f\x70\145\156\x69\x64"])->update(["\x6e\151\143\153\x6e\141\155\x65" => $wx_user["\156\151\143\x6b\x6e\141\x6d\x65"], "\150\x65\x61\144\151\x6d\147\137\165\162\154" => $wx_user["\x68\x65\x61\144\x69\x6d\147\165\162\x6c"], "\x63\x69\164\171" => $wx_user["\x63\151\164\171"], "\160\x72\x6f\x76\x69\156\143\145" => $wx_user["\160\162\157\x76\151\x6e\143\x65"], "\x63\x6f\165\156\x74\x72\171" => $wx_user["\x63\x6f\x75\156\x74\x72\x79"], "\163\x65\170" => $wx_user["\163\145\x78"], "\x6c\141\164\x65\x73\x74\137\154\x6f\x67\151\156\x5f\164\x69\x6d\145" => Db::raw("\x6e\157\167\x28\x29")]); goto d2icp; DOMin: l7q0v: goto ZNpkp; mFQU2: exception("\350\x8e\xb7\345\217\x96\345\xbe\xae\xe4\xbf\241\xe6\216\210\346\235\203\347\x94\xa8\xe6\x88\xb7\344\277\241\xe6\x81\xaf\xe5\244\261\xe8\xb4\xa5"); goto DOMin; jpdf7: $data = ["\157\160\x65\156\151\144" => $wx_user["\x6f\x70\x65\156\x69\144"], "\x6e\x69\x63\x6b\x6e\141\x6d\x65" => $wx_user["\156\151\x63\153\x6e\141\155\145"], "\150\145\x61\144\x69\x6d\147\x5f\165\x72\154" => $wx_user["\x68\x65\141\144\x69\155\x67\165\x72\x6c"], "\143\151\x74\x79" => $wx_user["\x63\x69\164\x79"], "\160\162\x6f\166\x69\x6e\x63\x65" => $wx_user["\160\x72\157\166\151\x6e\x63\x65"], "\143\x6f\x75\156\x74\x72\x79" => $wx_user["\x63\x6f\165\156\x74\162\171"], "\x73\x65\170" => $wx_user["\163\x65\x78"], "\162\145\x67\x69\163\164\145\162\x5f\x74\151\x6d\x65" => Db::raw("\156\157\x77\50\x29"), "\154\x61\164\x65\x73\164\137\154\x6f\x67\x69\x6e\x5f\164\x69\155\145" => Db::raw("\x6e\x6f\x77\50\x29")]; goto dSa_t; ZNpkp: $user = $this->getUserByOpenid($wx_user["\157\x70\x65\156\151\x64"]); goto nKCFJ; MC3az: T0BIH: goto qjH3Z; h3vEe: if (!empty($wx_user["\x6f\x70\x65\x6e\151\x64"])) { goto l7q0v; } goto mFQU2; rvd5Z: exception("\xe5\210\x9b\345\xbb\xba\347\x94\xa8\346\x88\267\xe5\xa4\261\350\264\245\357\xbc\x9a" . $data["\157\160\x65\x6e\x69\144"]); goto MC3az; qjH3Z: return $data; goto NIfjV; NIfjV: } }
