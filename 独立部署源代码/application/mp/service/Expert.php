<?php
 namespace app\mp\service; use app\Defs; use think\Db; use think\Log; use EasyWeChat\Factory; use app\index\logic\Defs as IndexDefs; use app\index\logic\Subject as SubjectLogic; use app\mp\service\RequestContext; use app\common\service\Redis as RedisService; use app\mp\controller\Wx; use app\index\logic\Expert as ExpertLogic; use app\index\logic\Sms as SmsLogic; use app\index\logic\AppointOrder as AppointOrderLogic; use app\index\service\EventLogs as EventLogsService; class Expert extends Bases { public function loadExperts($categoryId, $name, $page, $rows) { goto kKat_; mBaCI: $records = Db::table("\x65\x78\x70\145\x72\164")->alias("\105")->join("\x65\x78\x70\145\x72\164\137\x63\141\164\145\x67\157\x72\171\137\162\145\154\x61\x74\x65\40\105\103\x52", "\105\56\x69\x64\x3d\105\x43\122\x2e\x65\170\160\145\x72\x74\x5f\x69\x64")->where($conditions)->page($page, $rows)->field("\151\144\54\x20\x77\157\162\153\151\155\147\x5f\x75\x72\154\x2c\40\162\x65\141\x6c\137\x6e\x61\x6d\145\54\40\x65\x78\x70\145\x72\164\x5f\161\165\x61\x6c\151\x74\171\54\x20\141\x70\x70\157\151\156\x74\x5f\146\x65\145\x2c\x20\143\x6f\156\x73\x75\154\164\x5f\161\165\x61\x6e\x74\x69\x74\x79")->select(); goto GQNwr; LGeRr: $total = Db::table("\145\x78\x70\145\162\164")->alias("\105")->join("\x65\x78\x70\145\x72\164\x5f\x63\x61\x74\145\x67\157\x72\171\x5f\162\x65\x6c\x61\164\x65\40\105\x43\x52", "\105\56\151\144\75\105\103\122\x2e\145\170\x70\x65\x72\164\x5f\151\144")->where($conditions)->count(); goto mBaCI; kKat_: $conditions = ["\105\x2e\144\x65\x6c\145\164\x65\137\146\154\141\x67" => 0, "\105\x2e\x73\164\141\164\x75\x73" => IndexDefs::ENTITY_PUBLISH_STATUS]; goto io4Sv; hDc9d: $conditions["\105\x43\x52\56\143\x61\x74\x65\x67\x6f\162\x79\x5f\x69\144"] = $categoryId; goto LGeRr; f4tl8: $total = Db::table("\145\170\160\145\x72\x74")->alias("\x45")->where($conditions)->count(); goto Quwx1; Quwx1: $records = Db::table("\145\x78\x70\145\x72\164")->alias("\105")->where($conditions)->page($page, $rows)->field(true)->select(); goto KbZ6w; fMwRH: Dj5bo: goto uN_5u; GQNwr: yuxhZ: goto pQ3aY; yHvOV: if ($categoryId) { goto Mrr_b; } goto f4tl8; io4Sv: if (!$name) { goto Rqii5; } goto Jj3J3; pQ3aY: foreach ($records as &$record) { goto GF9XU; MYcrM: $fieldNames = Db::table("\x65\170\160\x65\x72\x74\x5f\146\x69\x65\x6c\144\137\162\145\154\141\164\145")->alias("\105\106\122")->join("\x65\x78\160\x65\x72\164\137\x66\151\x65\x6c\144\137\x69\x74\145\x6d\x20\105\x46\111", "\105\x46\x52\56\146\x69\145\x6c\144\137\151\164\x65\155\137\151\144\x3d\105\x46\111\56\x69\x64")->where(["\x45\106\x52\x2e\x65\170\x70\x65\x72\164\137\x69\144" => $record["\151\144"]])->column("\x45\106\x49\x2e\146\151\x65\154\144\x5f\151\x74\x65\x6d"); goto L0pQ1; en0NQ: $record["\167\x6f\x72\153\151\155\x67\x5f\165\162\x6c"] = generateThumbnailUrl($record["\x77\x6f\x72\153\x69\x6d\147\x5f\x75\x72\x6c"], 300); goto owYPi; owYPi: SLsv6: goto pziox; r_FiE: $record["\164\x61\162\147\145\x74\x5f\156\x61\x6d\x65\x73"] = $targetNames; goto MYcrM; L0pQ1: $record["\x66\x69\x65\x6c\x64\137\x6e\141\x6d\145\x73"] = $fieldNames; goto yHpwI; yHpwI: $record["\145\170\160\x65\162\164\137\x71\165\x61\x6c\151\x74\x79"] = nl2br($record["\145\170\160\145\162\x74\x5f\x71\165\141\x6c\151\164\171"]); goto en0NQ; GF9XU: $targetNames = Db::table("\145\x78\x70\x65\x72\x74\x5f\x74\141\162\x67\x65\164\137\162\x65\x6c\x61\164\x65")->alias("\x45\x54\x52")->join("\145\170\x70\x65\x72\x74\137\164\x61\x72\147\x65\x74\x20\105\124", "\x45\x54\122\56\x74\x61\162\147\145\164\x5f\x69\144\x3d\105\124\x2e\x69\144")->where(["\105\124\x52\x2e\x65\x78\160\x65\162\164\x5f\x69\144" => $record["\x69\144"]])->column("\105\x54\56\x74\x61\162\x67\x65\x74"); goto r_FiE; pziox: } goto fMwRH; uN_5u: $totalReturn = ($page - 1) * $rows + count($records); goto WXFWZ; jG9lm: Rqii5: goto yHvOV; KbZ6w: goto yuxhZ; goto HrwFb; Jj3J3: $conditions["\105\56\x72\145\x61\154\137\156\141\x6d\145"] = ["\x6c\151\x6b\145", "\45" . $name . "\x25"]; goto jG9lm; HrwFb: Mrr_b: goto hDc9d; WXFWZ: return ["\162\157\167\163" => $records, "\x70\x61\x67\145\x5f\145\156\x64" => $totalReturn >= $total]; goto Be4WJ; Be4WJ: } public function getExpert($expertId) { goto B9uu3; YGxBN: $years = date_diff(date_create(date("\131\x2d\x6d\x2d\144")), date_create($record["\x66\151\x72\x73\x74\x5f\152\157\x62\137\164\x69\155\145"]))->days / 365; goto nQRg6; JhaPF: wexception("\xe4\270\x93\345\xae\xb6\xe6\234\252\xe5\217\x91\xe5\270\x83"); goto P9slM; jjftK: if ($record) { goto E_tum; } goto si5SO; lTVJR: g7vsV: goto RmXyM; vmCbw: goto g7vsV; goto w0vd4; nQRg6: $record["\x6a\157\142\x5f\171\145\x61\162\x73"] = floor($years); goto lTVJR; JP3pc: $record["\164\x61\162\147\145\x74\x73"] = array_slice($record["\164\141\162\x67\145\164\x73\x5f\141\x6c\x6c"], 0, 3); goto CViuY; P9slM: mRO9K: goto K2J2p; w0vd4: ARP8p: goto YGxBN; f9oGQ: wexception("\344\270\223\xe5\xae\266\345\267\xb2\344\xb8\xad\xe6\255\xa2"); goto xtu06; K2J2p: if (!($record["\x73\164\141\164\165\x73"] == IndexDefs::ENTITY_END_STATUS)) { goto H_M5P; } goto f9oGQ; NgL3o: $record["\164\x61\x72\147\x65\x74\163\137\141\x6c\x6c"] = Db::table("\x65\170\160\145\x72\x74\137\x74\141\162\x67\145\x74\137\162\145\x6c\141\164\x65")->alias("\x45\124\x52")->join("\x65\x78\160\x65\162\x74\137\164\x61\x72\x67\x65\164\40\105\x54", "\105\124\x52\56\164\x61\x72\x67\145\x74\137\x69\x64\x3d\105\124\56\x69\x64")->where(["\x45\124\122\56\145\170\x70\x65\162\x74\137\151\144" => $expertId])->column("\x45\x54\56\x74\x61\162\x67\x65\x74"); goto JP3pc; mEP70: $record["\x66\x69\145\x6c\144\137\151\164\x65\155\x73"] = array_slice($record["\146\x69\x65\154\x64\137\x69\164\x65\x6d\163\x5f\x61\x6c\154"], 0); goto NgL3o; B9uu3: $record = Db::table("\145\x78\x70\145\x72\164")->where(["\x69\144" => $expertId, "\144\x65\x6c\145\164\x65\137\x66\154\141\x67" => 0])->field(true)->find(); goto jjftK; CViuY: if ($record["\146\x69\x72\163\x74\x5f\x6a\x6f\142\x5f\x74\x69\155\145"]) { goto ARP8p; } goto EO30H; xtu06: H_M5P: goto Ow4_i; si5SO: wexception("\xe4\270\223\345\xae\266\xe4\xb8\x8d\345\xad\x98\xe5\234\250"); goto GJ2T_; EO30H: $record["\152\157\x62\137\171\145\141\x72\x73"] = ''; goto vmCbw; o1IcJ: if (!($record["\163\x74\x61\x74\165\163"] == IndexDefs::ENTITY_DRAFT_STATUS)) { goto mRO9K; } goto JhaPF; GJ2T_: E_tum: goto o1IcJ; RmXyM: return $record; goto z8q_I; Ow4_i: $record["\x66\x69\145\154\144\x5f\x69\x74\x65\x6d\x73\x5f\x61\154\x6c"] = Db::table("\145\x78\x70\x65\162\164\x5f\x66\151\x65\154\x64\137\162\x65\x6c\x61\164\145")->alias("\x45\x46\x52")->join("\x65\170\x70\145\x72\164\x5f\x66\151\x65\154\144\x5f\151\x74\145\155\x20\105\x46\111", "\x45\x46\x49\x2e\151\144\x3d\x45\106\122\x2e\x66\x69\x65\154\144\137\x69\164\x65\155\137\x69\144")->where(["\x45\106\122\56\145\170\x70\x65\162\x74\x5f\x69\144" => $expertId])->column("\x45\106\x49\x2e\146\x69\x65\x6c\x64\137\151\164\x65\155"); goto mEP70; z8q_I: } public function getAvailableAppointTime($expertId) { goto BIYcE; ZFiaC: goto rHOqg; goto PqZpJ; v4e55: $nowDay = date("\x59\55\155\55\144", strtotime($nowDay . "\x20\53\x31\40\144\141\171")); goto mBLwT; hjaXN: $available = $available45AppointTimes || $available15AppointTimes ? true : false; goto t7n3Y; ToEka: $available15AppointTimes = array_values(array_diff($appointTimes15, $appointedTimes15)); goto hjaXN; T5FQY: $i = 0; goto h7HlF; PqZpJ: NQY5x: goto XkwzL; H7sHG: $available45AppointTimes = array_values(array_diff($appointTimes45, $appointedTimes45)); goto ToEka; Yyiqz: foreach ($appointTimes as $appointTime) { goto lBnK6; AC1W5: ESPmy: goto j1Ug6; T7SJh: UK7gg: goto AC1W5; Rbh4a: if (count($intervals) == 1) { goto ibqDx; } goto yB0hD; OHKQy: $appointTimes15[] = $appointTime; goto T7SJh; lBnK6: $intervals = explode("\x2c", $appointTime); goto Rbh4a; xtPMr: gCALi: goto jXHzf; yB0hD: if (!(count($intervals) == 3)) { goto gCALi; } goto OACr1; jXHzf: goto UK7gg; goto gP342; gP342: ibqDx: goto OHKQy; OACr1: $appointTimes45[] = $appointTime; goto xtPMr; j1Ug6: } goto SRvu6; fs5MM: $appointedTimes45 = Db::table("\x65\x78\x70\145\162\164\137\x6f\162\x64\x65\162")->where(["\x65\170\160\x65\x72\x74\x5f\x69\x64" => $expertId, "\141\x70\x70\x6f\x69\x6e\x74\x5f\x64\141\x74\x65" => $nowDay, "\x61\160\160\157\x69\x6e\164\137\x64\165\162\141\164\x69\157\156" => 45, "\x73\164\141\164\x75\x73" => ["\156\145\161", IndexDefs::ORDER_CANCELLED_STATUS]])->order("\141\x70\x70\x6f\151\156\164\137\164\151\155\x65\x20\x61\163\x63")->column("\141\160\x70\157\151\x6e\x74\x5f\x74\151\155\145"); goto Mw2jy; BIYcE: $weekDayList = []; goto I255x; qQDkd: $nowDay = date("\x59\x2d\155\55\x64", strtotime($nowDay . "\40\x2b{$appoint_order_ahead_of_days}\40\144\x61\x79\163")); goto T5FQY; jBwNE: $weekDayList[] = ["\x77\145\x65\153\104\x61\171" => $weekDay, "\141\166\x61\151\x6c\x61\142\154\x65" => $available, "\x64\x61\164\x65" => $nowDay, "\x6c\141\x62\145\154" => sprintf("\x25\163\40\174\40\x25\163", getWeekdayText($weekDay), date("\x6d\x2d\x64", strtotime($nowDay))), "\141\166\x61\x69\154\141\142\154\145\x34\65\x41\160\x70\x6f\x69\156\x74\124\151\155\x65\163" => $available45AppointTimes, "\141\x76\x61\x69\x6c\x61\x62\154\x65\61\65\101\160\160\x6f\151\156\164\x54\151\x6d\x65\163" => $available15AppointTimes]; goto qfyil; K1z3l: $weekDay = date("\x77", strtotime($nowDay)); goto c3MhS; h7HlF: rHOqg: goto gb5HN; t7n3Y: if (!$available) { goto VzU43; } goto jBwNE; mBLwT: $i++; goto ZFiaC; cF6t3: $appointTimes15 = []; goto Yyiqz; Mw2jy: $appointedTimes15 = Db::table("\x65\x78\x70\145\162\164\137\x6f\x72\x64\x65\x72")->where(["\145\170\160\x65\162\164\137\151\x64" => $expertId, "\141\x70\160\x6f\x69\156\164\x5f\x64\x61\x74\x65" => $nowDay, "\x61\160\160\x6f\151\x6e\x74\137\144\165\x72\141\x74\151\x6f\x6e" => 15, "\x73\164\141\x74\x75\x73" => ["\x6e\145\x71", IndexDefs::ORDER_CANCELLED_STATUS]])->order("\141\x70\160\157\x69\156\164\x5f\164\x69\155\145\40\x61\x73\143")->column("\141\x70\160\157\x69\x6e\164\137\x74\x69\155\145"); goto H7sHG; I255x: $nowDay = date("\x59\55\x6d\55\144"); goto RYPX1; SRvu6: j3EFJ: goto fs5MM; c3MhS: $appointTimes = Db::table("\x65\x78\160\145\162\x74\x5f\x61\160\x70\x6f\x69\x6e\164\x5f\164\x69\x6d\x65")->where(["\x65\170\160\x65\162\x74\137\151\144" => $expertId, "\167\145\x65\153\x5f\x64\x61\171" => $weekDay])->order("\x61\160\x70\157\x69\156\x74\137\x74\x69\155\145\40\141\x73\143")->column("\141\160\x70\157\x69\x6e\164\x5f\164\151\x6d\145"); goto bORaU; bORaU: $appointTimes45 = []; goto cF6t3; XkwzL: return $weekDayList; goto xrYQD; RYPX1: $appoint_order_ahead_of_days = systemSetting("\141\160\160\x6f\151\x6e\164\x5f\x6f\x72\144\x65\x72\x5f\141\150\x65\141\x64\x5f\157\146\137\144\x61\x79\x73"); goto i1km7; i1km7: $appoint_order_allow_days = systemSetting("\x61\160\x70\157\x69\156\164\137\157\x72\x64\145\x72\x5f\x61\x6c\x6c\x6f\x77\x5f\x64\141\x79\x73"); goto qQDkd; qfyil: VzU43: goto v4e55; gb5HN: if (!($i < $appoint_order_allow_days)) { goto NQY5x; } goto K1z3l; xrYQD: } public function submitAppointOrder($uid, $postData) { goto spyM6; uP0zl: return $orderNo; goto ruGhH; GJO4I: Log::notice("\163\155\x73\x20\x63\141\160\164\x63\x68\x61\40\143\157\144\x65\40\167\x72\157\x6e\x67\72\x20" . $smsCode); goto lwech; JfyFC: $supportTels = explode("\54", systemSetting("\163\x65\x6e\x64\137\141\x70\160\x6f\x69\156\x74\137\157\162\x64\x65\x72\x5f\x74\157\x5f\163\x75\x70\160\x6f\162\164\x5f\x74\x65\154\x73")); goto u1F5t; mPOY9: $appointDate = $postData["\x61\160\x70\157\151\156\164\x44\x61\x74\x65"] ?? ''; goto V3W9q; SLip2: logEvent("\xe5\x8f\x91\351\x80\201\xe9\xa2\x84\xe7\272\xa6\xe9\x80\x9a\347\x9f\xa5\347\x9f\xad\xe4\277\xa1\xe5\x88\xb0\344\xb8\223\xe5\256\266{$expertInfos["\143\x65\x6c\x6c\x70\x68\157\x6e\x65"]}\345\xa4\xb1\xe8\xb4\245", EventLogsService::eSeverityError); goto d86MU; DKom4: $orderNo = AppointOrderLogic::I()->generateOrder($uid, $expertId, $orderAmount, $appointDate, $appointTime, $appointDuration, $appointMode, $payStatus); goto UmMOE; OT8cl: if ($smsResult) { goto OMmCw; } goto SLip2; cfN86: if (SmsLogic::I()->verifyCaptcha($cellphone, $smsCode, "\101\120\120\x4f\111\116\124")) { goto tJyIW; } goto GJO4I; d86MU: Log::error("\146\141\151\x6c\145\x64\x20\x74\x6f\x20\163\145\156\144\x20\x73\x6d\x73\40\x74\157\40\x65\170\x70\x65\x72\x74\x20{$expertInfos["\143\145\154\x6c\160\x68\x6f\156\x65"]}"); goto Sm2fU; s7uhA: if (!(systemSetting("\x73\x65\x6e\144\x5f\141\x70\x70\157\151\156\164\x5f\157\x72\x64\x65\x72\137\x74\157\137\x65\x78\x70\145\162\x74") == "\171\145\163")) { goto neWo3; } goto BKuCW; V3W9q: $appointDuration = $postData["\x61\x70\x70\x6f\x69\156\164\104\165\x72\x61\x74\x69\x6f\x6e"] ?? ''; goto YY_Km; sZQ__: tJyIW: goto oQ2Rj; Bo_1W: $appointTimeSms = convertAppointTimesToShow($appointTime); goto s7uhA; FFkVv: $payStatus = systemSetting("\x61\x70\x70\157\151\156\164\137\x6f\x72\x64\145\x72\x5f\x70\141\171\x5f\x6d\x6f\x64\x65\154") == "\xe7\272\277\xe4\xb8\213\xe6\x94\257\344\273\x98" ? Defs::PAY_OFFLINE : Defs::PAY_WAIT; goto DKom4; DRupL: tVnzr: goto PTfGz; oQ2Rj: $expertInfos = ExpertLogic::I()->getInfos($expertId); goto Eax1B; TdV8x: $remark = $postData["\162\145\x6d\x61\x72\153"] ?? ''; goto cfN86; q5frb: $realName = $postData["\x72\145\141\x6c\116\141\x6d\x65"] ?? ''; goto qfAhF; spyM6: $expertId = $postData["\x65\x78\x70\x65\x72\x74\111\144"] ?? 0; goto mPOY9; UmMOE: Db::table("\145\x78\x70\145\162\x74")->where(["\151\144" => $expertId])->update(["\x6c\x61\164\x65\163\164\x5f\141\160\x70\x6f\x69\x6e\x74\x5f\x74\151\155\x65" => Db::raw("\x6e\157\167\50\51"), "\164\x6f\x74\x61\x6c\137\x61\x70\x70\x6f\151\156\164\x5f\x71\x75\141\156\x74\x69\x74\x79" => Db::raw("\164\157\x74\x61\x6c\137\x61\x70\x70\157\151\x6e\164\x5f\161\x75\x61\x6e\x74\x69\164\171\53\x31"), "\x74\157\x74\x61\x6c\137\141\160\160\157\151\x6e\x74\x5f\x61\x6d\157\165\x6e\164" => Db::raw("\x74\157\164\141\154\x5f\141\160\160\x6f\151\x6e\164\137\141\155\157\165\x6e\x74\x2b" . $orderAmount)]); goto m1Eq9; YY_Km: $appointTime = $postData["\x61\160\160\157\151\156\164\x54\x69\x6d\x65"] ?? ''; goto z8sMn; Eax1B: if ($expertInfos) { goto tVnzr; } goto w70Gr; qfAhF: $cellphone = $postData["\143\145\x6c\154\x70\150\x6f\x6e\145"] ?? ''; goto TETBw; u1F5t: foreach ($supportTels as $supportTel) { goto Bgikb; ioDMw: logEvent("\xe5\217\221\351\200\201\351\xa2\204\xe7\xba\246\xe9\x80\x9a\xe7\237\245\xe7\237\xad\344\xbf\241\xe5\x88\xb0\xe5\xae\242\xe6\x9c\215{$supportTel}\xe5\244\xb1\350\264\xa5", EventLogsService::eSeverityError); goto nUeqk; Bgikb: if (validateMobile($supportTel)) { goto TjJGD; } goto cJH2O; FTXFp: R0vQm: goto i9e_Z; qz9y1: $smsResult = SmsLogic::I()->sendAppoitOrderToSupport($supportTel, date("\x6d\xe6\x9c\210\144\346\x97\xa5", strtotime($appointDate)) . "\x20" . $appointTimeSms); goto sU9fg; cJH2O: Log::notice("\x74\150\145\40\143\165\163\x74\157\x6d\x65\162\x20\163\165\160\160\157\x72\x74\40\x74\145\x6c\x20{$supportTel}\x20\x69\163\40\156\x6f\164\40\166\x61\x6c\151\144\54\40\x73\x6b\151\x70"); goto fK3Dr; dtsNZ: TjJGD: goto qz9y1; sU9fg: if ($smsResult) { goto sSv3V; } goto ioDMw; BtWp6: sSv3V: goto FTXFp; nUeqk: Log::error("\x66\x61\151\154\145\x64\40\x74\x6f\x20\163\145\x6e\x64\x20\163\x6d\x73\40\x74\157\40\x73\165\x70\160\x6f\162\x74\40{$supportTel}"); goto BtWp6; fK3Dr: goto R0vQm; goto dtsNZ; i9e_Z: } goto Hv1Xh; Sm2fU: OMmCw: goto N4GUE; z8sMn: $appointMode = $postData["\141\x70\160\x6f\151\156\x74\115\157\x64\145"] ?? ''; goto WOdoO; CkQ2X: RCnBq: goto q5frb; m1Eq9: Db::table("\x63\x75\163\164\157\x6d\x65\x72")->where(["\x69\x64" => $uid])->update(["\154\x61\164\145\x73\x74\137\x61\x70\160\157\x69\x6e\164\x5f\164\151\x6d\x65" => Db::raw("\x6e\157\167\x28\x29"), "\x74\157\164\141\x6c\137\141\160\x70\x6f\x69\x6e\164\x5f\x71\x75\x61\x6e\164\151\x74\171" => Db::raw("\x74\x6f\164\141\154\137\141\160\160\157\151\x6e\164\137\161\165\x61\x6e\164\151\164\171\53\61"), "\x74\x6f\x74\x61\154\137\x61\160\160\157\151\x6e\164\137\x61\155\157\x75\x6e\164" => Db::raw("\164\x6f\x74\x61\154\137\x61\160\160\x6f\x69\156\x74\137\x61\x6d\x6f\x75\156\164\53" . $orderAmount)]); goto Bo_1W; WOdoO: if (!(empty($expertId) || empty($appointDate) || empty($appointDuration) || empty($appointTime) || empty($appointMode))) { goto RCnBq; } goto T_6dS; lwech: wexception("\xe7\237\xad\344\277\241\351\xaa\214\xe8\257\x81\347\240\201\xe9\224\231\350\xaf\xaf"); goto sZQ__; N4GUE: neWo3: goto JfyFC; BKuCW: $smsResult = SmsLogic::I()->sendAppoitOrderToExpert($expertInfos["\x63\145\x6c\154\x70\x68\x6f\156\x65"], date("\x6d\xe6\234\210\x64\346\x97\245", strtotime($appointDate)) . "\x20" . $appointTimeSms); goto OT8cl; TETBw: $smsCode = $postData["\x73\x6d\163"] ?? ''; goto TdV8x; T_6dS: wexception("\346\225\xb0\xe6\x8d\256\344\xb8\215\345\256\214\xe6\225\264"); goto CkQ2X; PTfGz: $orderAmount = $appointDuration == 15 ? $expertInfos["\x61\160\160\x6f\x69\x6e\164\x5f\x72\145\x76\151\145\x77\x5f\x66\145\145"] : $expertInfos["\141\160\160\157\x69\x6e\164\x5f\146\145\x65"]; goto FFkVv; w70Gr: wexception("\346\x97\240\346\263\225\xe6\x89\276\345\210\xb0\xe8\xaf\245\xe4\xb8\x93\345\256\xb6"); goto DRupL; BWphb: Db::table("\x65\170\160\x65\x72\164\137\x6f\162\x64\145\x72")->where(["\x6f\x72\144\x65\162\x5f\x6e\x6f" => $orderNo])->update(["\154\x69\x6e\x6b\x6d\x61\x6e" => $realName, "\x63\x65\x6c\x6c\160\150\157\x6e\145" => $cellphone, "\162\145\x6d\141\x72\x6b" => $remark]); goto uP0zl; Hv1Xh: lA_ZJ: goto BWphb; ruGhH: } public function appointPay($uid, $orderNo) { goto ErZWE; FOgwK: $smsResult = SmsLogic::I()->sendAppoitOrderToCustomer($orderInfos["\143\x65\x6c\x6c\160\x68\157\x6e\145"], date("\x6d\346\234\x88\144\xe6\x97\245", strtotime($orderInfos["\141\x70\x70\x6f\x69\x6e\x74\x5f\x64\141\164\x65"])) . "\40" . $appointTimeSms, systemSetting("\141\x70\x70\157\151\156\164\x5f\157\162\x64\145\x72\137\157\146\x66\x69\143\x65\x5f\x61\x64\144\x72\145\163\163")); goto P2hcO; BqjlK: FwA5r: goto xj7Ht; o5OeJ: b9Pi5: goto AjX40; PmPBI: logEvent("\345\x92\xa8\350\xaf\xa2\351\242\x84\xe7\272\xa6\xe8\xae\242\xe5\215\x95{$orderNo}\xe6\224\257\xe4\xbb\x98\xe5\244\261\350\xb4\xa5\x2c\40{$res["\x65\x72\x72\137\x63\157\x64\145\x5f\x64\145\163"]}", EventLogsService::eSeverityWarning); goto OU3vN; Ylktc: logEvent("\345\222\xa8\350\257\242\xe9\xa2\x84\347\272\246\350\256\xa2\xe5\215\225{$orderNo}\346\x94\257\xe4\xbb\230\345\xa4\261\350\xb4\xa5\54\40{$res["\x72\x65\164\165\162\156\x5f\x6d\x73\x67"]}", EventLogsService::eSeverityWarning); goto D4MSQ; AjX40: czrgX: goto I8WwN; sBcbA: Db::table("\x65\x78\160\145\162\164\137\x6f\162\x64\145\x72")->where(["\157\162\x64\145\x72\x5f\156\x6f" => $orderInfos["\157\x72\144\145\x72\137\x6e\x6f"]])->setField("\x70\x72\145\160\x61\171\x5f\x69\x64", $res["\x70\162\145\160\x61\171\x5f\x69\x64"]); goto je7H5; OU3vN: Log::error("{$orderNo}\40\xe5\xbe\xae\xe4\277\xa1\xe4\xb8\213\xe5\x8d\x95\xe5\xa4\xb1\350\xb4\245\357\xbc\232\350\xbf\x94\345\233\236\x20" . var_export($res, true)); goto wgn3T; sqVwE: wexception("\345\xbe\xae\344\277\xa1\xe4\xb8\x8b\xe5\215\225\345\244\261\xe8\xb4\245\xef\274\232\xe8\xbf\x94\xe5\x9b\236" . $res); goto BqjlK; K4J52: wexception("\xe5\276\xae\xe4\277\xa1\xe4\270\x8b\345\215\x95\345\xa4\261\xe8\264\245\xef\274\232\346\227\xa0\346\263\x95\346\211\276\345\x88\260\160\x72\x65\160\x61\x79\x5f\151\144"); goto ddmUL; TBi09: if (isset($res["\160\x72\x65\x70\141\x79\x5f\x69\144"])) { goto P_awM; } goto Ox0i9; dkzo7: $data["\156\x65\145\x64\137\160\x61\x79"] = true; goto ga6VS; SQcr0: Db::table("\x65\x78\160\145\162\x74\137\157\162\x64\145\x72")->where(["\x6f\x72\x64\145\162\x5f\x6e\x6f" => $orderInfos["\157\x72\144\145\162\137\156\157"]])->setField("\x70\141\171\x5f\x73\164\141\x74\x75\163", $payStatus); goto dDEjV; ga6VS: wxPaySetting(); goto RY565; PkoVy: Log::error("{$orderNo}\40\xe5\xbe\xae\xe4\xbf\241\xe4\xb8\x8b\xe5\x8d\225\345\xa4\261\350\264\245\xef\274\x9a\350\xbf\224\xe5\x9b\x9e\40" . $res); goto sqVwE; P2hcO: if ($smsResult) { goto b9Pi5; } goto vYUgl; JU0kr: if ($orderInfos) { goto mziDT; } goto gXq8s; WNjOS: wexception("\345\xbe\xae\xe4\277\241\344\270\213\345\x8d\x95\xe5\244\xb1\350\xb4\245\xef\xbc\232\350\xbf\x94\xe5\233\236\347\251\xba"); goto A6k3n; tSNSw: if (!empty($res)) { goto MjXLu; } goto EhVGM; R92pH: $app = Factory::payment(array_merge(config("\x77\170\x2e\x70\141\x79\155\145\156\x74"), ["\141\x70\x70\137\x69\x64" => config("\x77\170\56\157\146\146\151\143\x69\x61\154\x5f\x61\x63\143\157\x75\x6e\164")["\141\x70\160\x5f\x69\144"]])); goto bjcxe; KXcU8: if (is_array($res)) { goto FwA5r; } goto PkoVy; vYUgl: logEvent("\xe5\217\x91\xe9\x80\x81\xe9\242\x84\xe7\xba\246\xe9\x80\232\347\x9f\245\347\237\xad\344\277\241\xe5\210\xb0\345\256\xa2\346\x88\xb7{$orderInfos["\x63\x65\x6c\154\160\x68\x6f\156\145"]}\345\244\261\xe8\264\245", EventLogsService::eSeverityError); goto R1ZiP; je7H5: $data["\x63\x6f\x6e\146\x69\147"] = $app->jssdk->bridgeConfig($res["\x70\x72\x65\160\x61\x79\137\151\144"], false); goto iyGsu; RVKAb: wX240: goto R92pH; D4MSQ: wexception("\345\xbe\xae\xe4\277\241\xe4\270\x8b\345\215\x95\xe5\xa4\261\350\xb4\245\357\xbc\232" . $res["\x72\145\164\165\x72\x6e\x5f\155\x73\147"]); goto OK8q5; Bz8El: Log::notice("{$orderNo}\40\167\x65\143\150\x61\164\x20\160\141\x79\40\162\x65\164\x75\x72\x6e\40" . var_export($res, true)); goto tSNSw; d6xJQ: return $data; goto pmtA6; ScOcs: Sk7PY: goto d6xJQ; YaKIe: wexception("\xe5\xbd\223\xe5\211\215\xe7\216\xaf\345\xa2\x83\xe4\270\215\346\224\xaf\346\x8c\201\xe6\x94\257\344\xbb\230\346\223\215\344\275\234"); goto kk_2T; MFRIp: if (systemSetting("\x61\160\160\x6f\x69\156\x74\x5f\x6f\x72\x64\145\x72\137\160\x61\x79\x5f\155\x6f\144\145\154") == "\347\272\xbf\xe4\270\x8b\xe6\x94\257\xe4\273\230" || !$orderAmount) { goto upLxh; } goto Wzqbt; xj7Ht: if (!($res["\x72\145\x74\165\162\156\137\143\157\144\145"] == "\106\101\x49\x4c")) { goto rEQvs; } goto Ylktc; jWSDm: $payStatus = systemSetting("\x61\x70\x70\157\151\x6e\x74\x5f\x6f\x72\144\145\162\137\x70\x61\x79\137\155\157\144\x65\x6c") == "\347\272\xbf\xe4\270\213\xe6\x94\257\xe4\xbb\230" ? Defs::PAY_OFFLINE : Defs::PAY_SUCCESS; goto SQcr0; R1ZiP: Log::error("\146\x61\151\x6c\x65\144\40\164\157\40\x73\x65\156\x64\x20\x73\155\163\x20\164\157\40\x63\x75\163\164\157\x6d\145\162\40{$orderInfos["\143\x65\154\154\160\150\157\156\x65"]}"); goto o5OeJ; bHrAE: $data["\165\x72\x6c"] = url("\155\160\x2f\x45\x78\x70\x65\162\164\57\x61\160\x70\x6f\151\x6e\x74\x53\165\x63\x63\x65\x73\x73", ["\x6f\x72\x64\x65\x72\x4e\x6f" => $orderNo]); goto PVrLr; wgn3T: wexception("\345\276\256\xe4\xbf\241\344\270\x8b\345\215\225\345\xa4\261\xe8\xb4\245\357\274\x9a" . $res["\x65\162\162\x5f\143\157\x64\145\137\x64\145\163"]); goto sxz1t; sxz1t: kRpp9: goto TBi09; IszsU: if (!(systemSetting("\163\x65\156\x64\137\141\x70\x70\x6f\151\156\x74\x5f\157\162\x64\x65\x72\137\x74\157\137\x63\165\x73\164\157\x6d\145\162") == "\x79\145\x73")) { goto czrgX; } goto JlBtt; EhVGM: Log::error("{$orderNo}\40\345\276\xae\344\277\241\344\xb8\x8b\345\215\225\345\244\xb1\350\xb4\xa5\xef\274\232\xe8\xbf\x94\345\x9b\236\xe7\251\272"); goto WNjOS; ddmUL: P_awM: goto sBcbA; RY565: if (!(empty(config("\x77\170\x2e\157\x66\146\151\x63\151\141\154\x5f\141\143\x63\x6f\165\156\x74")["\x61\x70\160\x5f\151\144"]) || empty(config("\x77\170\x2e\160\x61\171\x6d\x65\156\x74")["\155\143\x68\x5f\x69\144"]))) { goto wX240; } goto fdKJX; PVrLr: $orderInfos = AppointOrderLogic::I()->getOrderInfos($uid, $orderNo); goto JU0kr; fdKJX: wexception("\xe8\257\xb7\351\205\x8d\347\xbd\xae\xe5\276\xae\xe4\xbf\241\xe5\x85\xac\xe4\274\x97\345\217\xb7\345\222\x8c\xe5\xbe\xae\xe4\277\xa1\xe6\x94\257\344\xbb\230\345\217\202\xe6\x95\xb0"); goto RVKAb; gXq8s: wexception("\xe8\256\242\xe5\215\225\344\xb8\215\xe5\xad\x98\345\234\250"); goto gEgAO; gEgAO: mziDT: goto lJ6fY; JlBtt: $appointTimeSms = convertAppointTimesToShow($orderInfos["\x61\160\160\x6f\x69\x6e\x74\137\164\x69\155\145"]); goto FOgwK; lJ6fY: $orderAmount = floatval($orderInfos["\157\x72\x64\145\x72\137\x61\155\157\x75\x6e\164"]); goto MFRIp; bjcxe: $res = $app->order->unify(["\142\157\x64\x79" => "\351\242\204\347\xba\246\xe8\xb4\xb9\xe7\x94\xa8", "\157\x75\x74\x5f\164\162\141\144\x65\137\x6e\x6f" => $orderInfos["\x6f\x72\144\x65\162\137\156\157"], "\x74\x6f\164\x61\154\137\146\x65\145" => $orderInfos["\x6f\162\144\145\x72\x5f\x61\155\x6f\x75\x6e\164"] * 100, "\x6e\157\164\x69\146\x79\x5f\165\x72\x6c" => url("\x6d\x70\57\127\170\57\x70\x61\x69\x64\105\170\x70\x65\162\164\117\x72\144\145\162", '', false, true), "\x74\162\x61\144\x65\137\164\171\x70\x65" => "\112\123\101\120\111", "\157\x70\x65\x6e\x69\144" => $uid]); goto Bz8El; I8WwN: $data["\156\145\145\x64\x5f\160\x61\x79"] = false; goto ScOcs; Wzqbt: if (!($uid == 1)) { goto skT9N; } goto YaKIe; Ox0i9: Log::error("{$orderNo}\40\xe5\276\xae\344\xbf\xa1\xe4\xb8\213\345\215\x95\345\244\261\xe8\xb4\245\357\274\232\xe6\227\240\x70\x72\145\x70\141\x79\x5f\151\144\x2c\40\350\277\224\xe5\233\236\x20" . var_export($res, true)); goto K4J52; kk_2T: skT9N: goto dkzo7; OK8q5: rEQvs: goto OHXC7; OHXC7: if (!($res["\x72\x65\163\165\154\164\137\x63\x6f\144\x65"] == "\106\x41\x49\x4c")) { goto kRpp9; } goto PmPBI; dDEjV: Db::table("\x65\x78\x70\145\162\164\137\x6f\x72\x64\x65\x72")->where(["\x6f\162\144\145\162\x5f\x6e\x6f" => $orderInfos["\157\x72\x64\x65\162\137\x6e\x6f"]])->setField("\x73\x74\141\x74\165\x73", IndexDefs::ORDER_APPOINTED_STATUS); goto IszsU; iyGsu: goto Sk7PY; goto YTrNG; ErZWE: $data = ["\157\162\x64\x65\162\116\x6f" => $orderNo]; goto bHrAE; A6k3n: MjXLu: goto KXcU8; YTrNG: upLxh: goto jWSDm; pmtA6: } }
