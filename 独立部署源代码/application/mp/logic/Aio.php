<?php
 namespace app\mp\logic; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\index\logic\Defs as IndexDefs; use app\mp\service\Subjects; use app\Defs; use app\index\logic\Subject as SubjectLogic; class Aio extends Base { public function login($uid, $computerName, $ver) { goto ABsvY; s1N7O: if (!$aio) { goto i9kmD; } goto HdX2W; ZNHiT: $aio = Db::table("\x61\151\x6f")->where(["\x75\x69\x64" => $uid])->find(); goto s1N7O; HdX2W: Db::table("\141\x69\x6f")->where(["\165\151\144" => $uid])->update(["\x63\x6f\x6d\x70\x75\x74\x65\x72\137\x6e\x61\155\145" => $computerName, "\x6c\x6f\x67\x69\156\137\164\x69\x6d\145" => Db::raw("\156\x6f\x77\50\x29"), "\x6c\157\147\151\156\x5f\151\x70" => request()->ip(), "\153\x65\145\x70\141\154\x69\x76\145\137\164\x69\x6d\x65" => Db::raw("\156\x6f\167\50\x29"), "\x76\x65\x72" => $ver, "\141\143\x63\145\x73\x73\x5f\164\157\153\145\x6e" => $accessToken]); goto fs6Ol; fs6Ol: goto NR8U_; goto Xbqha; pECVy: Db::table("\141\151\x6f")->insert(["\165\x69\x64" => $uid, "\x63\x6f\155\160\165\164\x65\x72\x5f\x6e\141\155\145" => $computerName, "\x6c\x6f\147\151\x6e\137\164\151\155\145" => Db::raw("\156\x6f\x77\x28\51"), "\x6c\x6f\x67\151\156\x5f\x69\x70" => request()->ip(), "\153\x65\x65\160\141\x6c\151\166\x65\x5f\164\151\155\x65" => Db::raw("\156\x6f\x77\50\51"), "\166\145\x72" => $ver, "\x61\x63\x63\x65\x73\x73\137\x74\x6f\x6b\x65\x6e" => $accessToken]); goto Po8rS; Xbqha: i9kmD: goto pECVy; ABsvY: $accessToken = generateUniqid(); goto ZNHiT; JQ4EX: return $accessToken; goto M70jT; Po8rS: NR8U_: goto JQ4EX; M70jT: } public function keepAlive($uid) { Db::table("\x61\x69\x6f")->where(["\165\x69\x64" => $uid])->update(["\153\145\x65\160\141\154\x69\166\x65\x5f\164\x69\155\145" => Db::raw("\156\157\x77\50\x29")]); } public function loadIndexSubjects() { goto lvfHW; o8Jx2: return [$banners, $populars, $featureds]; goto TzlLM; WIc0Z: foreach ($rows as &$row) { goto UiQac; vlO3R: if (!(false !== strpos($row["\154\141\142\x65\x6c"], "\142\141\156\156\x65\162"))) { goto a0TYo; } goto K0TO9; w7lfx: $featureds[] = $row; goto XuMKh; UiQac: $row["\x70\141\x72\164\x69\143\151\x70\141\156\x74\163"] = $row["\x70\x61\162\164\151\x63\151\160\141\156\x74\x73\137\x73\150\x6f\x77"]; goto dRt1k; ZBdX1: $row["\142\x61\156\156\145\x72\137\151\x6d\147"] = $row["\x69\155\x61\147\x65\137\165\162\154"]; goto KHkfF; gn9dv: rgPYb: goto titcW; KHkfF: hd60o: goto vlO3R; K0TO9: $banners[] = $row; goto n_7iF; QmcZV: $populars[] = $row; goto S4JKP; DvtSX: if (!(false !== strpos($row["\154\141\142\x65\154"], "\146\x65\x61\164\x75\162\145\144"))) { goto ZxWH2; } goto w7lfx; XuMKh: ZxWH2: goto gn9dv; dRt1k: if (!empty($row["\142\x61\156\156\145\162\137\x69\155\x67"])) { goto hd60o; } goto ZBdX1; n_7iF: a0TYo: goto TNG5E; S4JKP: hrUZy: goto DvtSX; TNG5E: if (!(false !== strpos($row["\154\141\x62\x65\154"], "\160\157\160\165\x6c\x61\162"))) { goto hrUZy; } goto QmcZV; titcW: } goto cGOm2; UPYLF: uqZBk: goto xli23; n4Axx: $map["\146\151\145\x6c\144"] = "\151\x64\54\x6e\141\155\x65\54\x73\165\x62\164\x69\164\154\x65\54\143\165\162\162\145\x6e\x74\137\x70\x72\x69\143\145\54\151\164\145\155\163\54\160\x61\162\x74\x69\x63\151\160\x61\156\164\163\137\x73\x68\x6f\167\54\x6c\141\x62\x65\154\54\151\x6d\x61\147\145\137\x75\162\154\54\142\141\156\x6e\x65\162\x5f\x69\155\x67"; goto MpiCo; xli23: foreach ($featureds as &$featured) { goto YeH0q; NA7am: $featured["\x69\x6d\141\147\x65\137\165\162\154"] = generateThumbnailUrl($featured["\151\155\141\x67\145\x5f\165\x72\x6c"], 300); goto g3UFZ; YeH0q: $categoryNames = Db::table("\163\x75\142\x6a\x65\143\164\137\x63\141\x74\x65\x67\157\x72\x79\137\162\x65\154\141\164\x65")->alias("\123\x43\122")->join("\143\141\x74\x65\x67\x6f\x72\x69\x65\163\x20\103", "\x53\x43\122\x2e\x63\x61\164\x65\147\157\x72\171\x5f\x69\144\x3d\103\56\x69\x64\40\x61\156\144\x20\123\103\122\x2e\x73\165\142\152\145\x63\164\137\151\144\75" . $featured["\151\x64"])->column("\103\56\156\x61\x6d\x65"); goto GujI0; g3UFZ: GKv6f: goto bLzkN; GujI0: $featured["\143\141\x74\145\x67\x6f\162\171\x5f\x6e\x61\155\145\x73"] = $categoryNames; goto NA7am; bLzkN: } goto ajZj1; lvfHW: $map = ["\144\145\154\x65\164\x65\x5f\x66\154\141\x67" => 0]; goto n4Axx; hzZZK: foreach ($populars as &$popular) { $popular["\151\155\x61\147\145\x5f\165\162\154"] = generateThumbnailUrl($popular["\x69\x6d\141\147\x65\x5f\x75\162\x6c"], 300); NWFfD: } goto UPYLF; ajZj1: WQ4AO: goto o8Jx2; MpiCo: $rows = Subjects::I()->getList($map, 1, 1000); goto t8bVw; t8bVw: $banners = []; goto TXbKf; Q1wRw: $featureds = []; goto WIc0Z; cGOm2: tA3gX: goto hzZZK; TXbKf: $populars = []; goto Q1wRw; TzlLM: } public function genOrder($aio_id, $subject_id) { goto yQ28G; N9k5i: OIOer: goto wYKqf; YZ3_U: return $order["\x6f\162\x64\x65\x72\137\156\x6f"]; goto tSkEN; qoPvJ: $order["\x61\x69\157\x5f\x69\144"] = $aio_id; goto w_pq1; C1uu2: zKauS: goto Ax9mh; pZDdr: PdBC7: goto BBdVw; wMOs7: wexception("\346\x97\240\346\263\x95\346\x89\276\xe5\210\xb0\350\xaf\xa5\351\207\x8f\xe8\241\xa8"); goto pZDdr; gGChg: $order["\x71\165\x65\163\x74\151\x6f\156\x5f\x66\157\162\x6d"] = $subject["\x71\165\x65\163\x74\x69\x6f\x6e\x5f\146\x6f\162\155"]; goto RDo7W; w_pq1: $order["\163\x75\x62\x6a\x65\x63\x74\137\151\144"] = $subject_id; goto godZh; e0ybw: Db::table("\x73\x75\x62\152\145\x63\x74")->where(["\x69\144" => $subject_id])->setInc("\x74\x6f\x74\x61\x6c\137\141\x6d\157\165\156\x74", $order["\157\162\144\x65\x72\137\x61\155\x6f\165\x6e\164"]); goto YZ3_U; hUQJG: if (!empty($res)) { goto zKauS; } goto oIy3K; AZeaK: $order["\157\162\144\x65\x72\137\156\x6f"] = generateSequenceNo(rand(1, 999), Defs::SUBJECT_ORDER_NO_SEQ_NUM_KEY, "\123"); goto qoPvJ; BRM86: wexception("\346\xb5\213\xe8\257\x84\xe9\207\217\350\241\250\345\x8c\x85\345\x90\xab\347\x9a\x84\xe9\242\230\347\x9b\256\xe4\270\xba\347\xa9\272"); goto N9k5i; Ax9mh: Db::table("\163\165\x62\x6a\145\143\164")->where(["\x69\144" => $subject_id])->setInc("\160\141\x72\164\x69\143\x69\x70\x61\x6e\164\163"); goto gDZ5d; wYKqf: $order = []; goto AZeaK; gDZ5d: Db::table("\x73\165\142\152\145\143\x74")->where(["\151\x64" => $subject_id])->setInc("\160\141\162\x74\151\x63\151\160\141\x6e\164\x73\x5f\x73\150\x6f\x77"); goto e0ybw; oIy3K: wexception("\346\225\260\xe6\215\256\xe5\xba\223\xe6\x96\260\345\xa2\x9e\350\256\xa2\345\215\x95\xe5\274\202\xe5\270\xb8"); goto C1uu2; wCtvz: $order["\x6f\x72\144\145\162\x5f\x61\x6d\157\165\x6e\164"] = 0; goto SDiXV; BBdVw: if (!($subject["\151\x74\x65\155\163"] == 0)) { goto OIOer; } goto BRM86; SDiXV: $order["\151\164\x65\155\x5f\166\145\x72\163\x69\157\x6e"] = $subject["\x69\164\x65\x6d\137\x76\x65\162\163\151\157\x6e"]; goto gGChg; godZh: $order["\x74\x6f\x74\141\154\137\x69\x74\145\155\163"] = $subject["\151\164\x65\x6d\163"]; goto wCtvz; RDo7W: $res = Db::table("\141\151\157\x5f\157\x72\x64\145\x72")->insert($order); goto hUQJG; yQ28G: $subject = Subjects::I()->getSubjectById($subject_id); goto P0QS_; P0QS_: if ($subject) { goto PdBC7; } goto wMOs7; tSkEN: } public function regenOrder($order_no) { goto Ly4H2; mkonn: $order = []; goto jHIS4; bSaBh: frlf3: goto phNZB; dNR0C: $order["\161\165\x65\163\164\x69\x6f\156\x5f\146\x6f\162\x6d"] = $subject["\x71\165\145\x73\x74\151\157\156\137\x66\157\x72\155"]; goto tqLus; gpfn4: Db::table("\x61\x69\x6f\x5f\157\x72\x64\x65\x72")->where("\x6f\x72\x64\145\x72\x5f\156\157", $order_no)->update($order); goto Hxepu; jHIS4: $order["\x74\157\x74\x61\x6c\137\x69\164\x65\155\x73"] = $subject["\x69\x74\145\155\x73"]; goto OTkuE; tqLus: $order["\x71\165\145\x73\164\151\x6f\x6e\137\x61\x6e\163\167\x65\x72"] = ''; goto AH2n9; AH2n9: $order["\x69\164\145\155\137\166\x65\162\163\x69\157\156"] = $subject["\151\x74\x65\x6d\137\166\x65\x72\x73\x69\157\156"]; goto gpfn4; kJZLz: $order["\x63\165\x72\x72\137\151\164\145\x6d"] = 0; goto kQ_VR; w9Gw0: if (!empty($subject)) { goto KhVgs; } goto swJh2; Ly4H2: $order = Db::table("\141\x69\x6f\137\157\162\144\145\162")->where(["\x6f\162\x64\145\x72\137\x6e\x6f" => $order_no])->field(true)->find(); goto m1cbf; swJh2: wexception("\346\265\213\xe8\xaf\x84\xe4\xb8\x8d\xe5\xad\x98\345\234\xa8"); goto kbHJr; kQ_VR: $order["\x69\x74\x65\x6d\163"] = ''; goto TBqRT; phNZB: $subject = Subjects::I()->getSubjectById($order["\163\x75\142\152\145\x63\164\x5f\151\x64"]); goto w9Gw0; kbHJr: KhVgs: goto mkonn; OTkuE: $order["\x74\145\x73\x74\137\x69\x74\145\x6d\x73"] = 0; goto kJZLz; TBqRT: $order["\162\145\x73\165\x6c\x74"] = null; goto s3vJZ; m1cbf: if (!empty($order)) { goto frlf3; } goto iDH1y; iDH1y: wexception("\xe6\xb5\213\xe8\257\204\350\256\xa2\xe5\215\x95\344\xb8\215\xe5\255\x98\xe5\234\xa8"); goto bSaBh; s3vJZ: $order["\x66\151\156\x69\163\150\145\x64"] = 0; goto dNR0C; Hxepu: } public function answer($order_no, $item_id, $item_type, $item_option) { goto gecKW; oPNfH: return $redirectUrl; goto Is8ma; bncOh: try { goto FWD4t; PFNug: $update["\x74\x65\163\x74\x5f\x69\x74\145\x6d\x73"] = 1; goto Hfg67; zbvR2: if (!empty($item)) { goto vc4MA; } goto ViP49; t3AUn: $item_option = htmlspecialchars_decode($item_option); goto XFDxM; r3KXe: goto Omoyn; goto Celmr; wdenk: $item_option = join("\55", $item_option); goto a21jJ; zvg4f: $answer[$item_id] = $item_id . "\x26" . $item_type . "\x26" . $item_option; goto MP4Be; DyHYn: foreach ($itemExists as $itemExist) { goto n2vrR; EitVm: goto m5wTi; goto BwBQA; gcoSO: $answer[$itemIdExist] = $itemExist; goto ElU8_; WMepr: if (!($itemIdExist == $item_id)) { goto hAnAC; } goto EitVm; ElU8_: qRJZ6: goto dGWnW; n2vrR: $itemIdExist = explode("\x26", $itemExist)[0]; goto WMepr; BwBQA: hAnAC: goto gcoSO; dGWnW: } goto FRwOo; Hfg67: Omoyn: goto bWAtZ; QKCEo: $itemExists = explode("\54", $order["\151\164\x65\155\x73"]); goto DyHYn; EBPZL: $item_option = str_replace("\x26", "\40", $item_option); goto Skl_p; C2oeE: MIMMM: goto wdenk; kF5eO: $update["\x66\x69\x6e\x69\x73\x68\137\x74\151\x6d\145"] = date("\131\x2d\155\55\x64\40\x48\x3a\x69\x3a\163"); goto eksOL; yRxEj: $update["\146\151\156\151\x73\150\145\144"] = 1; goto kF5eO; bWAtZ: if ($item_type == Defs::QUESTION_TEXT) { goto v0TbZ; } goto JYmJG; JYmJG: if (!($item_type == Defs::QUESTION_CHECKBOX)) { goto X3Ghd; } goto y7Edz; lmuR5: if ($order["\x74\x65\x73\x74\137\151\x74\x65\155\163"] == "\60") { goto AtR3z; } goto QKCEo; Celmr: AtR3z: goto PFNug; Acia9: v0TbZ: goto t3AUn; mqB0a: if (!empty($item["\156\145\x78\164\x5f\x69\144"])) { goto hr6_I; } goto yRxEj; WQD5Y: Azg1W: goto zvg4f; Mfv0L: $update["\162\x65\x73\165\154\x74"] = json_encode(["\x72\x65\x70\x6f\x72\164\114\x69\163\x74" => $result], JSON_UNESCAPED_UNICODE); goto vggCx; iV200: $order = array_merge($order, $update); goto H8jaf; a21jJ: X3Ghd: goto M0w8S; ViP49: exception("\xe8\257\204\xe6\xb5\x8b\351\xa2\x98\347\x9b\256\xe4\270\215\xe5\xad\230\345\x9c\250\xef\xbc\232" . $item_id); goto NR09m; XFDxM: $item_option = str_replace("\x2c", "\73", $item_option); goto EBPZL; eksOL: $result = SubjectLogic::I()->generateTestResult($order["\x73\165\142\x6a\x65\x63\164\x5f\151\144"], Subjects::I()->parseOrderItems($update["\x69\164\x65\x6d\x73"])); goto XAjL0; M0w8S: goto Azg1W; goto Acia9; yfxCL: $item_option = []; goto C2oeE; FRwOo: m5wTi: goto EnIDB; u8IL4: $item = Subjects::I()->getSubjectItem($item_id); goto zbvR2; vggCx: hr6_I: goto sNDnI; gizPt: exception("\346\265\x8b\350\xaf\x84\xe9\xa1\271\347\233\xae\347\211\210\xe6\x9c\254\xe5\x8f\221\347\224\237\xe4\272\x86\xe5\x8f\230\346\233\xb4\357\xbc\x8c\xe9\x9c\200\350\246\201\xe9\x87\x8d\346\226\xb0\xe6\265\x8b\xe8\257\x84", -1); goto NIBOW; y7Edz: if (!empty($item_option)) { goto MIMMM; } goto yfxCL; FWD4t: if (!($order["\151\164\145\155\x5f\x76\x65\x72\163\x69\x6f\156"] != $subject["\151\x74\145\155\137\166\x65\162\x73\x69\157\156"])) { goto GNyPG; } goto gizPt; Skl_p: $item_option = htmlspecialchars($item_option); goto WQD5Y; gxOVQ: $update["\x63\x75\x72\x72\x5f\x69\164\x65\155"] = $item_id; goto ZmlJC; sNDnI: Db::table("\141\151\157\x5f\157\162\x64\145\162")->where(["\157\x72\144\145\162\137\156\157" => $order_no])->update($update); goto iV200; t5uCA: $update = []; goto gxOVQ; ZmlJC: $answer = []; goto lmuR5; NIBOW: GNyPG: goto u8IL4; K2h6u: array_walk($result, function ($item) use(&$update) { goto oRHKG; Iejv3: s9CDU: goto FNttd; KO47N: if (!($item["\167\x61\162\x6e\151\156\x67\137\x6c\x65\166\145\154"] > $update["\x77\141\x72\x6e\x69\156\x67\137\154\145\x76\145\154"])) { goto s9CDU; } goto Xt6fV; A2Q68: pWLIi: goto KO47N; oRHKG: if (isset($item["\167\141\162\x6e\151\x6e\147\x5f\x6c\145\x76\x65\x6c"])) { goto pWLIi; } goto vpBms; Xt6fV: $update["\167\x61\x72\156\151\156\x67\x5f\154\x65\166\145\x6c"] = $item["\167\141\162\x6e\151\156\147\137\x6c\145\x76\145\154"]; goto Iejv3; vpBms: return; goto A2Q68; FNttd: }); goto Mfv0L; NR09m: vc4MA: goto t5uCA; EnIDB: $update["\164\x65\163\164\x5f\151\x74\145\x6d\x73"] = count($answer) + 1; goto r3KXe; MP4Be: $update["\151\164\x65\155\x73"] = join("\54", $answer); goto mqB0a; XAjL0: $update["\x77\141\x72\x6e\x69\156\147\x5f\x6c\x65\x76\145\x6c"] = Defs::MEASURE_WARNING_UNKOWN_LEVEL; goto K2h6u; H8jaf: } catch (\Exception $e) { goto V1rHz; V1rHz: $exceptionCode = $e->getCode(); goto QY8M8; oLwZq: wexception("\xe6\265\213\350\257\x84\xe9\241\271\347\x9b\256\xe7\x89\210\xe6\234\254\xe5\217\230\xe6\233\264", -1); goto vRX0K; XLRDt: wexception($e->getMessage()); goto VSZOc; vRX0K: yQTpm: goto XLRDt; QY8M8: if (!($exceptionCode == -1)) { goto yQTpm; } goto oLwZq; VSZOc: } goto SFTP_; NrRTx: $redirectUrl = url("\x6d\x70\57\101\151\157\57\162\x65\x70\x6f\x72\x74", ["\x6f\x72\144\145\x72\x5f\156\x6f" => $order_no]); goto oPNfH; Xyaoc: wexception("\346\xb5\213\350\xaf\204\xe8\256\xa2\xe5\x8d\225\xe4\270\x8d\xe5\xad\230\345\234\xa8"); goto ZJu46; JgeCo: qRz3d: goto NrRTx; iqikh: if (!empty($order)) { goto r_317; } goto Xyaoc; gecKW: $order = Db::table("\x61\151\157\x5f\157\162\x64\x65\x72")->where(["\157\x72\x64\145\x72\137\x6e\x6f" => $order_no])->field(true)->find(); goto iqikh; Is8ma: yEDQU: goto xYZMt; PwZoB: return false; goto lg4nZ; j8LiB: dCmqI: goto bncOh; HVLfI: $subject = Subjects::I()->getSubjectById($order["\163\165\142\152\145\143\x74\137\x69\144"]); goto e6l6z; ZJu46: r_317: goto HVLfI; SFTP_: if ($order["\146\151\156\151\163\x68\x65\x64"]) { goto qRz3d; } goto PwZoB; hI15n: wexception("\xe8\xaf\245\xe6\xb5\x8b\350\xaf\x84\xe8\xae\xa2\xe5\x8d\x95\345\205\xb3\350\201\x94\xe9\207\217\350\xa1\xa8\xe4\xb8\242\xe5\244\xb1"); goto j8LiB; e6l6z: if (!empty($subject)) { goto dCmqI; } goto hI15n; lg4nZ: goto yEDQU; goto JgeCo; xYZMt: } }
