<?php
 namespace app\mp\logic; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\index\logic\Defs as IndexDefs; use app\mp\service\Subjects; use app\Defs; use app\index\logic\Subject as SubjectLogic; use EasyWeChat\Factory; use app\index\service\EventLogs as EventLogsService; class Dian extends Base { public function genOrder($good_id, $subject_id) { goto hNwsZ; A3U1U: yiG13: goto ZJr0x; odjUm: $order["\x69\x74\145\155\137\166\145\162\163\x69\x6f\156"] = $subject["\151\x74\145\155\x5f\x76\145\x72\163\x69\x6f\156"]; goto wMlt8; hNwsZ: $subject = Subjects::I()->getSubjectById($subject_id); goto AUQM6; XeAQ3: Db::table("\x73\165\142\x6a\145\143\x74")->where(["\151\x64" => $subject_id])->setInc("\x74\157\x74\x61\x6c\137\x61\155\157\x75\156\164", $order["\157\x72\144\x65\x72\x5f\x61\155\157\x75\x6e\164"]); goto PHPQ5; warkl: $order["\x67\157\157\144\163\x5f\151\x64"] = $good_id; goto laG6y; SJSWh: $order["\x6f\162\x64\x65\162\137\x6e\x6f"] = generateSequenceNo(rand(1, 999), Defs::SUBJECT_ORDER_NO_SEQ_NUM_KEY, "\x53"); goto warkl; UX0C1: $order["\157\x72\x64\145\162\137\x61\155\x6f\165\x6e\x74"] = 0; goto odjUm; PHPQ5: return $order["\157\162\144\145\162\x5f\156\x6f"]; goto UakpV; QCOVm: $order = []; goto SJSWh; bl8zZ: X2Mq3: goto QCOVm; m1gPW: Db::table("\x64\151\x61\x6e\137\147\157\x6f\x64\x73")->where(["\151\144" => $good_id])->update(["\x73\164\x61\x74\165\x73" => Defs::eGoodsUsed]); goto VIKr5; wMlt8: $order["\x71\x75\145\x73\x74\151\157\156\x5f\x66\x6f\162\x6d"] = $subject["\x71\165\x65\163\164\151\x6f\156\137\x66\x6f\162\x6d"]; goto hqnTw; ZJr0x: if (!($subject["\151\164\x65\x6d\x73"] == 0)) { goto X2Mq3; } goto p1a1G; WlOkL: wexception("\xe6\x97\240\xe6\xb3\x95\346\211\xbe\xe5\210\xb0\350\257\245\xe9\207\x8f\xe8\241\250"); goto A3U1U; ctd2K: wexception("\346\x95\xb0\346\215\256\345\272\x93\xe6\226\260\xe5\xa2\236\350\xae\242\xe5\215\225\xe5\274\x82\345\xb8\xb8"); goto FqsGY; FqsGY: PL03u: goto m1gPW; VIKr5: Db::table("\163\165\x62\x6a\x65\143\164")->where(["\151\144" => $subject_id])->setInc("\x70\141\162\x74\x69\x63\151\160\x61\156\x74\163"); goto MXWie; hqnTw: $res = Db::table("\x64\151\x61\x6e\x5f\x6f\x72\144\x65\x72")->insert($order); goto icGsC; laG6y: $order["\164\x6f\x74\x61\154\x5f\x69\x74\145\155\x73"] = $subject["\x69\164\145\155\x73"]; goto UX0C1; icGsC: if (!empty($res)) { goto PL03u; } goto ctd2K; MXWie: Db::table("\x73\165\x62\x6a\x65\x63\x74")->where(["\151\x64" => $subject_id])->setInc("\x70\141\x72\x74\151\143\x69\x70\x61\x6e\x74\163\137\163\x68\157\x77"); goto XeAQ3; AUQM6: if ($subject) { goto yiG13; } goto WlOkL; p1a1G: wexception("\346\265\213\xe8\257\x84\351\207\x8f\350\241\xa8\xe5\214\205\xe5\220\xab\347\x9a\204\351\xa2\230\347\x9b\xae\344\xb8\272\xe7\251\272"); goto bl8zZ; UakpV: } public function regenOrder($subject_id, $order_no) { goto dscvt; kFmWk: $order["\x69\x74\145\155\163"] = ''; goto rUxct; Gvrw1: $order["\x74\145\163\x74\137\x69\164\145\155\163"] = 0; goto D_xAP; dsM7h: Db::table("\144\151\x61\x6e\137\157\x72\x64\145\162")->where("\157\x72\144\145\x72\x5f\x6e\157", $order_no)->update($order); goto Jr1xN; Np5N_: $order["\161\x75\145\163\x74\151\157\x6e\x5f\x66\157\162\155"] = $subject["\x71\165\x65\x73\164\151\157\x6e\137\x66\x6f\x72\x6d"]; goto bV0Gs; KCADA: $order["\x74\x6f\x74\141\154\137\151\164\145\155\163"] = $subject["\x69\164\145\x6d\x73"]; goto Gvrw1; z7CdI: $subject = Subjects::I()->getSubjectById($subject_id); goto rz86S; FEifo: $order["\146\x69\x6e\x69\163\150\145\144"] = 0; goto Np5N_; cydyE: neE8W: goto z7CdI; nzfuY: $order = []; goto KCADA; MFsyk: ZWan4: goto nzfuY; Dp1ol: wexception("\xe6\265\213\xe8\257\204\xe8\256\xa2\345\215\x95\344\270\x8d\345\xad\x98\xe5\234\xa8\357\xbc\232" . $order_no); goto cydyE; D_xAP: $order["\x63\165\x72\162\x5f\x69\164\145\x6d"] = 0; goto kFmWk; dscvt: $order = Db::table("\144\x69\x61\x6e\x5f\157\162\x64\x65\x72")->where(["\157\x72\144\145\162\137\x6e\157" => $order_no])->field(true)->find(); goto tVfxv; tVfxv: if (!empty($order)) { goto neE8W; } goto Dp1ol; bV0Gs: $order["\x71\165\145\x73\x74\151\157\156\137\x61\x6e\163\167\145\x72"] = ''; goto cwV46; cwV46: $order["\x69\x74\x65\x6d\137\x76\145\x72\163\x69\x6f\156"] = $subject["\x69\164\145\x6d\x5f\x76\x65\x72\x73\x69\157\x6e"]; goto dsM7h; rz86S: if (!empty($subject)) { goto ZWan4; } goto A7cRK; A7cRK: wexception("\xe6\265\213\xe8\xaf\x84\344\xb8\215\345\255\x98\345\234\250"); goto MFsyk; rUxct: $order["\162\145\163\165\x6c\x74"] = null; goto FEifo; Jr1xN: } public function answer($subject_id, $order_no, $item_id, $item_type, $item_option) { goto fXeBc; sNGEb: wexception("\350\xaf\245\xe6\xb5\x8b\350\257\x84\xe8\256\xa2\xe5\215\225\xe5\205\xb3\350\x81\x94\351\207\x8f\350\241\xa8\xe4\270\242\345\xa4\xb1\xef\274\232" . $order_no); goto QyAVG; GVd_k: wexception("\346\265\213\350\257\x84\350\xae\xa2\345\x8d\225\344\xb8\215\xe5\xad\x98\345\234\xa8\xef\xbc\232" . $order_no); goto kQJIW; RfeJC: $subject = Subjects::I()->getSubjectById($subject_id); goto Zru1h; dXLv9: try { goto jbSll; hnzi8: goto A6KPt; goto tGyuq; SCCb_: VEkDG: goto edd3U; scZDM: exception("\346\xb5\x8b\350\xaf\x84\351\xa1\xb9\347\233\xae\347\x89\210\346\234\xac\xe5\217\x91\xe7\224\237\xe4\xba\206\345\217\x98\xe6\x9b\xb4\357\xbc\x8c\351\234\200\xe8\xa6\201\xe9\x87\215\346\x96\xb0\346\xb5\213\350\xaf\x84", -1); goto E0NyO; yLaC6: $item_option = str_replace("\46", "\x20", $item_option); goto DUakk; DqOM0: exception("\xe8\xaf\x84\346\xb5\213\xe9\242\x98\xe7\x9b\256\344\270\215\345\255\230\345\234\xa8\357\xbc\x9a" . $item_id); goto A2ffk; UlW3f: jrDme: goto Gpyez; x0D8y: $item_option = htmlspecialchars_decode($item_option); goto kwHJb; aZT7l: $update = []; goto gnvHW; I8W0X: $answer[$item_id] = $item_id . "\x26" . $item_type . "\x26" . $item_option; goto sU5rw; pJltJ: RUyVq: goto nlcub; K5ePs: $item_option = []; goto pJltJ; Gpyez: $update["\x74\x65\163\x74\137\x69\164\145\x6d\163"] = count($answer) + 1; goto MKItJ; edd3U: if ($item_type == Defs::QUESTION_TEXT) { goto Gvz8R; } goto wJ6C8; gnvHW: $update["\143\x75\x72\162\x5f\x69\164\x65\155"] = $item_id; goto ZeXLh; rvu15: $order = array_merge($order, $update); goto tXEyP; YzjIG: if (!empty($item_option)) { goto RUyVq; } goto K5ePs; kwHJb: $item_option = str_replace("\x2c", "\x3b", $item_option); goto yLaC6; wJ6C8: if (!($item_type == Defs::QUESTION_CHECKBOX)) { goto IG1oK; } goto YzjIG; xLH7j: $update["\x72\x65\x73\165\154\164"] = json_encode(["\x72\145\160\157\162\164\114\x69\x73\164" => $result], JSON_UNESCAPED_UNICODE); goto xjkQj; z_gBw: $update["\164\145\163\164\x5f\151\x74\145\155\x73"] = 1; goto SCCb_; qi9e8: $item = Subjects::I()->getSubjectItem($item_id); goto Egwmx; V5YkJ: $update["\x66\x69\156\151\x73\x68\145\144"] = 1; goto vb5WI; U6caK: if ($order["\x74\145\163\x74\137\x69\x74\145\x6d\x73"] == "\x30") { goto NeEnG; } goto NsO2I; xjkQj: O4ApY: goto WTJNO; A2ffk: ARPsG: goto aZT7l; DUakk: $item_option = htmlspecialchars($item_option); goto bcn1U; vb5WI: $update["\146\x69\156\151\163\150\137\164\x69\155\145"] = date("\131\55\x6d\55\144\40\110\x3a\x69\72\163"); goto lOkko; tfBlO: foreach ($itemExists as $itemExist) { goto sThWC; ZNJaF: $answer[$itemIdExist] = $itemExist; goto PLSyW; PLSyW: trpOL: goto plVUZ; j6l3D: goto jrDme; goto L4MDl; p7MT3: if (!($itemIdExist == $item_id)) { goto WozB1; } goto j6l3D; sThWC: $itemIdExist = explode("\46", $itemExist)[0]; goto p7MT3; L4MDl: WozB1: goto ZNJaF; plVUZ: } goto UlW3f; tGyuq: Gvz8R: goto x0D8y; WTJNO: Db::table("\x64\x69\141\x6e\x5f\157\162\144\145\162")->where(["\x6f\x72\144\x65\162\x5f\156\x6f" => $order_no])->update($update); goto rvu15; jbSll: if (!($order["\151\x74\145\x6d\137\x76\x65\162\x73\151\x6f\x6e"] != $subject["\151\x74\145\155\137\166\145\x72\163\x69\157\x6e"])) { goto e1J7d; } goto scZDM; aTLJ9: if (!empty($item["\x6e\145\x78\164\137\x69\144"])) { goto O4ApY; } goto V5YkJ; sU5rw: $update["\151\164\x65\x6d\163"] = join("\x2c", $answer); goto aTLJ9; NsO2I: $itemExists = explode("\x2c", $order["\x69\164\145\155\163"]); goto tfBlO; nlcub: $item_option = join("\x2d", $item_option); goto VOS9M; MtgwH: array_walk($result, function ($item) use(&$update) { goto qhyoF; s7kzP: if (!($item["\x77\141\162\x6e\x69\156\147\137\x6c\x65\166\x65\x6c"] > $update["\167\x61\x72\x6e\151\x6e\x67\137\154\x65\166\x65\x6c"])) { goto sVPXJ; } goto TK119; o6gBR: wNCDf: goto s7kzP; ddFcE: return; goto o6gBR; qhyoF: if (isset($item["\167\x61\162\x6e\x69\156\x67\137\x6c\x65\x76\x65\154"])) { goto wNCDf; } goto ddFcE; TK119: $update["\167\141\x72\x6e\151\156\147\x5f\154\145\166\145\x6c"] = $item["\x77\141\x72\156\x69\156\147\x5f\x6c\x65\166\145\154"]; goto xAgmL; xAgmL: sVPXJ: goto aR4JS; aR4JS: }); goto xLH7j; VOS9M: IG1oK: goto hnzi8; cPoXq: $update["\x77\x61\x72\x6e\x69\156\147\137\154\145\166\x65\x6c"] = Defs::MEASURE_WARNING_UNKOWN_LEVEL; goto MtgwH; ZeXLh: $answer = []; goto U6caK; MKItJ: goto VEkDG; goto pt__B; bcn1U: A6KPt: goto I8W0X; lOkko: $result = SubjectLogic::I()->generateTestResult($subject_id, Subjects::I()->parseOrderItems($update["\x69\164\145\155\x73"])); goto cPoXq; Egwmx: if (!empty($item)) { goto ARPsG; } goto DqOM0; E0NyO: e1J7d: goto qi9e8; pt__B: NeEnG: goto z_gBw; tXEyP: } catch (\Exception $e) { goto QmrcV; tB10h: if (!($exceptionCode == -1)) { goto QF42e; } goto VwCq0; ggcjX: QF42e: goto h4ugc; h4ugc: wexception($e->getMessage()); goto IGOXa; QmrcV: $exceptionCode = $e->getCode(); goto tB10h; VwCq0: wexception("\346\265\x8b\350\257\x84\351\xa1\271\347\x9b\xae\347\x89\210\xe6\234\xac\xe5\x8f\x98\xe6\233\xb4", -1); goto ggcjX; IGOXa: } goto uZ5q5; fXeBc: $order = Db::table("\144\151\x61\156\137\x6f\x72\x64\x65\x72")->where(["\x6f\x72\144\x65\162\x5f\156\157" => $order_no])->field(true)->find(); goto nGfox; nGfox: if (!empty($order)) { goto C46sR; } goto GVd_k; QyAVG: dq63k: goto dXLv9; uZ5q5: return $order; goto J98Sc; kQJIW: C46sR: goto RfeJC; Zru1h: if (!empty($subject)) { goto dq63k; } goto sNGEb; J98Sc: } }
