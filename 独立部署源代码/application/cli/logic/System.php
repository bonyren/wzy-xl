<?php
 namespace app\cli\logic; use think\Log; use think\Db; use app\Defs; use app\index\logic\Defs as IndexDefs; class System { public function __construct() { } public function detectSlowQuery() { goto pUV5E; pUV5E: $logFile = "\x2f\166\141\x72\57\x6c\x6f\x67\x2f\x6d\x79\x73\161\x6c\57\163\x6c\x6f\167\x5f\x71\x75\145\162\171\137\x6c\157\147\56\154\157\147"; goto ucnXo; EKN1G: Db::table("\x73\154\157\167\137\161\x75\x65\162\x79")->insert(["\157\143\x63\165\x72\137\x74\x69\155\145" => $occur_time, "\157\x63\x63\x75\162\137\x75\x73\x65\162" => $occur_user, "\157\143\x63\165\x72\137\164\150\162\145\x61\x64" => $occur_thread, "\161\x75\145\162\x79\x5f\x74\151\155\x65" => $query_time, "\154\x6f\x63\x6b\137\x74\x69\x6d\x65" => $lock_time, "\x72\x6f\167\x73\x5f\163\145\x6e\x74" => $rows_sent, "\x72\157\x77\163\x5f\145\x78\141\155\151\156\145\x64" => $rows_examined, "\157\x63\x63\165\x72\x5f\x73\161\x6c" => $occur_sql]); goto fg3kU; FhnT9: if (!$occur_time) { goto XlB8X; } goto lRHnt; aqT9i: if ($handle) { goto j6eHp; } goto xj6Rt; lRHnt: if (!(strtotime($occur_time) > strtotime($beginDate))) { goto McnSC; } goto dXRI6; SV9np: $handle = fopen($logFile, "\162"); goto aqT9i; Gy2yr: if (!$occur_time) { goto dhq3X; } goto TazNS; FTC2P: DitYo: goto Ud01l; fg_eK: if (!$occur_time) { goto aXAPZ; } goto xlhEs; O5e3p: $occur_time = substr($line, strlen($prefixTrait)); goto FtqLK; NTX3O: if (!(($line = fgets($handle)) === false)) { goto zfpsH; } goto aq3dG; zxZH6: exception("\146\x61\x69\154\145\144\40\x74\x6f\x20\x6f\x70\145\156\40\146\x69\154\145\x3a\x20" . $logFile); goto dR2Zu; F1AEA: aXAPZ: goto O5e3p; DRFs3: if (!(strpos($line, $prefixTrait) === 0)) { goto Bu0Y9; } goto PLXDa; lBUTX: if (!(($line = fgets($handle)) !== false)) { goto kA1L6; } goto HBWNb; uQHlw: BQ8EE: goto iGxs1; pzmav: zfpsH: goto fGGCM; iB3Oa: if ($existInDb) { goto DitYo; } goto EKN1G; nFnAY: $prefixTrait = "\43\40\124\x69\x6d\x65\x3a\40"; goto girNK; TazNS: $occur_sql .= $line; goto Q7Y1x; LHJkY: if ($existInDb) { goto x4rMK; } goto pClMt; iMiwK: $occur_time = $occur_user = $occur_thread = $query_time = $lock_time = $rows_sent = $rows_examined = $occur_sql = ''; goto UgaQM; UXdEd: $rows_examined = $matches[4]; goto N7cUi; GtmiB: $occur_sql = ''; goto zZeCI; mDHww: $result = preg_match("\57\121\165\145\x72\x79\137\x74\x69\155\x65\72\x5c\163\52\50\x5b\60\x2d\71\56\135\53\x29\x5c\163\x2a\x4c\157\x63\x6b\137\164\151\x6d\145\72\134\x73\52\50\133\x30\55\x39\x2e\135\53\x29\x5c\163\x2a\x52\157\167\x73\x5f\x73\145\x6e\x74\72\134\163\x2a\x28\x5b\x30\x2d\71\x2e\135\x2b\51\x5c\163\x2a\x52\x6f\x77\x73\137\x65\170\141\x6d\151\x6e\145\144\x3a\134\163\x2a\x28\133\60\x2d\71\x2e\135\53\x29\134\163\x2a\x2f", $line, $matches); goto T3Q0K; iGxs1: $prefixTrait = "\43\x20\125\163\x65\x72\x40\110\x6f\x73\164\72\40"; goto DRFs3; xWjeB: $existInDb = Db::table("\x73\154\x6f\167\x5f\161\165\x65\x72\171")->where(["\x6f\143\x63\x75\x72\137\x74\x69\x6d\x65" => $occur_time])->count(); goto iB3Oa; ZiKdz: $query_time = $matches[1]; goto e4P8y; NRisb: kA1L6: goto FhnT9; OniFB: offvE: goto nFnAY; N7cUi: qJlpk: goto GtmiB; R91ue: goto eGFiE; goto igaok; coXOm: if (!($pos !== 0)) { goto OhYAZ; } goto Gy2yr; j570Q: eGFiE: goto lBUTX; AyNpr: $occur_time = $occur_user = $occur_thread = $query_time = $lock_time = $rows_sent = $rows_examined = $occur_sql = ''; goto F1AEA; UgaQM: XlB8X: goto JMX0k; e4P8y: $lock_time = $matches[2]; goto k1_di; ucnXo: $beginDate = date("\131\x2d\x6d\55\144"); goto ulnFF; dR2Zu: j6eHp: goto uRi0R; HBWNb: if (!empty($line)) { goto offvE; } goto zsEP2; rfv1X: echo "\164\157\x74\141\x6c\x44\145\164\145\143\x74\145\x64\103\x6f\165\x6e\164\72\x20{$totalDetectedCount}\xa"; goto FTC2P; JMX0k: fclose($handle); goto sbbRB; xlhEs: if (!(strtotime($occur_time) > strtotime($beginDate))) { goto wbcFe; } goto xWjeB; fg3kU: $totalDetectedCount++; goto rfv1X; Ud01l: wbcFe: goto AyNpr; t74fV: echo "\164\157\x74\x61\154\104\145\164\x65\x63\164\145\144\103\x6f\165\x6e\x74\x3a\40{$totalDetectedCount}\xa"; goto ZOrl9; FtqLK: $occur_time = trim($occur_time); goto SPcy1; Q7Y1x: dhq3X: goto R91ue; SPcy1: $occur_time = date("\x59\x2d\x6d\x2d\x64\x20\x48\x3a\151\72\163", strtotime($occur_time)); goto vOfmF; igaok: OhYAZ: goto fg_eK; uRi0R: $occur_time = $occur_user = $occur_thread = $query_time = $lock_time = $rows_sent = $rows_examined = $occur_sql = ''; goto j570Q; T3Q0K: if (!($result && count($matches) == 5)) { goto qJlpk; } goto ZiKdz; zsEP2: goto eGFiE; goto OniFB; k1_di: $rows_sent = $matches[3]; goto UXdEd; PLXDa: $occur_user = substr($line, strlen($prefixTrait)); goto d5LPN; dXRI6: $existInDb = Db::table("\x73\x6c\x6f\167\137\161\165\145\162\x79")->where(["\157\x63\x63\x75\x72\137\164\x69\155\x65" => $occur_time])->count(); goto LHJkY; ZOrl9: x4rMK: goto OXE9X; aq3dG: goto kA1L6; goto pzmav; zZeCI: goto eGFiE; goto NRisb; pClMt: Db::table("\163\x6c\x6f\x77\137\161\165\x65\x72\171")->insert(["\157\x63\x63\x75\162\137\x74\151\x6d\x65" => $occur_time, "\x6f\x63\143\165\x72\137\x75\163\x65\x72" => $occur_user, "\x6f\143\143\165\162\137\x74\x68\x72\145\141\x64" => $occur_thread, "\x71\165\145\x72\171\137\x74\151\155\145" => $query_time, "\x6c\157\x63\153\x5f\x74\x69\x6d\145" => $lock_time, "\162\x6f\167\x73\137\163\145\x6e\164" => $rows_sent, "\x72\157\167\163\x5f\x65\170\141\x6d\151\x6e\x65\x64" => $rows_examined, "\x6f\143\x63\165\x72\137\x73\x71\x6c" => $occur_sql]); goto Vylfn; qCyML: goto kA1L6; goto uQHlw; Vylfn: $totalDetectedCount++; goto t74fV; OXE9X: McnSC: goto iMiwK; vOfmF: if (!(($line = fgets($handle)) === false)) { goto BQ8EE; } goto qCyML; xj6Rt: echo "\146\141\x69\x6c\x65\x64\x20\x74\x6f\40\x6f\160\145\x6e\40\146\x69\x6c\x65\x3a\40" . $logFile . "\xa"; goto zxZH6; girNK: $pos = strpos($line, $prefixTrait); goto coXOm; d5LPN: $occur_user = trim($occur_user); goto iR_qA; sbbRB: return "\x74\157\x74\x61\154\x44\x65\164\x65\x63\x74\x65\x64\x43\x6f\x75\x6e\x74\72\x20{$totalDetectedCount}"; goto trcQ7; ulnFF: $totalDetectedCount = 0; goto SV9np; iR_qA: Bu0Y9: goto NTX3O; fGGCM: $matches = []; goto mDHww; trcQ7: } }
