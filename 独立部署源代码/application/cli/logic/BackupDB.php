<?php
 namespace app\cli\logic; use app\index\service\Setting; use think\Log; class BackupDB { private $mysql_dump = ROOT_PATH . "\142\151\156" . DS . "\155\171\x73\x71\x6c\x64\165\x6d\160\56\x65\x78\x65"; private $compressor = ROOT_PATH . "\x62\x69\156" . DS . "\x37\172\56\145\x78\145"; public $backup_path = ROOT_PATH . "\x64\x62" . DS . "\142\x61\x63\153\x75\160"; public $expiration = 30 * 86400; public $error = null; public function __construct() { goto OVaLK; kcNun: $this->expiration = $config["\x44\x42\x5f\x42\101\103\113\125\x50\x5f\105\130\x50\111\122\101\124\x49\x4f\x4e"] * 86400; goto g7v98; Ab5cP: $this->backup_path = rtrim($this->backup_path, "\57\134"); goto EGVMv; EGVMv: if (file_exists($this->backup_path)) { goto ez_wK; } goto q6lxJ; nR6QW: $this->backup_path = $config["\x44\102\x5f\x42\x41\103\113\125\x50\x5f\x50\101\124\x48"]; goto La9wr; La9wr: qkBTQ: goto iyL9s; zJq2I: eXc3T: goto tRl49; ketf3: if (!$config["\x44\102\137\102\101\103\x4b\125\120\137\120\x41\124\x48"]) { goto qkBTQ; } goto nR6QW; HTpdz: if (!(!file_exists($this->backup_path) || !is_writable($this->backup_path))) { goto eXc3T; } goto O6Flv; g7v98: Xe1rO: goto Ab5cP; O6Flv: exception("\xe5\244\207\xe4\273\275\347\x9b\256\345\275\225\xef\xbc\232" . $this->backup_path . "\346\x97\240\xe6\xb3\225\xe5\206\231\345\x85\245\xef\xbc\214\xe8\257\267\xe6\243\200\xe6\x9f\xa5\xe6\x9d\203\351\231\x90"); goto zJq2I; OVaLK: $config = ["\104\x42\137\x42\x41\x43\x4b\125\x50\137\120\101\x54\x48" => systemSetting("\x44\x42\137\102\x41\103\113\x55\x50\x5f\x50\x41\124\110"), "\104\102\x5f\102\101\103\x4b\125\x50\x5f\105\130\120\x49\x52\x41\x54\111\x4f\x4e" => systemSetting("\x44\102\137\x42\x41\x43\x4b\x55\120\137\105\x58\x50\x49\x52\101\124\x49\x4f\116")]; goto ketf3; q6lxJ: mkdir($this->backup_path, 0775); goto DaEpV; iyL9s: if (!$config["\x44\x42\137\102\101\103\113\x55\120\x5f\105\x58\120\x49\122\x41\x54\x49\117\116"]) { goto Xe1rO; } goto kcNun; DaEpV: ez_wK: goto HTpdz; tRl49: } public function cleanUp() { goto NAtfn; SSJwu: if (is_dir($this->backup_path) && file_exists($this->backup_path) && ($handle = opendir($this->backup_path))) { goto jaZNE; } goto tLRKF; cK1Dy: goto CSvCF; goto as1TE; UeAF0: goto CSvCF; goto tf8Xj; T4Ys5: if (!(0 !== strpos($file, $filenamePrefix))) { goto JoeaY; } goto yUInL; GIZ40: $unlinkCount++; goto nxs1v; NBRIP: if (!($file == "\x2e" || $file == "\x2e\x2e")) { goto h9tA3; } goto Qxzit; AQfWv: echo $file . "\345\267\262\350\277\207\xe6\x9c\237\72\x20" . floor($time / 86400) . "\xe5\xa4\251\xd\xa"; goto kCJlv; bzd9h: JoeaY: goto qsKKu; aYL2t: jaZNE: goto F6eAU; gl4Op: if (!($time >= $this->expiration)) { goto Os3bi; } goto AQfWv; NC6b1: CSvCF: goto cPccz; nM5tG: closedir($handle); goto HJpwl; tf8Xj: GRQZU: goto nM5tG; NAtfn: $conf = config("\144\x61\x74\x61\142\x61\163\145"); goto zWlXN; avUuK: $unlinkCount = 0; goto NC6b1; F6eAU: $t_now = time(); goto avUuK; yUInL: goto CSvCF; goto bzd9h; BvPT9: h9tA3: goto T4Ys5; eSaUg: syDXB: goto wbBFE; kCJlv: unlink($this->backup_path . DS . $file); goto GIZ40; cPccz: if (!(false !== ($file = readdir($handle)))) { goto GRQZU; } goto NBRIP; Z0lda: $time = $t_now - strtotime($backupDate); goto gl4Op; qsKKu: $path_parts = pathinfo($file); goto SjVTd; SjVTd: $backupDate = explode("\x23", $path_parts["\146\x69\154\145\156\x61\155\x65"])[1]; goto ELGDI; ELGDI: if (!empty($backupDate)) { goto pRh89; } goto mGYqe; E2mXk: pRh89: goto eh4sr; kg1K5: goto syDXB; goto aYL2t; nxs1v: Os3bi: goto UeAF0; as1TE: UyL18: goto Z0lda; HJpwl: return "\xe6\270\x85\347\x90\206\xe5\xa4\207\xe4\xbb\275\xe6\x96\207\344\xbb\xb6{$unlinkCount}\xe4\xb8\252"; goto eSaUg; Qxzit: goto CSvCF; goto BvPT9; mGYqe: goto CSvCF; goto E2mXk; zWlXN: $filenamePrefix = sprintf("\x25\x73\43", $conf["\144\141\x74\141\142\x61\x73\x65"]); goto SSJwu; tLRKF: exception("\146\141\x69\154\145\x64\40\164\157\x20\146\x69\x6e\x64\x20{$this->backup_path}"); goto kg1K5; eh4sr: if (!(false === strtotime($backupDate))) { goto UyL18; } goto cK1Dy; wbBFE: } public function backup() { goto zwI__; idHmG: $file_zip = $this->backup_path . DS . $filename . "\x2e\x7a\151\x70"; goto UktCM; zwI__: $conf = config("\144\x61\x74\141\142\141\x73\x65"); goto g8mfF; k9niU: exception("\x66\x61\151\154\x65\144\40\164\157\40\x73\171\x73\164\x65\x6d\x20{$cmd}"); goto Sa8sD; tE1qw: $cmd = "\x22{$this->compressor}\42\40\x61\x20{$file_zip}\x20{$file_sql}"; goto S_W8t; S_W8t: MTmKk: goto VEDsH; ybQ03: $cmd = sprintf("\155\171\163\161\x6c\x64\165\x6d\x70\x20\x2d\x2d\x73\153\x69\x70\x2d\x6c\157\143\153\55\x74\141\142\x6c\x65\x73\40\55\x68\45\163\40\x2d\165\x25\x73\40\55\x70\45\163\40\45\x73\x20\76\x20\45\x73", $conf["\150\x6f\163\164\156\x61\155\145"], $conf["\165\163\145\x72\156\x61\x6d\x65"], $conf["\160\141\163\163\167\157\162\x64"], $conf["\x64\x61\164\x61\142\141\x73\x65"], $file_sql); goto NiqU8; oenIp: EWJy2: goto zxlvL; Mo8W3: if (!($result === false)) { goto EWJy2; } goto zCtPJ; pFGz7: $cmd = sprintf("\x22{$this->mysql_dump}\x22\40\x2d\x2d\x73\x6b\151\160\x2d\x6c\x6f\x63\153\x2d\164\x61\x62\x6c\x65\x73\40\55\x68\x25\163\40\55\x75\x25\163\40\x2d\160\45\163\x20\45\163\x20\x3e\x20\45\x73", $conf["\150\157\x73\164\156\x61\155\x65"], $conf["\x75\163\x65\x72\156\141\x6d\145"], $conf["\160\x61\163\x73\x77\157\x72\144"], $conf["\x64\x61\x74\141\x62\141\163\x65"], $file_sql); goto vzs6b; eV_gM: XNQHL: goto pFGz7; zxlvL: unlink($file_sql); goto Maiij; NiqU8: goto i0fvL; goto eV_gM; Na5Tu: $file_sql = $this->backup_path . DS . $filename . "\x2e\163\161\x6c"; goto smhLz; zCtPJ: exception("\146\x61\151\154\145\144\40\x74\x6f\40\x73\171\163\x74\145\x6d\x20{$cmd}"); goto oenIp; Sa8sD: ZO02w: goto idHmG; smhLz: if (IS_WIN) { goto XNQHL; } goto ybQ03; hdeLr: $cmd = "\172\151\x70\40\55\x72\40{$file_zip}\40{$file_sql}"; goto n9_PB; VEDsH: $result = system($cmd); goto Mo8W3; UktCM: if (IS_WIN) { goto kss_J; } goto hdeLr; Maiij: return "\xe5\244\x87\xe4\273\275\xe6\210\x90\345\x8a\237{$filename}"; goto K4kQf; xxd05: if (!($result === false)) { goto ZO02w; } goto k9niU; vzs6b: i0fvL: goto H3Tdq; g8mfF: $filename = sprintf("\45\x73\x23\x25\163", $conf["\x64\x61\164\141\x62\x61\163\145"], date("\131\155\x64")); goto Na5Tu; IG3fP: kss_J: goto tE1qw; n9_PB: goto MTmKk; goto IG3fP; H3Tdq: $result = system($cmd); goto xxd05; K4kQf: } }
