<?php
 namespace app\cli\logic; use think\Log; use app\index\service\Setting; use think\Db; class CleanServer { public function __construct() { } public function clean() { goto HetTo; HetTo: $this->cleanWeb(); goto TCzNW; TCzNW: $this->cleanDb(); goto Vdr4G; Vdr4G: return "\346\270\x85\347\x90\x86\xe6\210\220\xe5\212\x9f"; goto epDSY; epDSY: } protected function cleanWeb() { goto Q4r1q; O0oUn: if (!($nowTime > $lastModTime && $nowTime - $lastModTime > 30 * 24 * 3600)) { goto clOSH; } goto g78pD; kXf5O: at5gJ: goto EkGRy; Q4r1q: $nowTime = time(); goto kD6n7; HYHfM: goto DtUmI; goto dSfYE; MVyq6: if (!(false !== ($file = readdir($handle)))) { goto at5gJ; } goto T1bze; u50Mz: clOSH: goto ViIEE; F7kXI: neS6y: goto TIVWl; huDJR: unlink($filePath); goto jnWGn; XohkH: if (!is_dir($filePath)) { goto V9TSW; } goto HYHfM; g78pD: Log::notice("\346\270\x85\xe7\x90\206\xe6\x97\245\345\xbf\227\346\226\x87\xe4\xbb\266\72\40{$filePath}"); goto WbM6l; tgBXI: c0V_3: goto H1JRL; Y8zUt: UnCnp: goto A5iLf; iNNwl: $lastModTime = filemtime($filePath); goto O0oUn; jnWGn: goto DtUmI; goto kXf5O; IMaoT: if (!is_dir($filePath)) { goto QQq1Y; } goto JUFi5; JUFi5: goto neS6y; goto rnyeV; ViIEE: goto neS6y; goto tgBXI; T1bze: if (!($file == "\56" || $file == "\x2e\x2e")) { goto UnCnp; } goto Nn1Ur; EkGRy: closedir($handle); goto Sp3v9; rwNk9: if (!(is_dir($logPath) && file_exists($logPath) && ($handle = opendir($logPath)))) { goto KIuAw; } goto F7kXI; A5iLf: $filePath = $tmpPath . DS . $file; goto XohkH; H1JRL: closedir($handle); goto psiBT; Nn1Ur: goto DtUmI; goto Y8zUt; xTBeq: $filePath = $logPath . DS . $file; goto IMaoT; mrecP: qR9ZC: goto xTBeq; dSfYE: V9TSW: goto TX7qL; dWIPR: if (!(is_dir($tmpPath) && file_exists($tmpPath) && ($handle = opendir($tmpPath)))) { goto mcdhK; } goto unMOY; hmcsH: $tmpPath = rtrim(TEMP_PATH, "\x2f\x5c"); goto dWIPR; TX7qL: Log::notice("\346\270\205\xe7\x90\206\350\247\206\xe5\233\276\xe6\226\x87\xe4\273\xb6\72\40{$filePath}"); goto huDJR; rnyeV: QQq1Y: goto iNNwl; GxAXm: goto neS6y; goto mrecP; unMOY: DtUmI: goto MVyq6; S_P9v: if (!($file == "\x2e" || $file == "\x2e\56")) { goto qR9ZC; } goto GxAXm; psiBT: KIuAw: goto hmcsH; Sp3v9: mcdhK: goto YF3SJ; kD6n7: $logPath = rtrim(LOG_PATH, "\57\134"); goto rwNk9; TIVWl: if (!(false !== ($file = readdir($handle)))) { goto c0V_3; } goto S_P9v; WbM6l: unlink($filePath); goto u50Mz; YF3SJ: } protected function cleanDb() { goto AS9O0; UcSEu: Db::table("\x6d\145\163\163\x61\147\x65\x73")->whereTime("\145\x6e\x74\145\x72\145\144", "\x3c", $beginDate)->delete(); goto NgnUh; aRLUl: $beginDate = date("\131\x2d\x6d\x2d\144", strtotime($today . "\40\55\x31\40\x6d\157\156\164\x68")); goto I9lWs; AS9O0: $today = date("\131\55\155\55\144"); goto aRLUl; NgnUh: Db::table("\145\x76\x65\x6e\164\137\154\x6f\147\x73")->whereTime("\x65\x6e\x74\145\162\145\144", "\x3c", $beginDate)->delete(); goto OMTgt; I9lWs: Db::table("\x6a\x6f\142\137\161\165\145\x75\145")->whereTime("\x65\156\164\x65\x72\145\x64", "\74", $beginDate)->delete(); goto MC9Sb; MC9Sb: $beginDate = date("\131\x2d\155\55\144", strtotime($today . "\x20\55\61\40\x6d\x6f\x6e\164\x68")); goto UcSEu; OMTgt: } }
