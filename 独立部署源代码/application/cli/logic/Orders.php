<?php
 namespace app\cli\logic; use think\Log; use think\Db; use think\Cache; use app\mp\service\Subjects; use app\Index\logic\License as LicenseLogic; class Orders { public function __construct() { } public function generateReportPdfs() { goto Z302j; Z302j: if (LicenseLogic::I()->checkVip()) { goto HtrBi; } goto A35Fl; mrM3_: $successCount = 0; goto xko2l; Q3tGA: TDreh: goto M45cJ; IXEtD: HtrBi: goto mrM3_; jAcnk: $orders = Db::table("\x73\165\x62\152\145\x63\x74\x5f\157\x72\x64\x65\x72")->where(["\146\x69\156\151\x73\x68\x65\x64" => 1, "\162\x65\x70\157\162\164\137\x70\x64\146" => null])->page(1, 100)->order("\151\144\x20\x64\145\163\x63")->field("\x69\x64\x2c\40\x6f\x72\144\x65\162\x5f\156\157")->select(); goto JwqcN; A35Fl: return "\345\xbd\x93\xe5\211\215\344\xb8\x8d\346\x98\xaf\346\234\x89\346\x95\x88\347\x9a\204\xe4\274\232\xe5\x91\x98\xe8\xb5\x84\346\xa0\274\xef\xbc\214\xe8\xaf\245\345\x8a\x9f\xe8\x83\275\xe7\xa6\201\347\x94\xa8"; goto IXEtD; guS4y: foreach ($orders as $order) { goto oolR9; XhEmJ: if (!empty($siteUrl)) { goto suGYK; } goto JVx38; f997s: file_put_contents($saveFullname, $pdfContent); goto zN7rF; oolR9: $orderNo = $order["\157\x72\x64\x65\x72\x5f\156\x6f"]; goto eY49f; FKYIr: if (!empty($orderInfo)) { goto zNAXb; } goto kISvF; kW0nE: $saveFullname = EXPORT_DIR . DS . "\162\x65\x70\157\x72\x74\137\x70\x64\x66" . DS . $saveName; goto f997s; eY49f: $orderInfo = Subjects::I()->getOrderByNo($orderNo); goto FKYIr; ztGaa: $failCount++; goto AP65W; zN7rF: Db::table("\163\x75\x62\152\x65\x63\164\137\x6f\x72\x64\x65\162")->where("\x69\144", $order["\x69\x64"])->update(["\162\x65\x70\157\162\x74\x5f\x70\x64\146" => $saveName]); goto m8EBm; mhjsF: lUIN2: goto b7D9C; m8EBm: $successCount++; goto yEOtL; AP65W: goto iJfEu; goto mhjsF; R3psr: $url = url("\x6d\x70\57\123\x75\x62\152\145\143\164\x2f\x72\x65\x70\x6f\162\x74", array_merge(generateMpAutoLoginParams($orderInfo["\143\x75\x73\x74\x6f\x6d\145\x72\137\x69\144"]), ["\x6f\x72\x64\x65\162\137\156\x6f" => $orderNo, "\151\156\x74\x65\x72\156\x61\x6c\x56\151\145\167" => 1, "\160\x64\146\126\x69\145\167" => 1])); goto vigVD; F7Jm2: if (!empty($pdfFileName)) { goto lUIN2; } goto ztGaa; DVX5C: goto iJfEu; goto rfH5C; kISvF: $failCount++; goto DVX5C; eac_l: $pdfFileName = file_get_contents($apiUrl); goto F7Jm2; ES772: goto iJfEu; goto qornr; luyYj: $saveName = $orderNo . "\x2e\x70\x64\146"; goto kW0nE; yEOtL: iJfEu: goto lg8MA; k_FQP: $pdfContent = file_get_contents($pdfUrl); goto luyYj; ccumC: $url = $siteUrl . $url; goto NtChF; l2yQG: $failCount++; goto ES772; rfH5C: zNAXb: goto R3psr; b7D9C: $pdfUrl = "\150\x74\x74\x70\72\57\57\x77\167\167\x2d\164\x6c\x2e\x73\157\x6c\x61\162\x71\x74\56\x63\157\x6d\x3a\x38\x30\x38\61\57\77\146\151\x6c\x65\75" . urlencode($pdfFileName); goto k_FQP; qornr: suGYK: goto ccumC; vigVD: $siteUrl = Cache::get("\x53\111\124\x45\137\x55\122\114"); goto XhEmJ; JVx38: Log::error("\146\x61\151\x6c\145\144\40\x74\157\x20\x66\x69\x6e\x64\40\x53\x49\124\105\x5f\x55\x52\x4c\x20\151\x6e\40\x63\x61\x63\150\x65"); goto l2yQG; NtChF: $apiUrl = "\x68\x74\x74\160\x3a\57\x2f\x77\167\167\55\x74\154\x2e\163\x6f\x6c\x61\x72\161\x74\56\x63\157\x6d\x3a\x38\60\70\x31\x2f\77\165\x72\154\75" . urlencode($url); goto eac_l; lg8MA: } goto Q3tGA; fbwWU: IkiRh: goto guS4y; JwqcN: if (!empty($orders)) { goto IkiRh; } goto OvhmE; rHqBU: AQd6P: goto YphPR; VkDCw: if (true) { goto sUyfp; } goto rHqBU; OvhmE: goto AQd6P; goto fbwWU; xko2l: $failCount = 0; goto ydjtS; M45cJ: goto AQd6P; goto VkDCw; YphPR: return "\xe6\210\220\345\212\x9f\72{$successCount}\x2c\40\xe5\xa4\xb1\xe8\xb4\xa5{$failCount}"; goto qMlAG; ydjtS: sUyfp: goto jAcnk; qMlAG: } }
