<?php
 namespace app\index\service; use think\Log; use think\Db; use think\Debug; use app\index\service\RequestContext; use app\common\service\WException; use app\common\service\Storage as StorageService; use app\Defs; use app\index\logic\License as LicenseLogic; class Wzyer extends Base { protected function __construct() { } const API_URL_PREFIX = "\150\x74\164\x70\163\72\57\57\x77\167\167\56\x77\172\x79\145\162\x2e\143\157\155\57\151\x6e\144\x65\x78\57\x4f\x70\145\x6e\137\x41\160\151"; protected function buildHeader() { goto aiAc8; CGwdi: $headers = ["\101\120\120\55\111\104\72" . $licenseData["\x69\144"], "\101\125\124\x48\x2d\x4b\105\x59\x3a" . $licenseData["\141\165\x74\x68\x5f\153\145\x79"], "\x43\157\156\164\145\156\x74\55\124\171\x70\x65\72\40\x61\x70\x70\154\151\143\x61\x74\x69\157\156\x2f\170\55\x77\x77\x77\55\x66\157\162\155\x2d\x75\x72\x6c\x65\156\143\157\144\x65\144"]; goto eLt7M; eLt7M: return $headers; goto J7fd_; aiAc8: $licenseData = LicenseLogic::I()->fetch(); goto CGwdi; J7fd_: } public function bindAuthKey($authKey, $ip = '') { goto BVkoh; FtmcT: IdFQr: goto xBxyh; C09xA: $jsonObj = $this->_post(self::API_URL_PREFIX . "\57\142\151\x6e\144\x41\x75\164\150\x4b\145\x79\x2e\x68\x74\x6d\x6c", $headers, $postFields); goto XdxC4; XdxC4: if (!($jsonObj["\x63\x6f\x64\x65"] != 1)) { goto IdFQr; } goto Pnc_3; xBxyh: return $jsonObj["\144\x61\164\x61"]; goto uSr3Y; BVkoh: $headers = $this->buildHeader(); goto SlDV0; d44U_: wexception($jsonObj["\x6d\x73\x67"]); goto FtmcT; SlDV0: $postFields = http_build_query(["\141\x75\x74\x68\x4b\145\x79" => $authKey, "\x69\160" => $ip]); goto C09xA; Pnc_3: Log::error("\x62\151\x6e\144\x41\165\164\x68\x4b\145\x79\40\x65\x72\x72\x6f\x72\x3a\x20" . $jsonObj["\155\163\147"]); goto d44U_; uSr3Y: } public function refreshAuthKey() { goto MeMGh; LQaYF: $jsonObj = $this->_post(self::API_URL_PREFIX . "\57\162\x65\x66\162\x65\163\150\101\x75\x74\150\x4b\x65\x79\56\150\x74\x6d\154", $headers); goto JbJbZ; JbJbZ: if (!($jsonObj["\x63\x6f\144\145"] != 1)) { goto DmW2Z; } goto ukx49; nG2NI: return $jsonObj["\x64\141\x74\141"]; goto A_4Cn; ukx49: Log::error("\162\x65\146\162\x65\x73\x68\x41\x75\x74\150\113\145\x79\x20\145\162\162\x6f\162\x3a\x20" . $jsonObj["\155\163\147"]); goto SC87y; SC87y: wexception($jsonObj["\155\163\x67"]); goto PXSS3; PXSS3: DmW2Z: goto nG2NI; MeMGh: $headers = $this->buildHeader(); goto LQaYF; A_4Cn: } public function unbindAuthKey() { goto qWpMk; Zcy__: Pfe4y: goto Hasdb; Hasdb: return; goto RsHoI; r22f0: wexception($jsonObj["\155\x73\x67"]); goto Zcy__; jSa2x: Log::error("\165\x6e\142\x69\156\x64\101\x75\164\x68\x4b\145\171\x20\145\x72\x72\x6f\162\72\40" . $jsonObj["\155\163\x67"]); goto r22f0; lteqd: if (!($jsonObj["\143\x6f\x64\x65"] != 1)) { goto Pfe4y; } goto jSa2x; QPRDy: $jsonObj = $this->_post(self::API_URL_PREFIX . "\57\165\x6e\142\x69\x6e\x64\101\x75\164\x68\113\x65\171\56\150\x74\155\154", $headers); goto lteqd; qWpMk: $headers = $this->buildHeader(); goto QPRDy; RsHoI: } public function apiSubjectList($type = Defs::SUBJECT_TYPE_PSYCHOLOGY, $search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto h7V76; qwMKq: $jsonObj = $this->_post(self::API_URL_PREFIX . "\x2f\x73\165\x62\x6a\145\x63\x74\114\x69\x73\x74\x2e\150\x74\155\154", $headers, $postFields); goto Ab_5h; h7V76: $headers = $this->buildHeader(); goto EJLBj; EJLBj: $postFields = http_build_query(["\164\x79\160\x65" => $type, "\x73\145\141\x72\143\150" => $search, "\160\141\x67\x65" => $page, "\162\157\x77\x73" => $rows, "\x73\157\162\x74" => $sort, "\157\x72\x64\x65\x72" => $order]); goto qwMKq; nHXnK: wexception($jsonObj["\155\x73\147"]); goto OeTUr; Ab_5h: if (!($jsonObj["\143\x6f\144\145"] != 1)) { goto ZWBbe; } goto zr9TQ; zr9TQ: Log::error("\141\160\151\x53\165\x62\152\145\143\164\x4c\x69\163\164\40\145\162\x72\x6f\x72\x3a\40" . $jsonObj["\155\x73\x67"]); goto nHXnK; uAHMX: return $jsonObj["\144\x61\x74\x61"]; goto S0sPe; OeTUr: ZWBbe: goto uAHMX; S0sPe: } public function apiSubject($subjectId) { goto GGuY2; A8tae: return $jsonObj["\x64\x61\164\141"]; goto cfrCM; B2n6p: $jsonObj = $this->_post(self::API_URL_PREFIX . "\57\163\x75\x62\x6a\x65\143\x74\x2e\150\x74\155\x6c\77\163\x75\x62\152\145\x63\164\111\144\x3d" . $subjectId, $headers); goto sOGpc; sOGpc: if (!($jsonObj["\x63\x6f\x64\145"] != 1)) { goto KqZhK; } goto aZ8eR; GGuY2: $headers = $this->buildHeader(); goto B2n6p; P6XM3: KqZhK: goto A8tae; emP2g: wexception($jsonObj["\x6d\x73\x67"]); goto P6XM3; aZ8eR: Log::error("\x61\160\x69\x53\165\x62\152\x65\x63\x74\x20\x65\x72\x72\x6f\162\72\40" . $jsonObj["\155\163\147"]); goto emP2g; cfrCM: } public function apiSubjectReport($sn, $itemOptions) { goto xxafF; a13YB: if (!($jsonObj["\143\157\144\x65"] != 1)) { goto fnx1R; } goto uPLd0; dRLJe: $jsonObj = $this->_post(self::API_URL_PREFIX . "\x2f\x73\165\x62\x6a\145\x63\x74\122\145\x70\x6f\x72\164\x2e\150\x74\x6d\x6c", $headers, $postFields); goto a13YB; q0fsf: $postFields = http_build_query(["\163\156" => $sn, "\x69\164\145\x6d\x4f\160\164\x69\157\x6e\x73" => json_encode($itemOptions)]); goto dRLJe; Svqzm: wexception($jsonObj["\x6d\x73\x67"]); goto Tf6lK; xxafF: $headers = $this->buildHeader(); goto q0fsf; D7jrt: return $jsonObj["\144\x61\164\141"]; goto nF2OT; Tf6lK: fnx1R: goto D7jrt; uPLd0: Log::error("\141\x70\151\x53\165\x62\x6a\145\143\164\x52\x65\160\157\x72\x74\x20\x65\162\x72\157\162\x3a\x20" . $jsonObj["\x6d\x73\x67"]); goto Svqzm; nF2OT: } public function apiFetchReportAlgo($number) { goto mO0RK; oMtpH: if (!($jsonObj["\143\x6f\144\x65"] != 1)) { goto IcGIb; } goto u1dv7; u1dv7: Log::error("\x61\x70\151\x46\145\x74\x63\x68\122\x65\160\x6f\x72\x74\x41\x6c\x67\157\40\145\162\162\x6f\162\x3a\x20" . $jsonObj["\x6d\163\x67"]); goto j6nvV; Aj0jF: return $jsonObj["\144\141\164\x61"]; goto huYAr; vemu0: IcGIb: goto Aj0jF; j6nvV: wexception($jsonObj["\x6d\x73\147"]); goto vemu0; Wbu8m: $jsonObj = $this->_post(self::API_URL_PREFIX . "\57\146\x65\164\143\150\122\145\x70\157\162\164\x41\154\147\157\56\150\164\x6d\154", $headers, $postFields); goto oMtpH; mO0RK: $headers = $this->buildHeader(); goto vKwtx; vKwtx: $postFields = http_build_query(["\x6e\165\155\x62\145\162" => $number]); goto Wbu8m; huYAr: } protected function _get($url, $headers = array()) { goto p1HeP; zuEwu: whkdy: goto xmTQU; hiiMR: curl_setopt($ch, CURLOPT_TIMEOUT, 120); goto HniYz; xRn6p: curl_setopt($ch, CURLOPT_VERBOSE, TRUE); goto mAV79; CidHE: m67Fl: goto ls1ZZ; itfL0: Log::error("\x5f\x67\x65\164\54\40\x68\x74\x74\x70\40\143\157\144\x65\x20{$httpCode}\x2c\x20{$result}\54\x20\165\x72\x6c\72\40" . $url); goto EeAz5; BHGvV: if (!$headers) { goto m67Fl; } goto frmlA; ls1ZZ: Log::notice("\137\x67\145\164\40\165\x72\154\x3a\x20" . $url . "\x2c\40\150\x74\164\160\x20\x68\145\x61\144\x65\162\72\x20" . json_encode($headers, JSON_UNESCAPED_UNICODE)); goto PgN8o; DhEEp: if ($result) { goto Nzazx; } goto Wi10I; cfb3K: curl_close($ch); goto LpMSp; EeAz5: wexception("\x5f\147\x65\164\54\x20\150\164\164\x70\40\x63\157\144\145\x20{$httpCode}\54\40{$result}\x2c\40\x75\x72\154\72\40" . $url); goto F9WDC; whctv: wexception("\137\147\145\164\54\40\x66\x61\151\x6c\145\144\x20\x74\x6f\40\152\x73\x6f\156\137\x64\x65\x63\x6f\x64\x65\72\x20" . $result . "\x2c\x20\x75\162\x6c\x3a\x20" . $url); goto zuEwu; mAV79: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto cM5M7; p1HeP: $ch = curl_init(); goto etDoX; SbBzb: $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); goto cfb3K; Y3MqT: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 120); goto hiiMR; oqW4e: curl_close($ch); goto dNGnJ; frmlA: curl_setopt($ch, CURLOPT_HTTPHEADER, $headers); goto CidHE; Wi10I: $errCode = curl_errno($ch); goto ALCUk; cM5M7: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto Y3MqT; qTSE3: Log::notice("\x5f\x67\145\164\x20\165\x72\154\72\x20" . $url . "\54\x20\162\145\163\x70\x6f\x6e\x73\x65\40\162\x65\163\165\154\164\72\x20" . $result); goto SbBzb; HniYz: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto A1346; A1346: curl_setopt($ch, CURLOPT_FORBID_REUSE, FALSE); goto BHGvV; I9G1r: wexception("\137\147\145\164\54\40\146\x61\151\x6c\145\x64\40\x74\157\40\x63\x75\x72\154\x5f\145\x78\x65\143\54\40{$errCode}\x2c\40{$errMsg}\54\40\x75\x72\x6c\72\x20" . $url); goto jiWjh; ALCUk: $errMsg = curl_error($ch); goto oqW4e; PgN8o: $result = curl_exec($ch); goto DhEEp; LQrO0: $jsonObj = json_decode($result, true); goto ldM8Q; dNGnJ: Log::error("\137\147\x65\x74\54\40\x66\141\x69\154\145\x64\40\164\157\x20\x63\165\x72\x6c\x5f\145\170\x65\143\x2c\x20{$errCode}\x2c\40{$errMsg}\54\x20\165\x72\154\x3a\40" . $url); goto I9G1r; LpMSp: if (!($httpCode != "\x32\60\60")) { goto UBgRJ; } goto itfL0; jiWjh: Nzazx: goto qTSE3; dAlfr: Log::error("\137\147\x65\x74\54\x20\x66\x61\151\154\x65\x64\x20\164\157\40\x6a\x73\x6f\156\137\144\145\x63\157\x64\145\72\40" . $result . "\54\x20\x75\162\x6c\x3a\x20" . $url); goto whctv; xmTQU: return $jsonObj; goto b5wtB; F9WDC: UBgRJ: goto LQrO0; etDoX: curl_setopt($ch, CURLOPT_URL, $url); goto xRn6p; ldM8Q: if ($jsonObj) { goto whkdy; } goto dAlfr; b5wtB: } protected function _post($url, $headers = array(), $postFields = '') { goto lru6a; BkQh8: Log::error("\137\160\157\163\164\54\x20\x66\141\151\x6c\x65\x64\40\x74\157\40\152\x73\x6f\156\x5f\144\x65\x63\157\x64\x65\72\x20" . $result . "\54\x20\x75\x72\x6c\x3a\40" . $url); goto n4gjc; kZ26M: $errMsg = curl_error($ch); goto r25vL; wbVNO: w2zg7: goto VdyzX; r25vL: curl_close($ch); goto x4Ff1; fHsze: curl_setopt($ch, CURLOPT_VERBOSE, TRUE); goto ncQ0O; Fcu0m: curl_setopt($ch, CURLOPT_POSTFIELDS, $postFields); goto ywq0e; lru6a: $ch = curl_init(); goto h3I6Z; B5sju: Log::notice("\137\160\157\x73\x74\x20\x75\162\154\72\40" . $url . "\54\40\150\x74\164\x70\40\x68\x65\x61\x64\145\x72\72\x20" . json_encode($headers, JSON_UNESCAPED_UNICODE)); goto n5foc; VdyzX: if (!$postFields) { goto LCjdc; } goto Fcu0m; iPg4u: curl_close($ch); goto PVvXR; WYMjE: curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 120); goto YGGow; OmRaB: m0ghN: goto rZLwi; rDz_k: curl_setopt($ch, CURLOPT_FORBID_REUSE, FALSE); goto nopZQ; n5foc: curl_setopt($ch, CURLOPT_HTTPHEADER, $headers); goto wbVNO; nopZQ: curl_setopt($ch, CURLOPT_POST, TRUE); goto TwrLW; TwrLW: if (!$headers) { goto w2zg7; } goto B5sju; ZV40C: return $jsonObj; goto erQzs; rZLwi: Log::notice("\137\x70\x6f\163\164\x20\x75\x72\x6c\72\x20" . $url . "\x2c\x20\162\x65\x73\160\x6f\156\163\x65\x20\x72\145\x73\165\x6c\x74\72\40" . $result); goto EainW; nwb8K: Log::notice("\137\x70\x6f\163\164\x20\x75\x72\154\x3a\40" . $url . "\x2c\40\x68\164\164\160\40\150\145\x61\x64\145\x72\x3a\x20" . json_encode($headers, JSON_UNESCAPED_UNICODE) . "\54\x20\x70\157\x73\164\40\143\x6f\x6e\x74\145\x6e\164\72\40" . is_array($postFields) ? json_encode($postFields, JSON_UNESCAPED_UNICODE) : $postFields); goto cQQma; S_sSn: $errCode = curl_errno($ch); goto kZ26M; YnsWa: wexception("\137\x70\x6f\x73\164\54\40\x68\x74\164\160\40\143\x6f\x64\x65\40{$httpCode}\54\40{$result}\54\x20\x75\x72\x6c\x3a\x20" . $url); goto MpXGM; MpXGM: Ck3R3: goto KtTS0; ywq0e: LCjdc: goto nwb8K; aaxil: Log::error("\137\x70\x6f\x73\164\x2c\40\150\164\x74\160\x20\143\157\x64\145\x20{$httpCode}\x2c\40{$result}\54\40\x75\162\154\x3a\40" . $url); goto YnsWa; ncQ0O: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto rqRpC; rqRpC: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE); goto WYMjE; fA0Ag: wexception("\x5f\160\157\163\x74\x2c\40\x66\141\151\x6c\x65\144\40\x74\157\40\143\x75\162\154\x5f\145\170\145\x63\54\40{$errCode}\54\x20{$errMsg}\54\x20\165\162\154\x3a\40" . $url); goto OmRaB; QladU: if ($result) { goto m0ghN; } goto S_sSn; CAPRu: if ($jsonObj) { goto JvUj1; } goto BkQh8; ZIeEn: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto rDz_k; sNCqk: JvUj1: goto ZV40C; KtTS0: $jsonObj = json_decode($result, true); goto CAPRu; x4Ff1: Log::error("\x5f\x70\157\x73\164\x2c\x20\146\x61\x69\154\145\x64\40\164\157\x20\143\165\x72\x6c\x5f\x65\x78\x65\x63\x2c\40{$errCode}\x2c\40{$errMsg}\x2c\40\165\162\154\72\x20" . $url); goto fA0Ag; YGGow: curl_setopt($ch, CURLOPT_TIMEOUT, 120); goto ZIeEn; PVvXR: if (!($httpCode != "\x32\60\x30")) { goto Ck3R3; } goto aaxil; cQQma: $result = curl_exec($ch); goto QladU; n4gjc: wexception("\137\x70\x6f\x73\164\x2c\x20\x66\x61\151\154\145\144\x20\164\x6f\x20\152\163\x6f\x6e\x5f\144\x65\x63\157\x64\145\72\x20" . $result . "\54\40\165\162\154\x3a\x20" . $url); goto sNCqk; EainW: $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); goto iPg4u; h3I6Z: curl_setopt($ch, CURLOPT_URL, $url); goto fHsze; erQzs: } }
