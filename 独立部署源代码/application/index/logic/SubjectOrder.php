<?php
 namespace app\index\logic; use think\Log; use think\Db; use app\index\logic\Subject as SubjectLogic; use app\index\logic\SurveyOrganization as SurveyOrganizationLogic; class SubjectOrder extends Base { public function loadOrders($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '', $customer_id = 0, $subject_id = 0, $combination_id = 0, $survey_id = 0, $survey_organization_id = 0) { goto D3e_D; exBXU: $customerIds = Db::table("\143\165\163\164\x6f\x6d\145\162")->where("\162\145\x61\154\137\x6e\x61\x6d\145", "\x6c\x69\153\145", "\45{$search["\162\x65\x61\x6c\x5f\x6e\141\155\x65"]}\45")->column("\x69\144"); goto Pfm79; Decm_: eaC1N: goto xDSYs; Pfm79: if (!empty($customerIds)) { goto J2_7p; } goto iaU9n; ZSEN5: if ($orderIds) { goto DMdkb; } goto jCKHk; raOWm: $order .= "\x4f\56\x6f\162\144\145\x72\x5f\164\x69\x6d\145\x20\144\x65\x73\x63"; goto BEB3k; HObQ1: if (!empty($customerIds)) { goto lBt5j; } goto eOUgV; AsQVH: $order .= "\54"; goto Z1TCC; xDSYs: $orderIds = Db::table("\x73\165\162\x76\x65\x79\x5f\x6f\162\x64\145\x72")->where("\x73\165\x72\166\145\171\137\151\144", $survey_id)->column("\x69\144"); goto ZSEN5; gDKa1: $order .= "\x2c"; goto e3TNA; NwgD6: lC241: goto HJIhK; UJj4Q: if ($orderIds) { goto HP6kM; } goto ufRaD; A8GlZ: P3GDl: goto Byjdu; e3TNA: RHO8g: goto NLdp8; MrG6w: $where["\117\x2e\143\x75\163\x74\157\x6d\145\x72\137\x69\x64"] = ["\151\x6e", $customerIds]; goto FeIsJ; HGYUN: $where["\117\56\x73\x75\162\x76\x65\171\137\157\162\144\x65\162\137\x69\x64"] = ["\151\156", $orderIds]; goto fAfjn; wGx0R: $where["\117\56\167\141\162\x6e\x69\x6e\x67\137\x6c\x65\166\x65\x6c"] = $search["\x77\x61\162\156\151\x6e\147\x5f\154\x65\166\145\154"]; goto ZkOw_; u7wN2: $orderIds = Db::table("\x73\165\x72\166\x65\x79\x5f\157\162\144\145\162")->where(["\x73\165\x72\x76\145\171\x5f\151\144" => $survey_id, "\x73\x75\x72\x76\x65\171\x5f\157\162\x67\141\x6e\x69\x7a\x61\x74\x69\157\x6e\x5f\x69\x64" => $survey_organization_id])->column("\151\144"); goto UJj4Q; Gj4tR: $where["\117\56\x73\x75\x62\152\145\143\164\x5f\151\x64"] = $search["\163\165\x62\x6a\x65\x63\164\x5f\151\x64"]; goto nJA3L; FeIsJ: LWl90: goto SGHtu; uMKp9: RWWU4: goto GbFLc; ayH7c: return json([]); goto j5uM4; yLKqQ: $order .= "\54"; goto eub29; ZkOw_: liPOa: goto LKAjS; uxPBZ: HP6kM: goto HGYUN; YcD7t: if (!(isset($search["\x6f\162\144\145\x72\x5f\x6e\x6f"]) && $search["\157\x72\144\x65\162\x5f\156\x6f"])) { goto E696l; } goto FzcbP; sV1HN: if (!($survey_id && $survey_organization_id)) { goto D5j62; } goto u7wN2; bmFIr: $order .= "\x4f\x2e\163\x75\162\166\x65\171\x5f\x6f\x72\144\x65\x72\x5f\x69\x64\x20\144\145\x73\143"; goto uMKp9; d20N1: t40mi: goto mi6Rb; BEB3k: $total = Db::table("\163\165\x62\152\x65\x63\164\x5f\x6f\x72\x64\x65\162")->alias("\x4f")->where($where)->count(); goto H4CnE; xsdqG: $orderIds = Db::table("\x63\x6f\x6d\x62\151\156\x61\x74\151\x6f\156\137\x6f\162\x64\145\162")->where("\x63\x6f\155\142\x69\156\141\x74\x69\x6f\156\137\151\144", $combination_id)->column("\x69\x64"); goto cKy1g; QM8J6: UJMi9: goto e0MkI; fB_TD: DMdkb: goto kLLrS; epTp3: return json([]); goto vIPl0; jC3r3: J2_7p: goto VAJG9; WR0pg: $combinations = []; goto KmOl1; WxN2T: gHLSO: goto FjnXh; Z1TCC: O8166: goto bmFIr; nOfls: goto k5yVN; goto Decm_; NP2Lu: wSZRd: goto tTNhj; Byjdu: goto R81ri; goto P47hP; cUqV_: if (!(isset($search["\163\164\x61\164\165\163"]) && $search["\x73\x74\141\x74\165\x73"] !== '')) { goto e7boW; } goto ZP0I7; nJA3L: wSAcp: goto vOmPe; HJIhK: if (!(isset($search["\x63\150\141\156\x6e\x65\154\137\151\144"]) && $search["\x63\x68\x61\156\x6e\x65\154\x5f\151\x64"])) { goto gHLSO; } goto E7juB; NLdp8: $order .= "\117\56\x63\x62\x5f\157\162\x64\x65\x72\137\151\x64\40\144\x65\x73\x63"; goto gEPEn; tJ6vA: E696l: goto u910o; iaU9n: return json([]); goto jC3r3; DJ_7P: $order = ''; goto D5Url; X4hf0: $surveies = []; goto QM8J6; Af_qt: $items = Db::table("\x73\x75\142\152\x65\x63\x74\x5f\157\x72\144\x65\162")->alias("\x4f")->join("\163\x75\x62\152\145\143\164\40\123", "\x4f\x2e\x73\x75\142\152\145\143\164\137\x69\x64\75\123\56\x69\x64", "\114\105\x46\124")->join("\143\165\x73\164\157\x6d\x65\x72\40\103", "\x4f\x2e\x63\165\163\x74\157\155\145\162\x5f\151\144\x3d\x43\x2e\151\144", "\x4c\x45\x46\124")->join("\143\x6f\x6d\142\151\x6e\141\x74\x69\157\156\x5f\157\162\144\x65\162\40\103\x4f", "\117\x2e\x63\142\137\x6f\162\144\145\x72\137\151\x64\75\103\117\x2e\151\144", "\114\105\x46\124")->join("\x73\165\162\x76\x65\x79\137\x6f\162\144\145\x72\x20\x53\x4f", "\117\x2e\x73\165\162\x76\x65\x79\x5f\x6f\x72\x64\x65\x72\x5f\151\x64\x3d\x53\x4f\x2e\151\x64", "\114\105\106\124")->where($where)->field("\x4f\56\157\x72\144\145\x72\137\x6e\157\x2c\40\117\56\143\165\163\x74\x6f\155\x65\162\x5f\x69\144\54\40\x4f\x2e\163\165\x62\x6a\145\143\164\137\151\144\x2c\x20\x4f\56\x6f\x72\144\145\x72\137\141\x6d\157\x75\x6e\164\54\x20\117\56\x6f\162\144\x65\162\x5f\164\151\x6d\x65\x2c\x20\x4f\x2e\146\x69\x6e\x69\163\150\x5f\x74\x69\x6d\x65\x2c\x20\xd\12\x20\40\x20\40\40\40\x20\x20\x20\40\40\x20\x20\x20\40\x20\x4f\56\x74\x65\x73\x74\x5f\151\x74\x65\155\163\x2c\40\x4f\x2e\x74\157\x74\141\x6c\137\x69\x74\145\x6d\x73\54\40\x4f\56\146\x69\156\151\x73\150\x65\144\54\40\x4f\x2e\x70\141\x79\137\x73\x74\141\164\165\163\x2c\40\x4f\x2e\143\150\141\x6e\x6e\145\x6c\137\x69\144\x2c\x20\x4f\56\167\x61\162\156\151\x6e\147\x5f\154\145\166\145\x6c\54\xd\12\40\x20\x20\40\40\x20\40\x20\40\40\40\40\40\x20\x20\40\117\x2e\143\142\x5f\157\x72\x64\145\162\137\151\x64\x2c\x20\117\x2e\163\165\162\166\145\x79\137\157\162\x64\x65\162\x5f\x69\x64\54\xd\12\40\x20\x20\40\40\x20\x20\40\40\x20\x20\x20\x20\x20\40\40\123\x2e\x6e\x61\155\x65\x20\x61\163\x20\163\x75\x62\x6a\145\x63\164\137\156\x61\x6d\145\x2c\40\15\12\x20\x20\x20\40\x20\40\40\x20\x20\x20\x20\40\x20\40\x20\x20\103\56\156\151\x63\153\156\141\155\x65\54\40\103\56\x72\145\x61\x6c\137\156\x61\x6d\145\54\40\103\56\x63\x6f\155\160\x61\156\171\x2c\15\xa\40\x20\x20\40\x20\x20\x20\40\x20\x20\40\x20\40\x20\x20\40\x43\x4f\x2e\143\x6f\x6d\142\x69\x6e\141\x74\x69\157\156\137\x69\x64\54\15\12\x20\x20\40\x20\x20\x20\40\x20\x20\x20\x20\x20\x20\40\40\40\x43\117\56\146\151\x6e\x69\163\x68\x65\144\x20\141\163\x20\x63\x6f\155\x62\151\x6e\x61\164\151\157\156\137\157\162\144\145\x72\137\146\151\156\151\163\x68\x65\x64\54\15\xa\x20\40\40\x20\x20\40\x20\x20\x20\x20\x20\x20\x20\x20\40\40\x53\117\56\x73\x75\x72\166\x65\171\137\151\144\x2c\15\xa\x20\40\40\x20\x20\40\x20\40\40\40\40\x20\40\x20\40\x20\x53\117\x2e\x66\x69\x6e\151\163\150\x65\144\x20\141\163\40\163\x75\x72\166\145\171\137\x6f\162\144\x65\162\137\x66\x69\x6e\x69\163\150\x65\144\x2c\40\x53\117\x2e\x70\145\x72\163\157\x6e\141\x6c\137\x64\x61\164\x61\x20\x61\163\40\x73\x75\162\x76\145\x79\137\160\145\162\163\x6f\x6e\141\154\x5f\144\x61\x74\x61")->page($page, $rows)->order($order)->select(); goto EHvCD; xokVV: if (!$order) { goto O8166; } goto AsQVH; FzcbP: $where["\x4f\56\x6f\162\x64\x65\162\x5f\x6e\x6f"] = $search["\157\x72\x64\x65\162\x5f\156\157"]; goto tJ6vA; DIRV0: lBt5j: goto MrG6w; IOw8p: if (!empty($combinations)) { goto kP1tn; } goto WR0pg; uSGnt: GRZa5: goto rP63y; kLLrS: $where["\x4f\x2e\163\x75\x72\x76\x65\x79\x5f\157\162\144\145\x72\137\151\144"] = ["\x69\x6e", $orderIds]; goto me5c_; p9X5i: if (!(isset($search["\163\165\x62\x6a\145\x63\x74\x5f\x69\144"]) && $search["\x73\165\142\152\145\x63\x74\137\x69\144"])) { goto wSAcp; } goto Gj4tR; nqMOf: if (!$order) { goto RHO8g; } goto gDKa1; MohRD: if (!(isset($search["\156\x69\143\153\x6e\141\x6d\x65"]) && $search["\x6e\x69\x63\x6b\156\x61\155\145"])) { goto LWl90; } goto RhvM9; j5uM4: lxItx: goto Af_qt; SGHtu: if (!(isset($search["\x72\145\141\154\137\156\x61\x6d\x65"]) && $search["\x72\x65\141\x6c\x5f\156\141\155\x65"])) { goto P3GDl; } goto exBXU; cKy1g: if ($orderIds) { goto VfPDN; } goto epTp3; eOUgV: return json([]); goto DIRV0; JOlkw: $where["\x4f\56\143\165\163\164\157\x6d\145\x72\x5f\x69\x64"] = $customer_id; goto OwwC1; Pra4Z: $where["\x4f\56\x63\x62\137\157\x72\x64\x65\x72\137\151\144"] = ["\x69\156", $orderIds]; goto ykPGa; e0MkI: foreach ($items as $k => $v) { goto B1I8O; V4bIF: ftQBE: goto qdfgn; IZpXS: if (empty($v["\163\165\162\166\x65\x79\137\x70\145\162\163\x6f\x6e\141\x6c\x5f\x64\141\164\141"])) { goto KIx0z; } goto vOUQg; LuY1P: Tednp: goto EuBvg; mooO1: aDSnY: goto FR119; Eqi1o: G_rda: goto dpt9R; dpt9R: $items[$k]["\x73\x75\162\x76\x65\x79\x5f\160\145\x72\x73\157\156\x61\x6c\137\144\x61\164\141"] = implode("\74\142\162\57\76", array_values($personalData)); goto eZW28; eZW28: goto Woa_j; goto VqKWl; utIgJ: goto Tednp; goto V4bIF; qlD4F: $personalData["\x6f\x72\147\x61\156\x69\x7a\x61\x74\151\x6f\x6e"] = SurveyOrganizationLogic::I()->loadFullText($personalData["\x6f\x72\x67\x61\x6e\x69\172\x61\x74\x69\x6f\156"], ''); goto Eqi1o; B1I8O: $items[$k]["\143\x61\x74\145\147\157\x72\x79\137\156\141\x6d\145"] = SubjectLogic::I()->getCategoryNameStr($v["\x73\165\142\152\145\x63\164\x5f\151\x64"]); goto EjGU2; cX2Pu: $items[$k]["\x62\x65\x6c\157\x6e\x67\x73\137\164\x6f"] = $combinations[$items[$k]["\x63\157\155\x62\151\x6e\141\x74\x69\157\156\137\151\144"]] ?? ''; goto PhlHV; WMR7k: Woa_j: goto mooO1; NAYxv: if ($items[$k]["\x63\x6f\155\x62\151\156\x61\x74\151\x6f\156\x5f\151\x64"]) { goto xahki; } goto smvI7; vOUQg: $personalData = json_decode($items[$k]["\163\x75\162\166\145\x79\137\x70\x65\162\163\157\156\x61\154\x5f\144\x61\x74\141"], true); goto AIa5x; qkDyL: $items[$k]["\164\x69\155\145\x5f\x63\x6f\163\164"] = $v["\157\162\144\x65\x72\137\x74\x69\155\x65"] . "\40\57\x20\74\x73\x74\162\x6f\156\147\76\xe6\234\252\xe5\xae\214\346\210\220\74\57\163\164\162\x6f\x6e\x67\76"; goto utIgJ; Ubpmh: $personalData["\163\145\170"] = $personalData["\x73\145\x78"] == 1 ? "\347\x94\xb7" : "\xe5\xa5\263"; goto SD4Lp; PhlHV: a92zx: goto cTjCh; N7sUg: $items[$k]["\142\145\x6c\157\x6e\147\163\137\x74\x6f"] = $surveies[$items[$k]["\163\165\162\166\x65\x79\x5f\x69\x64"]] ?? ''; goto jf2b3; ksFIH: goto a92zx; goto Qongp; PDRkE: $items[$k]["\163\165\x72\x76\145\171\x5f\160\x65\162\163\157\156\x61\x6c\x5f\144\x61\164\141"] = $items[$k]["\156\151\143\x6b\156\x61\x6d\x65"]; goto WMR7k; adAsG: if (!isset($personalData["\x6f\x72\x67\141\x6e\x69\172\141\x74\x69\x6f\x6e"])) { goto G_rda; } goto qlD4F; AIa5x: if (!isset($personalData["\163\x65\x78"])) { goto R6RMR; } goto Ubpmh; cTjCh: $items[$k]["\143\157\x6d\x70\x6c\145\x74\151\157\156"] = floor($v["\164\x65\163\164\x5f\x69\164\145\155\x73"] / $v["\164\x6f\164\141\x6c\x5f\x69\x74\145\155\x73"] * 100) . "\45"; goto t1qpB; t1qpB: kn6k2: goto yqfk3; Qongp: xahki: goto cX2Pu; VqKWl: KIx0z: goto PDRkE; smvI7: if (!$items[$k]["\163\165\162\166\x65\x79\x5f\x69\x64"]) { goto k8W1N; } goto N7sUg; qdfgn: $items[$k]["\164\x69\155\x65\137\x63\x6f\163\x74"] = $v["\x6f\162\x64\x65\162\137\164\x69\155\x65"] . "\x20\57\x20\74\163\164\x72\x6f\x6e\x67\76" . round((strtotime($v["\146\x69\156\151\x73\x68\x5f\x74\x69\155\x65"]) - strtotime($v["\157\x72\x64\145\x72\x5f\164\151\x6d\145"])) / 60, 2) . "\x3c\57\163\164\162\x6f\156\147\x3e"; goto LuY1P; EuBvg: if (!$survey_id) { goto aDSnY; } goto IZpXS; EjGU2: if ($v["\146\151\156\151\x73\x68\x5f\x74\151\155\x65"]) { goto ftQBE; } goto qkDyL; FR119: $items[$k]["\142\x65\154\157\156\147\x73\x5f\164\157"] = ''; goto NAYxv; SD4Lp: R6RMR: goto adAsG; jf2b3: k8W1N: goto ksFIH; yqfk3: } goto NP2Lu; GbFLc: if (!$order) { goto AoMdV; } goto yLKqQ; ufRaD: return json([]); goto uxPBZ; H4CnE: if (!empty($total)) { goto lxItx; } goto ayH7c; KmOl1: kP1tn: goto A5u4A; u910o: if ($subject_id) { goto t40mi; } goto p9X5i; A5u4A: $surveies = Db::table("\163\x75\162\x76\x65\171")->column("\x6e\141\x6d\145", "\151\144"); goto nQl9d; eub29: AoMdV: goto raOWm; q_coA: e7boW: goto M7W0q; VAJG9: $where["\117\56\143\165\163\x74\157\x6d\x65\x72\137\151\144"] = ["\x69\156", $customerIds]; goto A8GlZ; LKAjS: if ($customer_id) { goto uVMGy; } goto MohRD; M7W0q: if (!(isset($search["\160\x61\x79\137\163\x74\141\164\165\163"]) && $search["\160\x61\171\137\x73\x74\141\x74\x75\x73"])) { goto GRZa5; } goto p5b2w; ZsfQr: if ($survey_id && empty($survey_organization_id)) { goto eaC1N; } goto sV1HN; vOmPe: goto lC241; goto d20N1; OwwC1: R81ri: goto cUqV_; me5c_: k5yVN: goto DJ_7P; ZP0I7: $where["\117\x2e\x66\x69\x6e\151\163\150\145\144"] = $search["\163\x74\141\164\165\x73"]; goto q_coA; rP63y: if (!$combination_id) { goto WW9QW; } goto xsdqG; mi6Rb: $where["\117\56\163\165\142\x6a\145\143\164\x5f\151\x64"] = $subject_id; goto NwgD6; FjnXh: if (!(isset($search["\167\141\x72\156\151\156\147\x5f\154\x65\x76\x65\x6c"]) && $search["\167\x61\162\156\151\x6e\x67\x5f\154\x65\x76\145\154"] !== '')) { goto liPOa; } goto wGx0R; vIPl0: VfPDN: goto Pra4Z; P47hP: uVMGy: goto JOlkw; nQl9d: if (!empty($surveies)) { goto UJMi9; } goto X4hf0; p5b2w: $where["\117\56\x70\141\171\137\x73\164\141\x74\x75\163"] = $search["\160\x61\x79\137\163\x74\141\x74\x75\x73"]; goto uSGnt; EHvCD: $combinations = Db::table("\163\165\142\x6a\x65\143\164\x5f\143\157\155\142\151\x6e\141\x74\x69\x6f\x6e")->column("\156\x61\155\x65", "\151\x64"); goto IOw8p; D5Url: if (!$combination_id) { goto gbKFO; } goto nqMOf; jCKHk: return json([]); goto fB_TD; RhvM9: $customerIds = Db::table("\143\x75\x73\164\x6f\155\x65\x72")->where("\x6e\151\x63\153\x6e\141\155\145", "\x6c\x69\x6b\145", "\x25{$search["\x6e\151\x63\153\156\x61\x6d\x65"]}\45")->column("\x69\144"); goto HObQ1; fAfjn: D5j62: goto nOfls; ykPGa: WW9QW: goto ZsfQr; LTeLt: if (!$survey_id) { goto RWWU4; } goto xokVV; E7juB: $where["\x4f\56\143\x68\x61\156\156\x65\154\x5f\151\144"] = $search["\x63\x68\x61\156\156\145\154\137\x69\x64"]; goto WxN2T; gEPEn: gbKFO: goto LTeLt; tTNhj: return ["\164\x6f\164\141\x6c" => $total, "\x72\x6f\167\x73" => $items]; goto daztH; D3e_D: $where = []; goto YcD7t; daztH: } }
