<?php
 namespace app\index\logic; use app\index\model\Setting; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\index\logic\Defs as IndexDefs; class Sms extends Base { public function sendCaptcha($tel, $len = 6, $id = '') { goto B0aZQ; lakJp: HpPRg: goto UR3f4; LmWAm: if (!($i < $len)) { goto L4jTK; } goto YGk1R; QVVRm: if ($result) { goto w_ht8; } goto fsbK3; FK51Y: exception("\345\217\x91\xe9\200\201\350\277\x87\344\xba\x8e\xe9\242\221\347\271\x81\357\274\214\350\xaf\267\347\xa8\x8d\xe5\x80\x99\345\x86\x8d\350\257\225"); goto lakJp; IrdIc: exception("\xe6\211\213\346\234\272\xe5\x8f\267\347\xa0\x81\xe6\x97\240\346\225\210"); goto DTuMV; G1NJT: if (!empty($TemplateCode)) { goto Oa3kq; } goto R6NUI; LjtvM: $result = $this->send($TemplateCode, $TemplateParam, $tel); goto QVVRm; it667: return true; goto xCePz; hE8mV: $sessionTimestamp = Session::get("\103\x41\x50\124\x43\110\101\137\124\x49\115\105\123\x54\x41\115\x50\x5f" . $id); goto jLGnn; rElry: w_ht8: goto b6cgV; B0aZQ: if (validateMobile($tel)) { goto e1Hya; } goto IrdIc; xAcsW: $code = "\x31\x31\x31\61\x31\x31"; goto i3qPa; jLGnn: if (!($sessionTimestamp && $now >= $sessionTimestamp && $now - $sessionTimestamp < 30)) { goto HpPRg; } goto FK51Y; VAR9l: uD9bT: goto LmWAm; DTuMV: e1Hya: goto tEtDh; uZMY4: $TemplateCode = systemSetting("\101\x4c\x49\x59\125\116\137\123\115\x53\137\103\101\x50\124\x43\110\101\x5f\124\x45\x4d\x50\114\x41\x54\x45"); goto G1NJT; togU1: $i = 0; goto pOcZK; qHqq4: Session::set("\x43\101\120\x54\x43\x48\101\x5f" . $id, $code); goto it667; SnLNa: Session::set("\103\101\x50\124\103\110\x41\137\115\x4f\102\111\x4c\105\x5f" . $id, $tel); goto qHqq4; i3qPa: NDqeT: goto LUln3; g2Baw: goto uD9bT; goto oMLGY; fsbK3: exception("\347\237\255\344\xbf\241\345\217\221\351\x80\x81\350\260\203\xe7\x94\xa8\345\244\xb1\xe8\xb4\245"); goto rElry; YGk1R: $code .= $chars[rand(0, $len - 1)]; goto L6k0z; g08KV: MmjN3: goto xAcsW; IOYTi: $chars = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]; goto togU1; oMLGY: L4jTK: goto MjYDa; UR3f4: if ($tel == "\61\63\x35\x31\60\x31\x30\x35\70\x35\x38") { goto MmjN3; } goto IOYTi; b6cgV: goto NDqeT; goto g08KV; pOcZK: $code = ''; goto VAR9l; L6k0z: $i++; goto g2Baw; uGtMm: Oa3kq: goto LjtvM; LUln3: Session::set("\x43\x41\120\x54\x43\x48\101\137\x54\x49\x4d\x45\x53\124\x41\115\120\x5f" . $id, time()); goto SnLNa; tEtDh: $now = time(); goto hE8mV; MjYDa: $TemplateParam = json_encode(["\156\x75\155\x62\145\162" => $code], JSON_UNESCAPED_UNICODE); goto uZMY4; R6NUI: exception("\347\237\255\344\277\241\xe6\xa8\xa1\346\x9d\277\346\x9c\xaa\xe9\205\215\347\xbd\xae"); goto uGtMm; xCePz: } public function verifyCaptcha($mobile, $code, $id = '') { goto InOMu; bL15O: Session::delete("\103\x41\120\x54\x43\x48\x41\x5f\124\x49\115\x45\123\124\x41\x4d\x50\137" . $id); goto k1wwj; Vb5OS: $sessionMobile = Session::get("\103\x41\x50\124\x43\x48\101\x5f\115\x4f\x42\111\x4c\105\x5f" . $id); goto CwL21; shigQ: uBxNu: goto oboJL; k1wwj: return true; goto sSc5Y; CwL21: $sessionTimestamp = Session::get("\x43\101\x50\124\103\110\101\x5f\124\111\x4d\x45\123\124\101\115\x50\x5f" . $id); goto lZqeO; lZqeO: if (!(empty($sessionCode) || empty($sessionMobile) || empty($sessionTimestamp))) { goto uBxNu; } goto k66hk; mB8pP: if (!($sessionCode == $code && $sessionMobile == $mobile)) { goto sziel; } goto CWFB8; d7lTe: Session::delete("\x43\x41\120\x54\103\x48\101\137\124\111\115\105\x53\124\101\x4d\x50\137" . $id); goto xEjQG; gfH8Q: if (!($now >= $sessionTimestamp && $now - $sessionTimestamp > 120)) { goto sq155; } goto z1Dpr; InOMu: $sessionCode = Session::get("\x43\x41\x50\x54\103\110\101\x5f" . $id); goto Vb5OS; Kl0Sn: Session::delete("\x43\101\x50\124\103\x48\101\x5f\115\117\102\111\114\105\137" . $id); goto bL15O; z1Dpr: Session::delete("\x43\x41\120\x54\x43\x48\x41\x5f" . $id); goto yUyeu; k66hk: return false; goto shigQ; s3zM_: return false; goto zK7Er; oboJL: $now = time(); goto gfH8Q; sSc5Y: sziel: goto s3zM_; yUyeu: Session::delete("\103\x41\x50\x54\x43\x48\x41\137\x4d\117\x42\x49\x4c\x45\137" . $id); goto d7lTe; s9X1F: sq155: goto mB8pP; CWFB8: Session::delete("\x43\x41\120\124\103\110\101\x5f" . $id); goto Kl0Sn; xEjQG: return false; goto s9X1F; zK7Er: } public function sendAppoitOrderToExpert($tel, $time) { goto mGMhN; SW0Np: if ($result) { goto BjYUL; } goto HwE4Y; LikCB: $TemplateCode = systemSetting("\101\114\x49\131\x55\x4e\x5f\x53\115\x53\137\101\x50\120\117\x49\116\124\x5f\x54\x4f\137\x45\130\x50\105\x52\124\137\124\x45\115\120\114\101\124\x45"); goto tdtxZ; HwE4Y: return false; goto Z_Zis; HiSKk: return true; goto fcrG8; mGMhN: if (validateMobile($tel)) { goto ivnXU; } goto O92DR; wuMd0: Log::notice("\163\x65\156\x64\x20\x61\x70\160\x6f\x69\x6e\x74\40\x6f\x72\x64\145\x72\40\163\x6d\163\x20\164\157\40\145\170\160\145\x72\x74\x3a\x20" . $tel); goto Bh0zZ; tdtxZ: if (!empty($TemplateCode)) { goto TD_2s; } goto PDRIc; Bh0zZ: $result = $this->send($TemplateCode, $TemplateParam, $tel); goto SW0Np; uuOIM: ivnXU: goto PRqHz; O92DR: return false; goto uuOIM; EOkx9: TD_2s: goto wuMd0; Z_Zis: BjYUL: goto HiSKk; PRqHz: $TemplateParam = json_encode(["\164\151\155\145" => $time], JSON_UNESCAPED_UNICODE); goto LikCB; PDRIc: return false; goto EOkx9; fcrG8: } public function sendAppoitOrderToSupport($tel, $time) { goto hKhun; TPUJp: Log::notice("\x73\145\156\x64\x20\141\160\x70\157\x69\x6e\164\x20\x6f\x72\x64\145\x72\40\x73\x6d\x73\40\164\157\x20\163\165\160\160\x6f\x72\164\x3a\40" . $tel); goto iyGjP; pevTO: EYwNS: goto ARDbQ; uh9s2: return false; goto ghWaI; TDj0z: if ($result) { goto yopfw; } goto uh9s2; X4dVR: xAUBL: goto TPUJp; hKhun: if (validateMobile($tel)) { goto EYwNS; } goto Dm2bA; yFG81: return true; goto QJnqn; ghWaI: yopfw: goto yFG81; ARDbQ: $TemplateParam = json_encode(["\164\x69\155\x65" => $time], JSON_UNESCAPED_UNICODE); goto pyddB; ojlwR: return false; goto X4dVR; iyGjP: $result = $this->send($TemplateCode, $TemplateParam, $tel); goto TDj0z; pyddB: $TemplateCode = systemSetting("\101\x4c\x49\131\125\x4e\x5f\x53\x4d\x53\x5f\x41\120\x50\x4f\x49\116\124\x5f\x54\117\137\123\x55\x50\120\117\122\x54\x5f\x54\x45\x4d\120\114\101\x54\105"); goto p1r9O; p1r9O: if (!empty($TemplateCode)) { goto xAUBL; } goto ojlwR; Dm2bA: return false; goto pevTO; QJnqn: } public function sendAppoitOrderToCustomer($tel, $time, $addr) { goto By70D; iZ6df: YGeKh: goto SAx29; pGBbn: return false; goto UPOp4; UPOp4: re3dy: goto tgium; HJRL0: if ($result) { goto ITvUE; } goto JzXOZ; i1KCz: $TemplateCode = systemSetting("\101\114\x49\x59\125\116\137\123\x4d\123\x5f\101\120\x50\117\x49\116\x54\x5f\124\117\x5f\103\125\x53\x54\x4f\x4d\x45\x52\x5f\x54\105\115\x50\x4c\101\124\x45"); goto C15Yr; Eqvjj: ITvUE: goto Zr0Gd; By70D: if (validateMobile($tel)) { goto YGeKh; } goto m8fiN; SAx29: $TemplateParam = json_encode(["\164\151\155\x65" => $time, "\141\144\144\162\x65\163\163" => $addr], JSON_UNESCAPED_UNICODE); goto i1KCz; C15Yr: if (!empty($TemplateCode)) { goto re3dy; } goto pGBbn; tgium: Log::notice("\163\145\156\144\x20\x61\160\x70\x6f\x69\x6e\164\40\x6f\162\144\x65\x72\x20\163\155\163\x20\x74\x6f\40\143\165\163\x74\157\155\145\162\x3a\x20" . $tel); goto rcsvG; rcsvG: $result = $this->send($TemplateCode, $TemplateParam, $tel); goto HJRL0; m8fiN: return false; goto iZ6df; Zr0Gd: return true; goto iZVgx; JzXOZ: return false; goto Eqvjj; iZVgx: } private function send($TemplateCode, $TemplateParam, $phoneNumber) { goto gPEZC; bF9HJ: return false; goto G0_jd; mQpp6: return true; goto RDIup; nPldY: $stringToSign = "\107\105\124\46" . $this->encode("\57") . "\x26" . $this->encode(substr($sortedQueryStringTmp, 1)); goto XO_kD; XH8In: $url = "\x68\164\164\x70\x73\x3a\x2f\x2f\x64\x79\x73\x6d\163\x61\160\151\56\x61\x6c\151\x79\165\x6e\143\163\56\x63\x6f\155\x2f\77\x53\151\147\156\141\x74\165\x72\x65\75{$Signature}{$sortedQueryStringTmp}"; goto W1_F2; ApBMZ: $Format = "\x6a\x73\157\156"; goto nLZbD; MIdwW: foreach ($params as $key => $value) { $sortedQueryStringTmp .= "\x26" . $this->encode($key) . "\75" . $this->encode($value); ykijs: } goto gEuC6; Cwpr2: return false; goto aZrnj; LFwkX: $params["\x53\151\147\x6e\141\164\x75\162\x65"] = $Signature; goto XH8In; h9BjB: if (!(isset($responseObj["\103\157\x64\145"]) && $responseObj["\103\x6f\x64\145"] == "\117\113")) { goto Z6AKy; } goto S9ufi; Z6H_e: $SignatureMethod = "\110\115\101\x43\x2d\123\x48\101\61"; goto F1Y1x; RDIup: Z6AKy: goto lSdiR; XO_kD: $sign = base64_encode(hash_hmac("\163\150\x61\61", $stringToSign, $AccessKeySecret . "\46", true)); goto Ao7zf; DqBI3: if ($responseContent) { goto o0Ava; } goto D0jo0; d4vfR: ksort($params); goto K8T_v; B1jOU: $Action = "\123\x65\x6e\144\x53\x6d\163"; goto sgWcM; gPEZC: if (validateMobile($phoneNumber)) { goto J0LN1; } goto Lm3Eq; FBn25: J0LN1: goto B1jOU; D0jo0: Log::error("\x66\x61\x69\x6c\145\x64\40\x74\x6f\40\147\145\164\40\x72\145\163\160\157\156\x73\145\x20\146\162\x6f\x6d\40\141\154\x69\x20\x73\155\163\x2c\40\164\145\x6c\72{$phoneNumber}"); goto bF9HJ; aiqc2: if ($responseObj) { goto xA3sr; } goto OO0oN; Lm3Eq: return false; goto FBn25; K8T_v: $sortedQueryStringTmp = ''; goto MIdwW; Ao7zf: $Signature = $this->encode($sign); goto LFwkX; sgWcM: $SignName = systemSetting("\x41\x4c\x49\131\125\116\x5f\123\x4d\x53\137\123\111\107\x4e\116\101\x4d\105"); goto GfCeP; LXCiV: $Timestamp = gmdate("\131\x2d\x6d\55\144\134\124\x48\72\x69\72\x73\x5c\x5a"); goto ApBMZ; OO0oN: Log::error("\x66\141\x69\154\145\x64\40\164\x6f\40\x64\x65\143\157\x64\145\40\141\154\x69\x20\163\x6d\x73\x20\162\145\x73\x70\x6f\156\163\x65\54\40\164\145\154\72{$phoneNumber}\x2c\x20" . $responseContent); goto H6zne; AqtPT: xA3sr: goto h9BjB; AFFei: $params = ["\x50\x68\x6f\156\145\x4e\165\155\142\145\x72\x73" => $phoneNumber, "\123\x69\147\x6e\116\x61\x6d\145" => $SignName, "\x54\x65\155\x70\154\141\164\x65\x43\x6f\144\145" => $TemplateCode, "\x41\143\143\145\x73\163\x4b\145\x79\x49\x64" => $AccessKeyId, "\101\x63\x74\x69\157\x6e" => $Action, "\106\157\x72\x6d\141\x74" => $Format, "\124\145\x6d\x70\x6c\141\x74\145\x50\141\162\141\x6d" => $TemplateParam, "\x53\x69\147\x6e\x61\164\165\162\x65\115\145\164\150\157\144" => $SignatureMethod, "\123\151\147\x6e\141\x74\x75\x72\145\x4e\x6f\x6e\x63\x65" => $SignatureNonce, "\123\151\x67\156\141\164\x75\x72\145\126\145\x72\163\151\x6f\x6e" => $SignatureVersion, "\x54\151\x6d\145\x73\164\x61\x6d\160" => $Timestamp, "\x56\x65\162\x73\x69\x6f\156" => $Version]; goto d4vfR; nLZbD: $Version = "\62\x30\x31\67\55\x30\x35\55\62\x35"; goto AFFei; F1Y1x: $SignatureVersion = "\61\56\60"; goto hB2_4; GfCeP: $AccessKeyId = systemSetting("\x41\x4c\x49\x59\125\116\x5f\123\115\x53\137\101\x43\103\105\123\123\x4b\x45\x59\137\111\104"); goto CXbHa; S9ufi: Log::notice("\x73\165\143\143\x65\163\163\40\x74\157\40\163\x65\x6e\x64\40\155\x65\x73\163\x61\147\145\40\164\x6f\x20\164\x65\154\x3a{$phoneNumber}\x2c\x20\164\145\x6d\x70\154\x61\164\x65\72\40{$TemplateCode}"); goto mQpp6; CXbHa: $AccessKeySecret = systemSetting("\101\114\111\131\125\116\137\123\115\x53\x5f\x41\103\x43\105\x53\x53\x4b\x45\131\137\123\x45\x43\122\105\124"); goto Z6H_e; hB2_4: $SignatureNonce = uniqid(mt_rand(0, 0xffff), true); goto LXCiV; W1_F2: $responseContent = file_get_contents($url); goto DqBI3; H6zne: return false; goto AqtPT; G0_jd: o0Ava: goto wHmRX; wHmRX: $responseObj = json_decode($responseContent, true); goto aiqc2; lSdiR: Log::error("\x66\141\151\154\x65\x64\x20\x74\157\40\x73\x65\x6e\144\40\163\155\163\x20\166\x69\x61\x20\141\x6c\151\x2c\40\164\145\154\x3a{$phoneNumber}\54\x20" . $responseContent); goto Cwpr2; gEuC6: dyPNK: goto nPldY; aZrnj: } private function encode($str) { goto Rguvz; wTbHI: $res = preg_replace("\x2f\134\x2b\57", "\45\x32\60", $res); goto Q1uHg; Rguvz: $res = urlencode($str); goto wTbHI; cD3Oh: $res = preg_replace("\57\x25\67\105\x2f", "\x7e", $res); goto xblMt; xblMt: return $res; goto Qqs6S; Q1uHg: $res = preg_replace("\x2f\x5c\x2a\x2f", "\45\62\101", $res); goto cD3Oh; Qqs6S: } }
