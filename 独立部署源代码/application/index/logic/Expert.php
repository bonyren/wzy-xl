<?php
 namespace app\index\logic; use app\index\logic\Defs as IndexDefs; use app\index\model\Setting; use think\Cache; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\index\logic\Defs; use app\index\service\EventLogs; use app\index\model\Expert as ExpertModel; use app\index\service\RequestContext; use app\index\service\OperationLogs; class Expert extends Base { const AVATAR_DEFAULT_IMAGE = "\57\x73\164\141\x74\151\x63\x2f\151\x6d\x67\57\151\155\141\x67\145\137\x75\x70\154\x6f\x61\144\x2e\160\156\147"; protected function __construct() { parent::__construct(); } public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto IoUj1; jxkz_: foreach ($records as &$record) { goto TCsBr; TCsBr: $record["\x77\157\162\x6b\151\155\x67\137\x75\x72\154"] = generateThumbnailUrl($record["\x77\157\x72\153\151\155\147\137\165\x72\x6c"], 100); goto mFA9U; mFA9U: $record["\146\x69\145\x6c\144\137\x69\x74\145\155\163"] = implode("\x2c", Db::table("\x65\x78\160\145\162\164\x5f\146\x69\145\x6c\x64\x5f\162\x65\x6c\x61\x74\x65")->alias("\105\106\x52")->join("\x65\x78\x70\x65\162\164\137\x66\151\x65\154\x64\137\151\164\x65\155\40\105\106\111", "\x45\106\122\x2e\x66\x69\x65\154\x64\x5f\x69\164\x65\x6d\x5f\151\x64\x3d\x45\106\111\56\151\x64")->where("\105\x46\122\56\145\x78\x70\145\x72\x74\137\x69\x64", $record["\151\144"])->column("\x45\x46\x49\56\x66\151\x65\154\144\x5f\x69\x74\145\155")); goto mtPBj; mtPBj: z4Gxw: goto s2p6O; s2p6O: } goto Flrtg; OCaxR: gjjOc: goto u2kax; uoU2p: tfQ3v: goto kCpgG; HeKUy: goto tfQ3v; goto TbErn; KFus1: if (emptyInArray($search, "\145\170\x70\145\162\x74\137\x69\144")) { goto JK9DI; } goto FvIl9; dhqlD: M3qrK: goto dDZbt; lorV1: Pjjts: goto HeKUy; Ul9aT: if (emptyInArray($search, "\x72\x65\x61\x6c\x5f\x6e\x61\155\145")) { goto o2f_9; } goto RF03z; DaTf2: goto Pjjts; goto OCaxR; JHFMY: o2f_9: goto K4mLy; K4mLy: if (emptyInArray($search, "\143\145\154\154\x70\x68\x6f\x6e\x65")) { goto EGvby; } goto XS7Zg; Rknw3: JK9DI: goto aY_lW; u2kax: $order = "\163\x74\x61\164\165\163\40" . $order; goto lorV1; dDZbt: $totalCount = Db::table("\145\170\x70\145\x72\164")->where($conditions)->count(); goto uu52I; FvIl9: $conditions["\x69\144"] = $search["\x65\170\x70\145\x72\x74\137\151\144"]; goto Rknw3; Flrtg: qNUBo: goto o4SKl; StvqF: $conditions["\x64\145\154\145\x74\x65\x5f\146\x6c\141\x67"] = $search["\144\145\154\145\x74\145\x5f\x66\154\141\147"]; goto dhqlD; Qlgha: $conditions["\x73\164\x61\164\165\x73"] = $search["\x73\x74\x61\x74\x75\163"]; goto TFc64; kCpgG: $conditions = ["\x64\x65\154\x65\164\145\x5f\146\x6c\x61\147" => 0]; goto Ul9aT; RawCU: $order = "\151\144\x20\x61\x73\x63"; goto DaTf2; uu52I: $records = Db::table("\x65\170\160\x65\x72\x74")->where($conditions)->page($page, $rows)->order($order)->field(true)->select(); goto jxkz_; TFc64: HdOoA: goto KFus1; To2Hc: if ($sort == "\x73\x74\x61\x74\x75\x73") { goto gjjOc; } goto RawCU; o4SKl: return ["\164\x6f\164\141\x6c" => $totalCount, "\x72\157\x77\x73" => $records]; goto arNA7; XS7Zg: $conditions["\143\145\x6c\154\x70\150\x6f\156\x65"] = ["\154\x69\x6b\145", "\x25" . $search["\143\145\x6c\154\x70\150\x6f\156\x65"] . "\45"]; goto mvVov; mvVov: EGvby: goto tuDF0; RF03z: $conditions["\162\x65\141\x6c\137\x6e\x61\155\x65"] = ["\x6c\151\153\x65", "\45" . $search["\162\145\141\x6c\x5f\x6e\141\155\x65"] . "\45"]; goto JHFMY; TbErn: GQNVM: goto S10xy; tuDF0: if (emptyInArray($search, "\x73\164\x61\164\165\x73")) { goto HdOoA; } goto Qlgha; aY_lW: if (emptyInArray($search, "\144\x65\154\145\x74\x65\137\x66\x6c\x61\147")) { goto M3qrK; } goto StvqF; S10xy: $order = "\164\x6f\x74\x61\x6c\137\141\x70\x70\157\x69\x6e\x74\x5f\x71\x75\x61\x6e\x74\x69\164\171\x20" . $order; goto uoU2p; IoUj1: if ($sort == "\164\157\164\141\154\137\141\x70\160\157\x69\x6e\164\137\x71\165\141\x6e\164\151\x74\171") { goto GQNVM; } goto To2Hc; arNA7: } public function add($infos) { goto JPo66; H7E9V: if (!(isset($infos["\x66\151\x65\x6c\x64"]) && $infos["\x66\x69\x65\x6c\144"])) { goto IT1On; } goto dKzia; Orowq: return true; goto lAc87; QVXcL: IT1On: goto ZlSNm; VuA6k: $targetIds = $infos["\x74\x61\x72\147\145\x74"]; goto UOMEa; D8d15: $fields = []; goto H7E9V; UOMEa: uxu2j: goto VjiPc; gH46P: if (!(isset($infos["\x74\141\x72\x67\x65\x74"]) && $infos["\x74\x61\162\147\x65\x74"])) { goto uxu2j; } goto VuA6k; O33Z5: $model->allowField(true)->save(); goto neGvb; d0R2Y: $categoryIds = $infos["\x63\x61\x74\145\147\x6f\x72\171"]; goto BP_Xl; lYIaq: Jdj33: goto E2ya_; ozT2K: OperationLogs::I()->expertLog("\xe6\226\260\xe5\xa2\236\344\xb8\x93\xe5\256\266\40\55\40{$model->real_name}", beautifyLogArray($infos, [], "\145\170\x70\x65\162\164"), OperationLogs::OPT_ADD_TYPE, $expertId); goto Orowq; E2ya_: $targetIds = []; goto gH46P; aOHfN: foreach ($categoryIds as $categoryId) { Db::table("\x65\170\160\145\162\164\137\x63\x61\164\x65\x67\x6f\x72\x79\137\162\x65\x6c\x61\164\145")->insert(["\x65\x78\x70\x65\x72\164\137\151\x64" => $expertId, "\x63\141\164\145\147\157\162\x79\x5f\x69\144" => $categoryId]); lQBmz: } goto lYIaq; neGvb: $expertId = $model->id; goto G2XTI; fh_tc: $infos["\x66\x69\x72\x73\164\x5f\152\x6f\142\x5f\164\x69\155\x65"] = !emptyInArray($infos, "\146\151\162\163\x74\x5f\x6a\157\x62\x5f\164\151\155\145") ? $infos["\146\x69\x72\x73\164\x5f\x6a\x6f\x62\137\x74\x69\155\145"] : null; goto PWtt4; BP_Xl: PW3S8: goto aOHfN; VLeo4: if (!(isset($infos["\143\x61\x74\145\x67\x6f\162\x79"]) && $infos["\x63\141\x74\x65\x67\157\162\x79"])) { goto PW3S8; } goto d0R2Y; hTTJf: QbFwp: goto D8d15; G2XTI: $categoryIds = []; goto VLeo4; PWtt4: $model->data($infos); goto O33Z5; VjiPc: foreach ($targetIds as $targetId) { Db::table("\x65\170\x70\145\162\164\137\164\x61\x72\147\145\x74\137\x72\x65\x6c\x61\x74\145")->insert(["\x65\x78\x70\x65\162\x74\x5f\151\x64" => $expertId, "\x74\x61\162\147\x65\164\x5f\x69\144" => $targetId]); iUHVn: } goto hTTJf; JPo66: $model = model("\105\x78\160\x65\162\x74"); goto fh_tc; dKzia: $fields = $infos["\146\x69\x65\x6c\x64"]; goto QVXcL; ZlSNm: foreach ($fields as $fieldId => $fieldItems) { goto QHRZA; QHRZA: foreach ($fieldItems as $fieldItemId) { Db::table("\x65\170\160\145\162\164\x5f\146\151\x65\x6c\144\137\x72\x65\154\x61\x74\x65")->insert(["\x65\170\x70\x65\x72\x74\137\x69\x64" => $expertId, "\146\151\x65\154\x64\x5f\x69\144" => $fieldId, "\x66\x69\x65\154\144\x5f\x69\x74\x65\155\x5f\x69\x64" => $fieldItemId]); XPNEy: } goto astKz; SUwO4: rRJpI: goto fcxo2; astKz: TMwyo: goto SUwO4; fcxo2: } goto SBHe5; SBHe5: iuVib: goto ozT2K; lAc87: } public function edit($expertId, $infos) { goto nCgjV; yXGp_: if (!(isset($infos["\146\151\145\x6c\x64"]) && $infos["\146\x69\x65\x6c\x64"])) { goto AoOG5; } goto aX2w6; XWBqL: NVD1v: goto OVddM; uhPj0: Db::table("\x65\x78\x70\x65\162\x74\x5f\143\141\x74\145\147\157\162\x79\137\162\x65\154\x61\164\145")->where(["\x65\x78\160\x65\x72\x74\x5f\151\x64" => $expertId])->delete(); goto RPzU0; P0ghC: HSeuj: goto cKI3M; aLKT4: $model->allowField(true)->save(); goto ouctO; OVddM: $originals = Db::table("\x65\x78\x70\x65\162\x74")->where(["\151\x64" => $expertId])->field(true)->find(); goto qPPoX; gkbLU: exception("\xe6\227\240\xe6\263\225\xe6\211\276\xe5\x88\260\350\xaf\xa5\344\xb8\x93\xe5\256\266"); goto QcRr_; RQ05h: Zz8mT: goto y_dsc; aX2w6: $fields = $infos["\146\151\145\154\144"]; goto Nrtfc; ZOUch: Db::table("\145\x78\160\145\x72\x74\x5f\146\151\x65\x6c\x64\x5f\x72\145\154\141\164\145")->where(["\x65\170\x70\145\x72\164\137\x69\144" => $expertId])->delete(); goto DF4Ok; fwq1z: if (!(isset($infos["\164\141\162\x67\145\164"]) && $infos["\x74\141\x72\x67\145\164"])) { goto SXP_i; } goto arLYp; LYF7h: $categoryIds = $infos["\x63\x61\164\x65\x67\x6f\x72\x79"]; goto bmYuE; IhA1q: $model->data($infos); goto aLKT4; arLYp: $targetIds = $infos["\x74\141\x72\x67\x65\x74"]; goto p97wB; iWiiC: $infos["\155\x6f\144\x69\x66\171\137\164\151\155\145"] = date("\x59\55\155\55\x64\40\x48\x3a\151\72\163"); goto IhA1q; qPPoX: $infos["\146\x69\x72\163\x74\x5f\x6a\x6f\142\x5f\164\151\155\x65"] = !emptyInArray($infos, "\x66\151\162\163\x74\x5f\152\157\x62\x5f\x74\x69\x6d\145") ? $infos["\x66\151\162\163\x74\137\152\157\x62\137\164\x69\155\x65"] : null; goto iWiiC; nCgjV: $model = ExpertModel::get($expertId); goto zQvWB; DF4Ok: foreach ($fields as $fieldId => $fieldItems) { goto cwXlI; AcWtD: h8zl1: goto HaALw; cwXlI: foreach ($fieldItems as $fieldItemId) { Db::table("\145\170\x70\145\x72\x74\137\x66\x69\145\x6c\144\x5f\162\x65\x6c\x61\x74\145")->insert(["\x65\x78\x70\145\162\164\137\151\x64" => $expertId, "\x66\151\145\154\x64\x5f\151\x64" => $fieldId, "\x66\x69\x65\154\144\137\151\x74\145\155\137\x69\144" => $fieldItemId]); N41cJ: } goto jaL_z; jaL_z: Fg3MR: goto AcWtD; HaALw: } goto mCPlB; p97wB: SXP_i: goto j9e3T; QcRr_: return; goto XWBqL; tKQf8: OperationLogs::I()->expertLog("\xe4\277\256\346\224\xb9\344\xb8\223\345\256\xb6\x20\x2d\x20{$model->real_name}", beautifyLogArray($infos, $originals, "\x65\x78\160\145\x72\164"), OperationLogs::OPT_UPDATE_TYPE, $expertId); goto vG8eD; M63rY: foreach ($targetIds as $targetId) { Db::table("\x65\x78\160\145\x72\x74\x5f\x74\141\162\147\x65\x74\137\162\145\x6c\141\164\145")->insert(["\145\x78\160\145\162\x74\x5f\x69\144" => $expertId, "\164\x61\162\147\x65\x74\x5f\x69\144" => $targetId]); cBEiu: } goto RQ05h; y_dsc: $fields = []; goto yXGp_; bmYuE: kvZWv: goto uhPj0; zQvWB: if ($model) { goto NVD1v; } goto gkbLU; ouctO: $categoryIds = []; goto d143r; cKI3M: $targetIds = []; goto fwq1z; RPzU0: foreach ($categoryIds as $categoryId) { Db::table("\x65\170\x70\145\162\x74\137\x63\x61\x74\x65\x67\157\x72\171\x5f\162\x65\154\x61\x74\145")->insert(["\145\x78\x70\x65\162\164\x5f\x69\144" => $expertId, "\x63\141\164\145\147\x6f\x72\171\137\x69\144" => $categoryId]); G1g6Z: } goto P0ghC; j9e3T: Db::table("\145\170\x70\x65\162\x74\137\x74\x61\162\x67\145\x74\137\162\x65\x6c\x61\164\x65")->where(["\x65\x78\x70\x65\x72\164\x5f\x69\144" => $expertId])->delete(); goto M63rY; mCPlB: tEigG: goto tKQf8; d143r: if (!(isset($infos["\143\141\164\145\x67\157\162\x79"]) && $infos["\143\141\164\x65\147\x6f\162\171"])) { goto kvZWv; } goto LYF7h; Nrtfc: AoOG5: goto ZOUch; vG8eD: } public function delete($expertId) { goto leIFw; AsB6p: EeU_n: goto Di2NY; YupR2: SIkaZ: goto DPArN; P2Y1N: exception("\xe6\227\240\346\263\x95\xe6\211\276\345\x88\260\350\xaf\245\344\270\223\xe5\xae\266"); goto PszCn; JFkzr: if ($model) { goto SIkaZ; } goto P2Y1N; dM_dk: OperationLogs::I()->expertLog("\xe5\210\240\351\x99\244\xe4\270\x93\xe5\xae\xb6", $model->real_name, OperationLogs::OPT_DELETE_TYPE, $expertId); goto AsB6p; DPArN: $model->save(["\144\145\x6c\145\164\145\x5f\x66\x6c\x61\147" => 1]); goto dM_dk; leIFw: $model = ExpertModel::get($expertId); goto JFkzr; PszCn: goto EeU_n; goto YupR2; Di2NY: } public function restore($expertId) { goto J8dH4; J8dH4: $model = ExpertModel::get($expertId); goto AuDGp; Kp9gx: $model->save(["\144\145\x6c\145\164\x65\137\x66\x6c\141\x67" => 0]); goto m1H1Z; y2lFt: kiQBJ: goto Kp9gx; AuDGp: if ($model) { goto kiQBJ; } goto bmna5; R_ldc: goto LXDvg; goto y2lFt; DzQ0k: LXDvg: goto pUs5V; bmna5: exception("\xe6\x97\xa0\xe6\263\225\346\x89\xbe\xe5\x88\260\xe8\257\245\xe4\270\x93\xe5\xae\xb6"); goto R_ldc; m1H1Z: OperationLogs::I()->expertLog("\346\201\242\345\xa4\x8d\xe4\270\223\xe5\256\266", $model->real_name, OperationLogs::OPT_RESTORE_TYPE, $expertId); goto DzQ0k; pUs5V: } public function deleteForce($expertId) { goto Sxe_e; gt50t: Db::table("\x65\170\160\x65\162\x74")->where("\151\x64", $expertId)->delete(); goto YP6Yo; RfHRB: Db::table("\x65\x78\160\145\162\164\x5f\x74\141\162\x67\x65\164\137\x72\x65\154\141\164\145")->where(["\x65\170\x70\x65\162\x74\x5f\x69\x64" => $expertId])->delete(); goto kokFk; kokFk: Db::table("\145\x78\160\145\162\x74\x5f\x66\x69\x65\154\x64\137\162\x65\x6c\141\x74\x65")->where(["\145\x78\x70\145\x72\x74\137\x69\x64" => $expertId])->delete(); goto A6Axx; A6Axx: Db::table("\145\x78\160\x65\162\x74\137\x61\x70\160\157\x69\x6e\164\x5f\x74\x69\x6d\x65")->where(["\145\170\160\145\x72\164\x5f\151\144" => $expertId])->delete(); goto QdVVQ; Sxe_e: Db::table("\145\170\160\145\162\x74\137\x63\141\164\145\147\x6f\162\x79\137\162\x65\x6c\x61\x74\x65")->where(["\x65\x78\x70\x65\x72\164\137\151\144" => $expertId])->delete(); goto RfHRB; QdVVQ: Db::table("\x65\x78\x70\x65\162\x74\137\157\x72\144\x65\162")->where(["\x65\170\160\145\x72\164\137\151\x64" => $expertId])->delete(); goto gt50t; YP6Yo: } public function getInfos($expertId) { goto RBDfU; RBDfU: $infos = Db::table("\145\170\160\x65\x72\164")->where("\x69\x64", $expertId)->field(true)->find(); goto FC4fd; Aq9lm: c4G6p: goto Fi3o0; TrUAT: $infos["\141\x70\160\157\x69\x6e\x74\x5f\x64\x61\x79\137\164\x69\x6d\145\x73"] = Db::table("\x65\x78\x70\145\x72\x74\x5f\x61\160\x70\x6f\x69\156\164\137\164\x69\155\x65")->where(["\x65\170\x70\145\x72\164\x5f\x69\x64" => $expertId])->field("\167\145\x65\153\137\x64\141\x79\x2c\40\x61\x70\160\157\x69\156\x74\137\x74\151\155\145")->select(); goto OCEO3; FC4fd: if ($infos) { goto c4G6p; } goto QpGRF; QpGRF: return false; goto Aq9lm; ZU5Ac: $infos["\164\141\x72\x67\x65\164\111\x64\x73"] = Db::table("\145\x78\x70\145\162\164\137\164\x61\162\x67\145\x74\137\162\x65\x6c\x61\x74\145")->where(["\x65\170\160\x65\162\164\137\151\144" => $expertId])->column("\x74\141\x72\147\x65\164\x5f\151\144"); goto lkoKL; OCEO3: return $infos; goto cXRFQ; Fi3o0: $infos["\143\141\x74\145\147\x6f\x72\x79\x49\x64\163"] = Db::table("\145\170\x70\145\x72\164\137\x63\x61\164\x65\x67\x6f\162\x79\x5f\162\x65\x6c\141\164\x65")->where(["\x65\170\x70\x65\162\164\137\x69\144" => $expertId])->column("\143\141\x74\x65\x67\x6f\x72\x79\x5f\x69\144"); goto ZU5Ac; lkoKL: $infos["\x66\x69\x65\x6c\x64\111\164\x65\x6d\111\144\x73"] = Db::table("\145\x78\x70\145\x72\x74\x5f\146\x69\x65\154\x64\x5f\162\145\154\x61\164\145")->where(["\x65\x78\160\145\x72\x74\x5f\151\x64" => $expertId])->column("\x66\151\x65\154\144\137\151\164\x65\155\137\151\x64"); goto TrUAT; cXRFQ: } public function getDefaultInfos() { return ["\x72\145\141\154\137\156\x61\155\145" => '', "\x77\x6f\162\x6b\151\x6d\147\137\x75\162\154" => '', "\x63\x61\164\x65\147\x6f\x72\x79\x49\144\163" => [], "\143\x65\154\154\160\150\157\156\145" => null, "\x66\x69\162\x73\x74\137\x6a\157\x62\137\x74\151\155\x65" => null, "\x77\157\x72\x6b\x70\154\141\143\x65" => null, "\145\170\160\x65\x72\x74\x5f\x70\162\157\146\151\x6c\x65" => '', "\145\170\160\x65\162\164\137\x71\x75\141\154\151\164\171" => null, "\143\x6f\156\x73\165\154\x74\137\x71\x75\x61\156\164\x69\164\x79" => 500, "\146\x69\x65\x6c\144\x49\x74\x65\x6d\111\144\163" => [], "\164\x61\162\147\145\x74\111\x64\163" => [], "\141\160\160\157\151\x6e\164\x5f\146\145\145" => 0.0, "\x61\160\160\157\x69\156\x74\x5f\x72\x65\166\x69\x65\x77\x5f\x66\x65\x65" => 0.0, "\162\145\155\141\162\x6b" => null, "\141\160\x70\x6f\x69\156\164\137\x64\x61\x79\137\164\x69\155\x65\x73" => [], "\x73\164\x61\164\x75\x73" => IndexDefs::ENTITY_DRAFT_STATUS]; } public function qrcode($id) { goto ww0zS; BsvN0: $result = file_put_contents(SITE_DIR . $path, file_get_contents($url)); goto aS11o; I703U: if ($expert) { goto uKhZv; } goto MR91t; ZY6BI: try { goto Yy70v; DNKme: exception("\346\216\xa5\345\217\243\xe8\277\224\345\233\x9e\xe5\xa4\xb1\xe8\264\245\x2c\x20" . var_export($res, true)); goto hfX1Z; ahBId: $url = $app->qrcode->url($res["\164\151\143\x6b\145\164"]); goto zBEDn; IX2Q3: dPsfW: goto G4oic; JRZ9w: Log::notice("\x65\x78\x70\x65\x72\x74\x20\161\x72\143\157\144\x65\x20\162\x65\164\165\162\156\x20" . var_export($res, true)); goto IX2Q3; hfX1Z: nhRAT: goto ahBId; G4oic: if (!(!$res || !isset($res["\x74\151\x63\x6b\145\164"]))) { goto nhRAT; } goto DNKme; Yy70v: $res = $app->qrcode->forever($scene_id); goto TYth4; TYth4: if (!$res) { goto dPsfW; } goto JRZ9w; zBEDn: } catch (\Exception $e) { wexception("\xe7\224\237\346\210\220\345\244\261\350\264\245\357\274\232" . $e->getMessage()); } goto roGTo; ww0zS: $expert = $this->getInfos($id); goto I703U; dW4hZ: Db::table("\145\x78\160\145\162\164")->where(["\x69\144" => $id])->setField("\161\162\143\x6f\x64\145", $path); goto SKPIn; aS11o: if ($result) { goto ZoGPc; } goto t80zO; gEqSO: if (systemSetting("\x57\x58\x5f\117\106\106\x49\103\x45\137\101\x43\x43\117\125\116\124\137\101\x50\120\137\x49\104")) { goto C75ZH; } goto R3Zd_; MoZMv: ZoGPc: goto dW4hZ; kLlAB: uKhZv: goto gEqSO; MR91t: wexception("\346\227\xa0\346\263\225\xe6\x89\276\xe5\210\260\350\257\xa5\344\270\x93\xe5\xae\266"); goto kLlAB; LOmCl: $scene_id = "\145\170\160\x65\x72\x74\137\x69\x64\x5f" . $id; goto ZY6BI; t80zO: wexception("\345\206\x99\345\205\245\345\233\276\xe5\x83\x8f\xe6\226\x87\344\xbb\266\xe5\xa4\xb1\350\264\xa5"); goto MoZMv; roGTo: $path = "\57\161\162\143\x6f\144\x65\57" . $scene_id . "\x2e\x6a\x70\147"; goto BsvN0; SKPIn: return $path; goto FCUWh; R3Zd_: wexception("\347\x94\x9f\346\x88\220\xe5\244\xb1\xe8\264\xa5\xef\xbc\232\346\234\252\351\x85\215\347\xbd\xae\xe5\205\xac\xe4\274\x97\345\x8f\xb7\xe5\217\x82\346\225\260"); goto p55lS; TNbZa: $app = \EasyWeChat\Factory::officialAccount(config("\x77\170\56\157\x66\146\151\143\151\141\154\x5f\141\143\143\x6f\x75\156\x74")); goto LOmCl; p55lS: C75ZH: goto TNbZa; FCUWh: } public function set45AppointTime($expertId, $weekDay, $intervals) { goto ecwGt; B_GmO: UiN9k: goto s77y1; s77y1: $existAppointTimes = []; goto SvHfo; ho_Vd: $sections0 = explode("\x2d", $intervals[0]); goto JUhBj; yGgD6: PQaoI: goto GzUOI; JUhBj: $sections1 = explode("\x2d", $intervals[1]); goto dH9mh; SQmwO: foreach ($intervals as $interval) { goto glbFQ; glbFQ: if (!in_array($interval, $existAppointTimes)) { goto xNING; } goto L5kL0; hQhdV: S47zF: goto FSG1m; wKVha: xNING: goto hQhdV; L5kL0: $bConflict = true; goto F4SQP; F4SQP: goto PS39p; goto wKVha; FSG1m: } goto x47XY; sOzyD: if (!$bConflict) { goto PQaoI; } goto YeCwa; YeCwa: wexception("\xe6\211\x80\xe9\x80\x89\347\x9a\x84\346\x97\266\351\x97\xb4\xe5\235\x97\350\xa2\xab\345\x8d\xa0\xe7\224\xa8"); goto yGgD6; GgfGb: BU53t: goto aVwzW; dH9mh: $sections2 = explode("\55", $intervals[2]); goto dAUeK; p8evC: wexception("\350\257\267\xe9\200\x89\346\x8b\251\x33\344\270\252\xe8\xbf\x9e\xe7\273\xad\xe6\227\xb6\351\227\xb4\345\x9d\227"); goto kgUKQ; x47XY: PS39p: goto sOzyD; SvHfo: $appointTimes = Db::table("\x65\x78\160\x65\x72\164\x5f\141\x70\160\157\151\x6e\164\x5f\x74\x69\155\x65")->where(["\x65\x78\160\145\x72\164\x5f\151\x64" => $expertId, "\x77\x65\145\x6b\x5f\x64\141\x79" => $weekDay])->column("\x61\160\x70\x6f\x69\x6e\x74\137\164\151\155\x65"); goto g9F3d; g9F3d: foreach ($appointTimes as $appointTime) { $existAppointTimes = array_merge($existAppointTimes, explode("\54", $appointTime)); TGI8H: } goto W8krV; GzUOI: Db::table("\145\x78\160\x65\x72\x74\137\141\x70\x70\x6f\x69\156\164\137\164\151\x6d\x65")->insert(["\x65\x78\x70\145\162\164\137\151\x64" => $expertId, "\167\x65\145\x6b\x5f\144\x61\x79" => $weekDay, "\x61\160\160\x6f\151\156\x74\x5f\164\x69\155\x65" => implode("\54", $intervals)]); goto RFB_s; aVwzW: R_dzH: goto lr_2H; ybX4c: wexception("\350\xaf\xb7\xe9\200\x89\xe6\213\xa9\63\xe4\xb8\252\xe8\xbf\236\347\273\xad\346\227\xb6\xe9\227\xb4\345\235\227"); goto NgPGK; lr_2H: $infos = $this->getInfos($expertId); goto rDpnP; W8krV: F2Lks: goto d7VFO; dAUeK: if ($sections0[1] == $sections1[0] && $sections1[1] == $sections2[0]) { goto BU53t; } goto ybX4c; WVe9P: wexception("\xe6\x97\xa0\xe6\xb3\x95\346\211\xbe\345\210\260\350\xaf\xa5\344\xb8\223\xe5\xae\266"); goto B_GmO; NgPGK: goto R_dzH; goto GgfGb; ecwGt: sort($intervals, SORT_STRING); goto Cz7t3; kgUKQ: Ip1dc: goto ho_Vd; d7VFO: $bConflict = false; goto SQmwO; Cz7t3: if (!(count($intervals) != 3)) { goto Ip1dc; } goto p8evC; rDpnP: if ($infos) { goto UiN9k; } goto WVe9P; RFB_s: } public function set15AppointTime($expertId, $weekDay, $intervals) { goto Waut_; T0_tQ: $infos = $this->getInfos($expertId); goto s8Y7O; JHheo: xjEK2: goto T0_tQ; RJgC5: wexception("\346\x89\200\xe9\x80\x89\xe7\232\x84\xe6\x97\266\xe9\x97\264\345\x9d\x97\350\242\xab\345\x8d\240\347\224\xa8"); goto lOUNd; wSbQ6: $bConflict = false; goto LOaKj; oj2cu: if (!$bConflict) { goto Uoool; } goto RJgC5; d0pv1: wexception("\xe6\x97\xa0\xe6\263\x95\xe6\x89\276\xe5\x88\xb0\350\257\xa5\xe4\270\x93\xe5\xae\xb6"); goto e900d; InkPm: Db::table("\145\170\x70\x65\162\x74\137\141\x70\x70\x6f\x69\x6e\164\x5f\164\151\155\x65")->insert(["\x65\x78\x70\x65\162\164\x5f\151\144" => $expertId, "\x77\145\145\153\x5f\x64\x61\171" => $weekDay, "\x61\x70\x70\x6f\x69\x6e\164\x5f\164\x69\x6d\x65" => implode("\54", $intervals)]); goto kZkcV; qXG8N: UmEk6: goto oj2cu; dZTW9: $existAppointTimes = []; goto E0_lX; i6HTN: wexception("\350\257\267\351\x80\211\xe6\x8b\xa9\x31\xe4\xb8\252\xe6\227\266\351\227\264\xe5\235\227"); goto JHheo; e900d: sCpRU: goto dZTW9; gTi6U: foreach ($appointTimes as $appointTime) { $existAppointTimes = array_merge($existAppointTimes, explode("\x2c", $appointTime)); Cgg9l: } goto UbYP5; LOaKj: foreach ($intervals as $interval) { goto Me29J; OsqAV: hGiA1: goto eF1fk; us1b4: goto UmEk6; goto PyJef; PyJef: bxC4q: goto OsqAV; SKO2F: $bConflict = true; goto us1b4; Me29J: if (!in_array($interval, $existAppointTimes)) { goto bxC4q; } goto SKO2F; eF1fk: } goto qXG8N; E0_lX: $appointTimes = Db::table("\x65\x78\160\145\x72\164\137\141\x70\160\157\x69\x6e\x74\137\164\151\x6d\x65")->where(["\145\x78\160\145\162\x74\137\x69\144" => $expertId, "\167\x65\x65\x6b\x5f\x64\x61\x79" => $weekDay])->column("\141\160\160\157\x69\x6e\164\137\x74\151\155\x65"); goto gTi6U; UbYP5: LhBsw: goto wSbQ6; s8Y7O: if ($infos) { goto sCpRU; } goto d0pv1; Waut_: if (!(count($intervals) != 1)) { goto xjEK2; } goto i6HTN; lOUNd: Uoool: goto InkPm; kZkcV: } public function cancelAppointTime($expertId, $weekDay, $intervals) { goto fEA68; iYLpK: wexception("\346\211\200\351\200\211\346\x8b\251\345\217\x96\346\xb6\210\347\x9a\x84\xe6\227\266\xe9\227\xb4\346\xae\265\344\270\215\xe5\255\230\345\x9c\250"); goto s3yw2; s3yw2: E0tXY: goto AvfG2; AvfG2: Db::table("\x65\x78\x70\145\x72\164\137\141\x70\x70\x6f\151\156\164\137\x74\x69\x6d\145")->where(["\x65\170\x70\x65\x72\164\137\x69\x64" => $expertId, "\x77\x65\145\153\137\144\x61\x79" => $weekDay, "\x61\x70\x70\x6f\x69\x6e\164\x5f\164\151\x6d\x65" => implode("\54", $intervals)])->delete(); goto gvpgv; S8pfb: if ($existAppointTime) { goto E0tXY; } goto iYLpK; K4Rg_: if (!(count($intervals) != 1 && count($intervals) != 3)) { goto jOTyE; } goto MWHH1; fEA68: sort($intervals, SORT_STRING); goto K4Rg_; MWHH1: wexception("\350\xaf\xb7\345\xae\x8c\xe6\225\264\xe9\x80\x89\xe6\213\251\x34\x35\345\210\206\351\x92\237\x33\xe4\270\xaa\350\277\236\xe7\273\255\xe6\x97\xb6\xe9\227\xb4\xe5\x9d\x97\x2f\61\65\345\x88\x86\351\222\237\61\344\270\252\xe6\x97\xb6\351\227\xb4\xe5\235\x97"); goto WLCiv; vEeZ5: $existAppointTime = Db::table("\145\x78\160\x65\x72\164\137\x61\x70\160\x6f\151\156\164\137\x74\151\155\x65")->where(["\x65\170\160\x65\x72\x74\x5f\x69\144" => $expertId, "\x77\x65\x65\x6b\x5f\x64\141\x79" => $weekDay, "\x61\160\x70\157\x69\156\x74\137\164\x69\x6d\x65" => implode("\x2c", $intervals)])->find(); goto S8pfb; WLCiv: jOTyE: goto vEeZ5; gvpgv: } public function defaultSchedule($expertId, $weekDay) { goto vdOoQ; Ps_Xm: PwW99: goto uj0Ao; uJ6pf: goto R48hY; goto kgerL; FcBPc: Db::table("\145\170\160\x65\x72\164\x5f\x61\x70\x70\157\151\156\164\137\164\x69\155\x65")->insert(["\145\170\x70\145\x72\164\137\151\x64" => $expertId, "\x77\145\x65\153\x5f\x64\x61\x79" => $weekDay, "\141\160\x70\157\x69\156\x74\137\x74\151\x6d\145" => implode("\54", $appoint45s)]); goto YUPzY; vdOoQ: Db::table("\145\170\160\x65\x72\164\137\x61\160\160\157\x69\156\x74\137\x74\151\155\x65")->where(["\x65\170\x70\x65\x72\x74\x5f\151\x64" => $expertId, "\x77\145\145\x6b\x5f\144\x61\x79" => $weekDay])->delete(); goto xu1PC; uWmzO: if (count($appoint45s) < 3) { goto PwW99; } goto FcBPc; k8riN: R48hY: goto d7hVd; N7Uq9: goto R48hY; goto HK9O8; Uf85u: F8s8t: goto aq5aY; aq5aY: $startHour = $nextHour; goto uJ6pf; uj0Ao: $appoint45s[] = $appointInterval; goto Uf85u; YUPzY: array_splice($appoint45s, 0, count($appoint45s)); goto Uu1Rs; Uu1Rs: Db::table("\145\170\160\x65\x72\x74\137\x61\x70\x70\157\x69\156\x74\137\164\151\155\x65")->insert(["\x65\x78\160\x65\162\x74\x5f\x69\144" => $expertId, "\167\x65\x65\153\137\x64\141\x79" => $weekDay, "\x61\160\160\157\x69\x6e\164\x5f\164\151\x6d\145" => $appointInterval]); goto N7xzB; r6Xai: if (!in_array($appointInterval, ["\61\x32\72\60\x30\55\x31\x32\x3a\61\65", "\61\x32\x3a\61\65\55\x31\x32\72\x33\x30", "\61\62\72\63\60\x2d\x31\62\x3a\64\x35", "\x31\62\x3a\64\x35\55\x31\63\72\x30\60", "\x31\63\72\x30\x30\55\61\63\72\61\x35", "\x31\63\x3a\x31\65\x2d\61\63\72\63\x30", "\61\63\x3a\x33\x30\x2d\61\63\x3a\x34\x35", "\61\x33\72\x34\x35\x2d\x31\x34\x3a\60\x30"])) { goto F4oaJ; } goto MyE0A; R_WQ0: $nextHour = date("\110\x3a\151", strtotime($nowDate . "\40" . $startHour . "\72\x30\60" . "\x20\x2b\61\x35\40\155\151\x6e\x75\164\145\163")); goto VPzYI; HK9O8: F4oaJ: goto uWmzO; VPzYI: $appointInterval = $startHour . "\x2d" . $nextHour; goto r6Xai; M4l2z: $nowDate = date("\x59\55\155\55\x64"); goto D1Kco; KkCOe: $endHour = IndexDefs::APPOINT_END_TIME; goto M4l2z; kgerL: hypQc: goto Yg0QA; D1Kco: $appoint45s = []; goto k8riN; d7hVd: if (!($startHour < $endHour)) { goto hypQc; } goto R_WQ0; MyE0A: $startHour = $nextHour; goto N7Uq9; N7xzB: goto F8s8t; goto Ps_Xm; xu1PC: $startHour = IndexDefs::APPOINT_START_TIME; goto KkCOe; Yg0QA: } }
