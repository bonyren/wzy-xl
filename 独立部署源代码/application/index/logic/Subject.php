<?php
 namespace app\index\logic; use think\Log; use think\Db; use app\index\model\Subject as SubjectModel; use app\index\logic\Attachments as AttachmentsLogic; use app\index\logic\Defs as IndexDefs; use app\Defs; use app\index\service\OperationLogs; use app\index\service\RequestContext; use app\common\service\WException; use app\index\service\Wzyer as WzyerService; use app\index\service\EventLogs as EventLogsService; use report\algo\Ai as AiAlgo; class Subject extends Base { protected function __construct() { parent::__construct(); } public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto u7YLG; lefQp: $conditions["\144\145\x6c\x65\164\145\x5f\146\154\141\147"] = $search["\144\x65\154\145\164\x65\137\146\x6c\x61\x67"]; goto Ue1jx; oBEX1: goto m8MkD; goto yaTZ1; H1BIo: tOUCz: goto E27l9; bD3uH: nEjeZ: goto ymYt0; WLQiQ: GqYG1: goto ll5U6; tx5tD: if ($sort == "\162\x61\x74\x69\156\147") { goto HpsiU; } goto GBRUR; E27l9: return ["\x74\x6f\x74\x61\x6c" => $totalCount, "\x72\x6f\x77\x73" => $records]; goto W7BRH; ILK41: N6OXA: goto J1Mh1; GBRUR: $order = "\163\157\x72\164\x20\141\163\x63\x2c\40\143\x72\145\x61\x74\x65\x5f\164\151\155\145\x20\x64\x65\163\x63"; goto oBEX1; T0ERS: $totalCount = Db::table("\x73\x75\142\152\145\143\x74")->where($conditions)->count(); goto JqWX3; upZo1: return ["\x74\x6f\x74\141\154" => 0, "\162\157\x77\163" => []]; goto YPnt0; ywjWK: HtCMJ: goto YBNDl; Y3l2L: g7njk: goto T0ERS; WL3hE: $conditions["\x64\x65\154\x65\164\145\x5f\x66\x6c\141\147"] = 0; goto Y3l2L; tM6oi: Y4nKY: goto j0E3K; OoT0V: $conditions["\x6e\141\155\145"] = ["\x6c\151\x6b\x65", "\45{$search["\156\x61\155\x65"]}\45"]; goto E_Aul; PTP_1: $order = "\160\x61\x72\x74\151\x63\151\160\141\x6e\164\x73\40" . $order . "\54\x20\143\162\145\x61\x74\x65\x5f\x74\151\155\x65\40\x64\x65\x73\143"; goto Y8jCA; hpnkv: goto N6OXA; goto D5RJZ; yaTZ1: HpsiU: goto oR0ov; X72zT: $order = "\x73\x74\141\x74\165\x73\x20" . $order . "\54\40\143\x72\145\x61\164\x65\x5f\164\151\x6d\x65\x20\x64\145\163\x63"; goto ILK41; llGhC: $conditions["\154\141\142\x65\154"] = ["\154\151\x6b\x65", "\x25{$search["\154\141\x62\145\x6c"]}\45"]; goto HA_be; YbCnn: if (emptyInArray($search, "\x6c\x61\142\x65\x6c")) { goto s6YnI; } goto llGhC; Hp4rH: mnwij: goto odlFZ; Y8jCA: oqyKu: goto IYykN; J1Mh1: goto HtCMJ; goto fjh8D; YfH_L: goto oqyKu; goto QxLpY; j0E3K: $order = "\164\157\x74\141\154\137\141\155\x6f\x75\156\x74\40" . $order . "\54\40\x63\162\x65\141\164\145\x5f\164\151\x6d\x65\40\144\145\x73\143"; goto cMWKs; lpQvn: if ($sort == "\160\141\x72\x74\151\x63\151\160\141\x6e\164\x73") { goto lKue1; } goto f1bb5; DL9U3: $conditions["\151\x64"] = ["\x69\156", $subjectIds]; goto Hp4rH; fjh8D: p9me3: goto DQCEN; f1bb5: if ($sort == "\x74\157\164\x61\x6c\137\x61\155\157\x75\156\x74") { goto Y4nKY; } goto B9TCs; xTB2w: $conditions = []; goto e7HVP; cMWKs: JX6lS: goto YfH_L; DQCEN: $order = "\x73\x6f\162\164\40" . $order . "\54\40\143\162\145\x61\x74\145\137\164\x69\x6d\145\x20\x64\x65\163\x63"; goto ywjWK; pMgC3: $conditions["\164\x79\x70\x65"] = $search["\164\171\160\145"]; goto WLQiQ; ll5U6: if (emptyInArray($search, "\x63\141\164\x65\x67\157\162\x79\137\x69\x64")) { goto mnwij; } goto ZdTjk; JqWX3: $records = Db::table("\163\165\x62\152\145\x63\x74")->where($conditions)->page($page, $rows)->order($order)->field("\52")->select(); goto r4W02; u7YLG: if ($sort == "\x63\165\162\x72\145\x6e\164\x5f\x70\162\151\x63\145") { goto nEjeZ; } goto lpQvn; E_Aul: lozuG: goto YbCnn; r4W02: foreach ($records as &$record) { goto u_toz; krEjh: $record["\151\x6d\141\147\x65\x5f\x75\162\154"] = generateThumbnailUrl($record["\151\x6d\141\147\145\137\x75\162\x6c"], 100); goto Hqq1e; u_toz: $record["\x63\141\x74\x65\x67\x6f\162\171"] = $this->getCategoryNameStr($record["\x69\x64"]); goto QGNmQ; V4ys7: M436f: goto eHZEg; Hqq1e: $record["\142\x61\156\156\145\162\137\x69\155\147"] = generateThumbnailUrl($record["\142\141\156\156\145\x72\x5f\151\x6d\147"], 100); goto V4ys7; QGNmQ: $record["\151\x74\x65\155\137\156\x75\155"] = Db::table("\x73\x75\x62\x6a\145\x63\164\x5f\151\164\145\155")->where("\x73\x75\142\x6a\x65\143\x74\137\x69\x64", $record["\x69\x64"])->count(); goto krEjh; eHZEg: } goto H1BIo; ZdTjk: $subjectIds = Db::table("\x73\165\x62\152\145\x63\x74\137\x63\x61\x74\x65\x67\x6f\162\171\x5f\x72\145\154\141\x74\145")->where(["\x63\x61\164\145\147\x6f\162\x79\137\x69\144" => $search["\143\x61\164\x65\147\x6f\162\171\x5f\151\x64"]])->column("\163\165\142\152\x65\x63\x74\137\x69\144"); goto mPCZT; B9TCs: if ($sort == "\x73\x6f\x72\164") { goto p9me3; } goto xgi9P; e7HVP: if (empty($search["\164\171\x70\x65"])) { goto GqYG1; } goto pMgC3; nREdB: if (emptyInArray($search, "\163\x74\141\164\165\x73")) { goto PuFqy; } goto TDDSf; YPnt0: e37UR: goto DL9U3; YBNDl: goto JX6lS; goto tM6oi; gno3t: m8MkD: goto hpnkv; TDDSf: $conditions["\163\164\141\x74\x75\x73"] = $search["\163\x74\141\x74\x75\163"]; goto wOJOi; ymYt0: $order = "\x63\165\x72\162\145\156\164\137\x70\x72\151\x63\145\x20" . $order . "\x2c\x20\143\x72\145\x61\x74\145\x5f\x74\x69\x6d\x65\40\x64\145\x73\143"; goto RMp3G; SncR0: if (!isset($search["\144\x65\154\145\164\x65\137\146\x6c\x61\x67"])) { goto RXScf; } goto lefQp; QxLpY: lKue1: goto PTP_1; wOJOi: PuFqy: goto SncR0; oR0ov: $order = "\162\x61\x74\x69\x6e\147\x20" . $order . "\x2c\x20\x63\x72\x65\141\164\x65\x5f\x74\x69\x6d\x65\40\144\x65\163\143"; goto gno3t; Ue1jx: goto g7njk; goto Ttlt4; HA_be: s6YnI: goto nREdB; mPCZT: if (!empty($subjectIds)) { goto e37UR; } goto upZo1; xgi9P: if ($sort == "\x73\x74\141\164\165\163") { goto GU0aS; } goto tx5tD; RMp3G: w3EFL: goto xTB2w; IYykN: goto w3EFL; goto bD3uH; D5RJZ: GU0aS: goto X72zT; odlFZ: if (emptyInArray($search, "\x6e\141\155\145")) { goto lozuG; } goto OoT0V; Ttlt4: RXScf: goto WL3hE; W7BRH: } public function getAvailableCategories() { return Db::table("\143\x61\164\145\x67\x6f\162\151\x65\163")->order("\x69\x64\40\141\x73\143")->column("\151\144\54\x6e\x61\x6d\145\54\163\164\x61\x74\x75\x73\x2c\151\x6d\147\x5f\165\162\154"); } public function getCategoryNameStr($id) { goto n_RLq; ANtTo: if (!empty($names)) { goto jeaXM; } goto xrUlk; oy2o3: return implode("\54", $names); goto VNyTI; xrUlk: return ''; goto RyWsJ; n_RLq: $names = Db::table("\163\x75\142\152\x65\143\164\x5f\143\141\164\x65\x67\x6f\x72\x79\x5f\162\145\x6c\x61\x74\x65")->alias("\123\103\x52")->join("\x63\x61\x74\x65\x67\157\162\151\x65\x73\40\x43", "\x53\103\122\x2e\x63\x61\x74\x65\147\157\162\x79\137\151\144\75\103\56\151\x64\40\141\x6e\x64\40\x53\103\122\x2e\163\165\142\x6a\x65\x63\x74\x5f\151\144\75" . $id)->column("\x43\56\x6e\x61\155\x65"); goto ANtTo; RyWsJ: jeaXM: goto oy2o3; VNyTI: } public function getCategoryIds($id) { goto fGR5K; fpMK9: $categoryIds = []; goto E_eMR; etEpp: if (!empty($categoryIds)) { goto ivFv8; } goto fpMK9; fGR5K: $categoryIds = Db::table("\x73\x75\142\x6a\145\x63\x74\x5f\x63\x61\164\145\147\x6f\162\171\137\162\145\154\x61\164\x65")->where("\163\165\142\152\145\x63\164\137\x69\144", $id)->column("\143\141\x74\145\x67\157\162\x79\x5f\x69\x64"); goto etEpp; kzHAz: return $categoryIds; goto k1dVk; E_eMR: ivFv8: goto kzHAz; k1dVk: } public function getDefaultSubject() { return ["\x69\x64" => 0, "\x69\x6d\x61\x67\x65\137\165\162\x6c" => '', "\x62\x61\156\156\x65\x72\137\x69\x6d\147" => '', "\156\x61\x6d\145" => '', "\163\x75\142\x74\151\164\154\145" => '', "\x63\x75\x72\x72\145\x6e\164\137\x70\162\151\143\x65" => 0, "\x65\x78\x70\145\143\164\137\146\x69\156\x69\x73\x68\137\164\151\x6d\145" => 8, "\163\165\142\152\145\143\x74\137\144\x65\163\143" => '', "\x73\165\142\x6a\x65\x63\x74\x5f\164\151\160" => '', "\x73\x74\141\x74\x75\163" => IndexDefs::ENTITY_DRAFT_STATUS, "\x72\141\164\x69\156\147" => 5, "\x74\x65\163\164\137\x61\154\x6c\x6f\x77\137\x62\141\143\x6b" => 0, "\164\x65\x73\164\137\x61\154\154\x6f\167\137\x76\151\145\167\137\x72\145\x70\157\162\x74" => 1, "\x75\x6e\x69\137\x61\160\x70" => 0, "\160\x61\162\164\151\143\151\x70\141\156\164\163\x5f\x73\x68\157\x77" => 0, "\164\x65\163\x74\x5f\141\154\x6c\x6f\167\x5f\141\156\163\167\145\x72\137\145\155\x70\164\x79" => 0]; } public function getSubject($id) { $subject = Db::table("\x73\165\142\x6a\145\143\164")->where("\151\x64", $id)->field(true)->find(); return $subject; } public function loadSubjectStandards($subjectId, $wholeFlag = false) { goto Ae53o; oia46: x20ka: goto Adb3d; zKHFo: $subject = Db::table("\x73\165\x62\x6a\145\x63\x74")->where("\151\x64", $subjectId)->field("\x69\x74\145\155\163\x2c\40\x73\x74\x61\164\151\x73\164\151\143\137\x77\x65\x69\x67\150\164\x5f\155\x69\x6e\54\40\x73\x74\141\x74\x69\x73\x74\151\x63\x5f\167\x65\151\147\x68\164\x5f\x6d\141\x78\x2c\x20\x73\x74\141\x6e\144\141\x72\144\137\167\x65\151\147\x68\x74\x5f\155\x69\156\x2c\40\x73\x74\141\x6e\144\141\162\144\x5f\167\x65\x69\147\x68\164\x5f\x6d\x61\170")->find(); goto IjEMw; GZXE8: zP0ip: goto ZwKdY; nq_YL: $rows = []; goto oia46; yjzJo: n8yMs: goto Nm185; ZwKdY: return $rows; goto Si5n8; KLhWc: UqiHJ: goto GZXE8; IjEMw: if (!$subject) { goto UqiHJ; } goto Upumv; Upumv: array_unshift($rows, ["\163\164\141\156\x64\141\162\144\137\151\144" => 0, "\x6c\141\164\x69\x74\x75\144\x65" => Defs::SUBJECT_WHOLE_STANDARD, "\x69\164\x65\155\x5f\143\x6f\165\156\164" => $subject["\x69\164\145\155\x73"], "\x77\145\x69\147\150\x74\137\155\x69\x6e\137\x6d\141\170" => $subject["\x73\164\x61\164\x69\163\164\151\143\137\167\x65\151\x67\150\164\137\x6d\x69\156"] . "\x20\x2d\40" . $subject["\163\164\141\x74\x69\163\164\151\x63\137\x77\x65\x69\147\x68\164\x5f\155\x61\x78"], "\x73\164\x61\x6e\x64\141\x72\144\x5f\167\145\x69\147\x68\164\x5f\x6d\151\156\x5f\155\x61\x78" => $subject["\x73\x74\x61\156\x64\x61\x72\144\137\x77\x65\151\147\x68\x74\x5f\155\151\156"] !== null && $subject["\163\x74\x61\156\x64\141\162\144\137\167\145\151\147\150\164\137\x6d\141\x78"] !== null ? $subject["\163\x74\x61\156\144\x61\162\144\x5f\167\145\151\x67\150\x74\137\x6d\151\156"] . "\x20\x2d\x20" . $subject["\163\x74\x61\156\x64\x61\x72\144\137\167\145\x69\147\x68\164\x5f\x6d\141\170"] : null]); goto KLhWc; Ae53o: $rows = Db::table("\x73\x75\x62\x6a\x65\x63\164\x5f\x73\164\141\x6e\x64\x61\x72\x64")->where(["\x73\165\x62\x6a\x65\x63\x74\137\151\144" => $subjectId])->field("\x69\144\40\141\x73\40\163\164\141\156\144\x61\x72\x64\137\x69\x64\54\x20\154\141\164\151\x74\165\144\145\54\40\x73\x74\x61\164\151\163\x74\151\143\137\x77\x65\151\147\150\164\137\x6d\x69\156\54\40\x73\x74\x61\x74\x69\163\x74\x69\143\137\167\x65\151\x67\150\164\137\155\141\x78\54\x20\x73\164\141\156\x64\141\x72\x64\137\167\145\151\147\x68\x74\137\x6d\x69\x6e\54\x20\x73\x74\x61\x6e\x64\x61\x72\144\x5f\x77\145\x69\x67\150\x74\x5f\x6d\141\x78\54\x20\x73\157\162\x74\54\40\x72\145\x6d\141\162\x6b")->order("\x73\157\x72\x74\x20\x61\163\x63\54\40\151\144\40\x61\x73\x63")->select(); goto vR_bu; Adb3d: foreach ($rows as &$row) { goto Vyo0t; ArZYe: CxKpl: goto Ge2ne; ZR6V_: gTxLn: goto XiTh8; Ge2ne: QWgpQ: goto VEA3T; XXfIo: $row["\151\x74\145\155\137\143\157\x75\x6e\x74"] = Db::table("\163\x75\142\152\145\143\x74\137\151\x74\x65\x6d\137\163\x74\141\x6e\144\x61\x72\144")->where(["\163\x75\142\x6a\x65\143\164\x5f\x69\x64" => $subjectId, "\163\164\x61\x6e\144\141\x72\x64\137\x69\x64" => $standardId])->count(); goto X09W1; Vyo0t: $standardId = $row["\x73\x74\x61\156\144\141\x72\144\x5f\151\x64"]; goto XXfIo; nskjw: $row["\163\164\x61\x6e\x64\x61\162\144\137\x77\x65\151\147\x68\164\137\155\151\x6e\x5f\155\141\x78"] = null; goto Al6g5; y7HqE: $row["\167\145\x69\x67\150\x74\137\155\x69\x6e\137\x6d\x61\170"] = $minWeight . "\x20\55\x20" . $maxWeight; goto WDnj1; WDnj1: if ($row["\163\x74\x61\156\144\x61\162\x64\137\167\x65\151\x67\x68\x74\137\x6d\151\156"] !== null && $row["\x73\164\x61\x6e\144\141\x72\144\x5f\167\x65\x69\x67\150\164\137\x6d\141\x78"] !== null) { goto gTxLn; } goto nskjw; X09W1: $minWeight = $row["\x73\164\141\164\x69\x73\x74\151\x63\x5f\x77\x65\151\147\x68\x74\137\x6d\151\x6e"]; goto jTb7B; jTb7B: $maxWeight = $row["\x73\x74\141\x74\151\163\x74\x69\x63\x5f\x77\145\x69\147\x68\x74\137\155\141\170"]; goto y7HqE; Al6g5: goto CxKpl; goto ZR6V_; XiTh8: $row["\x73\x74\141\x6e\x64\x61\162\144\x5f\x77\x65\151\147\150\x74\x5f\x6d\x69\156\x5f\x6d\141\x78"] = $row["\x73\x74\141\x6e\144\141\x72\144\x5f\167\x65\151\147\150\x74\137\x6d\x69\x6e"] . "\40\55\40" . $row["\x73\164\141\x6e\144\141\x72\x64\137\167\x65\151\x67\x68\164\137\x6d\141\170"]; goto ArZYe; VEA3T: } goto yjzJo; vR_bu: if ($rows) { goto x20ka; } goto nq_YL; Nm185: if (!$wholeFlag) { goto zP0ip; } goto zKHFo; Si5n8: } public function getSubjectStandard($id) { $standard = Db::table("\x73\x75\142\152\x65\143\164\x5f\163\x74\141\x6e\x64\141\162\x64")->where("\x69\x64", $id)->field(true)->find(); return $standard; } public function saveSubjectStandard($subjectId, $standardId, $formData) { goto pGa0D; x1DDW: LaQBq: goto ggMFJ; pGa0D: if (empty($standardId)) { goto LaQBq; } goto alAW6; alAW6: Db::table("\x73\x75\142\152\x65\143\164\137\163\164\141\x6e\x64\141\162\x64")->where(["\x69\x64" => $standardId])->update($formData); goto X8TZB; D3zZv: I9WBv: goto jE_Wk; icQ6S: Db::table("\163\165\142\152\145\x63\164\137\163\164\141\x6e\144\x61\x72\x64")->insert($formData); goto D3zZv; ggMFJ: $formData["\163\165\x62\152\x65\143\x74\x5f\x69\144"] = $subjectId; goto icQ6S; umpmu: goto I9WBv; goto x1DDW; X8TZB: Db::table("\x73\165\x62\x6a\x65\143\x74\x5f\163\164\141\156\144\x61\x72\x64\137\x6c\141\164\151\164\165\144\x65")->where(["\163\x74\x61\x6e\144\x61\x72\x64\137\x69\x64" => $standardId])->update(["\154\141\x74\151\164\165\x64\x65" => $formData["\x6c\141\164\x69\x74\x75\144\x65"]]); goto umpmu; jE_Wk: } public function removeSubjectStandard($subjectId, $standardId) { goto dFSp7; Kkvz5: $this->updateSubjectStandardMinMax($subjectId); goto p_a0T; MIfWj: Db::table("\x73\165\142\x6a\x65\x63\164\x5f\x73\164\141\x6e\x64\x61\x72\x64\x5f\154\x61\164\x69\164\165\144\x65")->where("\x73\x74\141\156\144\141\162\144\137\151\x64", $standardId)->delete(); goto Kkvz5; dFSp7: Db::table("\163\x75\x62\152\145\x63\x74\137\x73\x74\141\156\x64\141\x72\x64")->where(["\151\144" => $standardId])->delete(); goto ig2_9; ig2_9: Db::table("\x73\165\142\x6a\x65\x63\164\137\x69\x74\x65\x6d\x5f\x73\x74\x61\156\144\x61\x72\144")->where("\163\164\x61\156\x64\141\x72\144\137\x69\x64", $standardId)->delete(); goto MIfWj; p_a0T: } public function saveSubject($id, $formData) { goto Xe5fs; dCHuT: bRoc9: goto DFE8f; TOkZa: if ($model) { goto UouFS; } goto Lth6Y; yoMvg: $formData["\151\155\141\147\145\137\x75\x72\x6c"] = $imageUrl; goto shf1t; H23b9: hTlXz: goto NqeKc; oiIvc: $originals = Db::table("\x73\165\142\x6a\x65\x63\x74")->where(["\x69\x64" => $id])->field(true)->find(); goto GkaQL; Xe5fs: if (empty($id)) { goto Zcg6h; } goto uJwDF; RFel0: $subjectName = Db::table("\x73\x75\142\x6a\x65\143\x74")->where(["\151\144" => $subjectId])->value("\156\x61\x6d\145"); goto tS0Mz; adbgt: goto tRrRl; goto R2Ae9; GkaQL: goto mmUkl; goto qGt8u; shf1t: YV27b: goto bmCOn; j7YrM: if (empty($id)) { goto bRoc9; } goto ibh0H; WpycB: tRrRl: goto b4dBY; Lth6Y: wexception("\xe6\227\xa0\346\263\x95\xe6\211\xbe\xe5\210\260\xe8\xaf\xa5\351\207\x8f\350\xa1\xa8"); goto xx01X; Nl3N2: OperationLogs::I()->subjectLog("\xe4\277\256\xe6\224\271\351\207\217\xe8\241\xa8\x20\x2d\x20\40{$subjectName}", beautifyLogArray($formData, $originals, "\x73\165\142\152\145\x63\x74"), OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto dDMaF; uJwDF: $model = SubjectModel::get($id); goto TOkZa; ibh0H: $subjectId = $id; goto X1x_1; ELZJM: $model = new SubjectModel(); goto iFtM9; ESPd9: mmUkl: goto SHolH; DFE8f: $subjectId = $model->id; goto RFel0; anexi: fi9kt: goto pUdMm; VROZt: Db::table("\x73\x75\x62\152\x65\143\x74\x5f\143\x61\164\x65\x67\157\x72\171\x5f\162\x65\154\141\164\145")->where(["\163\x75\142\152\145\143\164\137\x69\144" => $subjectId])->delete(); goto adbgt; XHxuo: $model->allowField(true)->save(); goto j7YrM; xx01X: UouFS: goto oiIvc; R2Ae9: B9vuw: goto jbHUu; FmKcK: if (!$imageUrl) { goto YV27b; } goto yoMvg; NqeKc: if ($categoryIds) { goto B9vuw; } goto VROZt; b4dBY: foreach ($categoryIds as $categoryId) { goto tqZ47; t1HWx: uOOOT: goto tNDQZ; BERG3: Db::table("\x73\x75\x62\x6a\x65\x63\x74\137\x63\141\164\145\147\157\x72\x79\x5f\x72\x65\x6c\x61\x74\145")->insert(["\163\165\142\152\145\143\164\137\x69\x64" => $subjectId, "\143\x61\164\x65\x67\x6f\162\x79\x5f\151\144" => $categoryId]); goto t1HWx; tqZ47: $bExist = Db::table("\163\165\x62\x6a\x65\143\x74\137\x63\x61\x74\x65\x67\x6f\x72\x79\x5f\162\145\x6c\141\x74\145")->where(["\x73\165\142\152\145\143\x74\x5f\151\144" => $subjectId, "\x63\141\x74\x65\147\157\162\x79\137\151\x64" => $categoryId])->find(); goto Z0KsH; Z0KsH: if ($bExist) { goto uOOOT; } goto BERG3; tNDQZ: ozy3F: goto QGxdr; QGxdr: } goto anexi; SHolH: $formData["\165\x6e\151\x5f\141\x70\160"] = $formData["\165\x6e\x69\x5f\x61\x70\x70"] ?? 0; goto gsCwL; DPgsw: $categoryIds = []; goto Cpu4N; jbHUu: Db::table("\163\x75\142\x6a\x65\x63\x74\x5f\143\141\x74\145\147\157\162\171\x5f\x72\x65\x6c\x61\x74\x65")->where(["\163\x75\x62\152\x65\x63\164\137\151\144" => $subjectId, "\x63\x61\x74\145\147\x6f\x72\x79\x5f\x69\144" => ["\156\157\x74\x20\151\x6e", $categoryIds]])->delete(); goto WpycB; tS0Mz: OperationLogs::I()->subjectLog("\346\x96\xb0\345\xa2\236\351\x87\217\350\241\250\x20\55\40{$subjectName}", beautifyLogArray($formData, [], "\163\x75\142\x6a\145\x63\x74"), OperationLogs::OPT_ADD_TYPE, $subjectId); goto avuKO; X1x_1: $subjectName = Db::table("\163\165\x62\152\x65\x63\x74")->where(["\x69\x64" => $id])->value("\x6e\x61\155\145"); goto Nl3N2; MxRWd: $categoryIds = explode("\54", $formData["\143\x61\164\x65\x67\x6f\x72\x79\137\151\x64\163"]); goto H23b9; Cpu4N: if (!$formData["\143\141\164\x65\x67\x6f\x72\171\x5f\x69\x64\163"]) { goto hTlXz; } goto MxRWd; dDXft: $imageUrl = autoGenerateImage($formData["\156\141\x6d\x65"], $formData["\151\x6d\x61\147\145\x5f\165\162\154"]); goto FmKcK; iFtM9: $formData["\x73\x6e"] = generateSubjectSn(); goto ESPd9; qGt8u: Zcg6h: goto ELZJM; bmCOn: $model->data($formData); goto XHxuo; avuKO: Go3XA: goto DPgsw; dDMaF: goto Go3XA; goto dCHuT; gsCwL: $formData["\x6d\x6f\144\x69\x66\171\x5f\x74\x69\155\145"] = date("\x59\55\155\55\x64\40\110\72\x69\x3a\x73"); goto dDXft; pUdMm: } public function setLabel($subjectId, $label, $action) { goto yrtBz; MMV_t: i4Ct_: goto Ye2Py; qwyGd: $value = array_filter($value, function ($v) use($label) { return $v != $label; }); goto Z1VSt; mSqol: if (!($label == "\x62\x61\156\x6e\x65\162")) { goto TKKo2; } goto GDgl_; Z1VSt: goto i4Ct_; goto KOr12; KOr12: TCD7d: goto mSqol; pVoRY: $value = $value ? explode("\x2c", $value) : []; goto PEKxN; K9gSx: $value = $subject["\x6c\141\142\145\x6c"]; goto pVoRY; QGgnU: if (!empty($subject)) { goto IcYdc; } goto Et2HJ; yrtBz: $subject = Db::table("\x73\165\142\x6a\x65\x63\x74")->where(["\x69\x64" => $subjectId])->field("\x6c\141\142\x65\x6c\54\x20\151\x6d\141\147\x65\x5f\x75\162\154\x2c\x20\x62\141\x6e\x6e\x65\162\x5f\151\155\x67")->find(); goto QGgnU; n2O3W: IcYdc: goto K9gSx; Ye2Py: Db::table("\163\165\x62\x6a\145\143\164")->where(["\151\x64" => $subjectId])->setField("\154\141\x62\x65\154", join("\x2c", $value)); goto vdwow; zUP2_: $value[] = $label; goto MMV_t; Et2HJ: wexception("\346\x97\240\346\xb3\225\346\211\xbe\345\x88\260\350\257\xa5\351\207\217\xe8\xa1\250"); goto n2O3W; cny0l: wexception("\350\xae\xbe\xe4\270\272\xe8\275\256\346\222\xad\xef\xbc\214\xe9\207\x8f\350\241\250\xe5\x9b\276\347\x89\x87\344\xb8\215\350\203\xbd\xe4\270\xba\xe7\251\272"); goto r_YYC; GDgl_: if (!(empty($subject["\x69\x6d\141\x67\x65\x5f\165\162\x6c"]) && empty($subject["\x62\x61\x6e\x6e\145\x72\x5f\x69\155\147"]))) { goto NKfiT; } goto cny0l; r_YYC: NKfiT: goto dgV6M; PEKxN: if ($action == "\x74\x72\x75\145" || $action == "\61") { goto TCD7d; } goto qwyGd; dgV6M: TKKo2: goto zUP2_; vdwow: } public function qrcode($id) { goto UrXo3; MoTRO: return $path; goto ub1uO; xLQQ8: if ($result) { goto GfrhR; } goto U7iWq; U7iWq: wexception("\345\x86\231\xe5\x85\245\345\233\276\345\x83\217\346\x96\x87\344\xbb\xb6\345\xa4\261\350\264\xa5"); goto Eu96W; QOT9d: $result = file_put_contents(SITE_DIR . $path, file_get_contents($url)); goto xLQQ8; Eu96W: GfrhR: goto uH1zS; A8stQ: $app = \EasyWeChat\Factory::officialAccount(config("\x77\x78\x2e\157\146\146\151\143\151\x61\x6c\137\141\143\x63\157\165\156\164")); goto mr_Ew; UrXo3: $subject = $this->getSubject($id); goto h2PAL; Sa0qU: if (systemSetting("\127\x58\137\x4f\x46\x46\111\x43\105\x5f\101\x43\103\x4f\125\x4e\124\x5f\101\x50\120\137\x49\x44")) { goto W370o; } goto WDwoB; h2PAL: if ($subject) { goto xGJnv; } goto ur0rE; qsqs6: xGJnv: goto Sa0qU; C1kqj: try { goto afqlh; IelUU: $url = $app->qrcode->url($res["\x74\151\x63\153\x65\x74"]); goto pi4dt; mVJpm: if (!(!$res || !isset($res["\x74\x69\143\x6b\145\x74"]))) { goto aH2nj; } goto id5xq; InppN: Log::notice("\163\165\x62\x6a\x65\143\164\x20\161\x72\143\157\x64\x65\x20\162\145\164\x75\x72\156\40" . var_export($res, true)); goto G1XJc; Qx902: aH2nj: goto IelUU; G1XJc: K1nOH: goto mVJpm; id5xq: exception("\xe6\216\245\xe5\217\xa3\350\xbf\224\xe5\x9b\x9e\xe5\244\xb1\xe8\xb4\xa5\x2c\x20" . var_export($res, true)); goto Qx902; afqlh: $res = $app->qrcode->forever($scene_id); goto S2tEk; S2tEk: if (!$res) { goto K1nOH; } goto InppN; pi4dt: } catch (\Exception $e) { wexception("\xe7\x94\237\346\210\220\xe5\xa4\261\xe8\264\245\xef\274\232" . $e->getMessage()); } goto j_EX0; lQTl7: W370o: goto A8stQ; mr_Ew: $scene_id = "\164\x65\x73\x74\x5f\x69\x64\x5f" . $id; goto C1kqj; ur0rE: wexception("\346\x97\xa0\xe6\263\225\346\x89\xbe\345\210\260\xe8\257\245\xe9\207\217\350\241\250"); goto qsqs6; uH1zS: Db::table("\x73\165\x62\x6a\x65\143\164")->where(["\151\x64" => $id])->setField("\x71\162\x63\157\x64\145", $path); goto MoTRO; j_EX0: $path = "\x2f\161\162\x63\157\x64\x65\x2f" . $scene_id . "\56\152\x70\x67"; goto QOT9d; WDwoB: wexception("\xe7\224\x9f\346\x88\x90\345\244\261\xe8\xb4\xa5\357\274\x9a\346\x9c\252\351\205\215\347\xbd\xae\xe5\x85\xac\xe4\xbc\x97\xe5\x8f\267\xe5\217\x82\346\x95\260"); goto lQTl7; ub1uO: } public function remove($id) { goto SB_MS; SB_MS: $subject = $this->getSubject($id); goto Kqjqb; wscEl: gOY9G: goto lJC86; lJC86: Db::table("\x73\x75\142\x6a\x65\143\x74")->where(["\x69\x64" => $id])->setField("\x64\x65\x6c\x65\164\145\x5f\146\154\x61\147", "\61"); goto GHj4A; GHj4A: OperationLogs::I()->subjectLog("\345\x88\xa0\xe9\231\xa4\xe9\207\217\350\241\250", $subject["\156\141\x6d\145"], OperationLogs::OPT_DELETE_TYPE, $id); goto cIlcJ; Kqjqb: if ($subject) { goto gOY9G; } goto WZn7d; WZn7d: wexception("\xe6\227\xa0\xe6\xb3\225\xe6\211\xbe\345\x88\xb0\xe8\257\245\xe9\207\217\350\241\xa8"); goto wscEl; cIlcJ: } public function restore($id) { goto kxip2; kxip2: $subject = $this->getSubject($id); goto Z0yzh; a8gw1: Db::table("\x73\165\142\152\x65\143\x74")->where(["\151\x64" => $id])->setField("\144\x65\154\145\x74\145\x5f\x66\x6c\x61\147", "\x30"); goto QnyNl; yBqc2: wexception("\xe6\x97\240\xe6\xb3\225\346\x89\xbe\345\210\xb0\350\xaf\xa5\xe9\x87\217\xe8\241\250"); goto PeHlV; PeHlV: SuCND: goto a8gw1; Z0yzh: if ($subject) { goto SuCND; } goto yBqc2; QnyNl: OperationLogs::I()->subjectLog("\xe6\x81\242\xe5\xa4\215\xe9\207\217\350\xa1\xa8", $subject["\156\141\155\145"], OperationLogs::OPT_RESTORE_TYPE, $id); goto uVRah; uVRah: } public function removeForce($id) { goto aFqKH; T7B9d: ZeeOs: goto WAS9x; PhlgK: wexception("\xe8\xaf\xa5\351\207\217\xe8\241\250\xe5\x85\xb3\xe8\x81\224\xe7\273\204\345\220\x88\351\207\x8f\xe8\xa1\xa8\57\xe6\x99\xae\xe6\237\xa5\xef\274\x8c\344\xb8\215\xe8\x83\xbd\345\210\240\351\231\xa4"); goto T7B9d; wD79T: Db::table("\165\x6e\151\x5f\x61\x70\x70\x5f\x6f\x72\x64\x65\x72\163")->where("\x73\165\142\152\145\x63\164\x5f\x69\144", $id)->delete(); goto n1yHG; UwtNV: if (!($subjectCb || $subjectSurvey)) { goto ZeeOs; } goto PhlgK; fHK6Q: $subjectSurvey = Db::table("\163\165\x72\166\x65\x79")->where([["\x65\170\160", Db::raw("\x46\x49\x4e\x44\x5f\x49\116\x5f\123\x45\124\50{$id}\x2c\40\163\165\142\152\x65\143\164\163\51")]])->find(); goto UwtNV; WAS9x: $goods = Db::table("\144\151\x61\156\x5f\x67\157\157\144\163")->where(["\163\165\142\x6a\x65\x63\x74\137\151\x64" => $id])->find(); goto MaX_R; wYpFu: Db::table("\163\x75\x62\x6a\145\x63\164\137\157\162\x64\x65\162")->where("\x73\x75\x62\x6a\145\143\x74\137\151\144", $id)->delete(); goto lVmgM; n1yHG: Db::table("\x73\165\x62\x6a\x65\143\164\x5f\151\x74\145\155")->where("\163\165\x62\152\145\143\x74\x5f\151\144", $id)->delete(); goto UbZPB; H3MNd: wexception("\345\xb7\262\xe5\217\221\345\xb8\x83\347\224\265\345\x95\206\344\272\xa7\xe5\223\x81\357\274\214\xe4\270\x8d\350\203\xbd\xe5\x88\xa0\xe9\x99\244"); goto Jlv6C; UbZPB: Db::table("\163\x75\142\x6a\x65\143\164\x5f\x69\164\145\x6d\x5f\x73\164\141\x6e\144\x61\162\144")->where("\163\165\142\152\145\x63\x74\137\151\144", $id)->delete(); goto J42RB; aFqKH: $subject = $this->getSubject($id); goto d3Hqf; sLSmN: Db::table("\163\x75\142\x6a\x65\143\164\x5f\x73\164\x61\156\x64\141\162\144\137\154\x61\164\x69\x74\x75\144\145")->where("\163\165\142\x6a\145\x63\164\x5f\x69\144", $id)->delete(); goto oczYu; J42RB: Db::table("\163\x75\x62\x6a\145\143\164\x5f\163\164\x61\156\x64\141\162\x64")->where("\163\x75\x62\x6a\145\143\164\137\151\144", $id)->delete(); goto sLSmN; M6bWd: $subjectCb = Db::table("\163\x75\x62\152\x65\143\x74\137\143\x6f\155\x62\x69\156\141\164\151\157\156")->where([["\145\170\x70", Db::raw("\106\111\116\104\137\111\x4e\137\x53\x45\x54\50{$id}\54\40\163\165\142\152\x65\143\x74\x73\x29")]])->find(); goto fHK6Q; i4Evh: Db::table("\x73\165\142\x6a\x65\143\x74\137\x63\x6f\x6c\x6c\x65\143\164")->where("\x73\x75\x62\x6a\145\x63\164\137\151\144", $id)->delete(); goto wYpFu; D835o: JN2s5: goto M6bWd; Yh8jn: wexception("\346\227\240\346\xb3\225\346\x89\xbe\xe5\210\xb0\xe8\257\245\xe9\x87\x8f\350\241\xa8"); goto D835o; Jlv6C: BfVIQ: goto wD79T; lVmgM: Db::table("\163\x75\x62\152\x65\143\x74")->where("\x69\144", $id)->delete(); goto S48uJ; d3Hqf: if ($subject) { goto JN2s5; } goto Yh8jn; oczYu: Db::table("\163\165\x62\152\145\143\x74\137\x63\141\164\145\147\x6f\x72\x79\x5f\x72\x65\x6c\x61\164\x65")->where("\163\165\x62\152\145\x63\x74\137\151\144", $id)->delete(); goto i4Evh; MaX_R: if (!$goods) { goto BfVIQ; } goto H3MNd; S48uJ: OperationLogs::I()->subjectLog("\xe7\xa1\xac\xe5\210\xa0\351\x99\244\351\207\217\350\241\xa8", $subject["\x6e\141\x6d\145"], OperationLogs::OPT_DELETE_TYPE, $id); goto bYK7V; bYK7V: } public function saveSubjectReport($id, $formData) { goto UTd5Y; SvDUW: if (empty($formData["\162\x65\x70\157\x72\x74\137\145\154\145\x6d\145\x6e\164\x73"])) { goto JgqlK; } goto NBMYM; usmKo: OperationLogs::I()->subjectLog("\xe4\xbf\256\346\224\xb9\xe9\207\217\350\xa1\xa8\xe6\x8a\xa5\xe5\x91\212\40\55\x20{$originals["\156\141\x6d\x65"]}", beautifyLogArray($formData, $originals, "\x73\165\142\x6a\145\x63\x74"), OperationLogs::OPT_UPDATE_TYPE, $id); goto pBP6r; YuL0f: if (!$result) { goto Xf0Db; } goto usmKo; qB3GS: $model->data($formData); goto a0v9u; UTd5Y: $model = SubjectModel::get($id); goto B0KQi; vyK_C: goto n5KgL; goto yXNRO; a0v9u: $result = $model->allowField(true)->save(); goto YuL0f; n6Wuu: n5KgL: goto qB3GS; BNeQo: $originals = Db::table("\x73\x75\142\152\x65\143\x74")->where(["\x69\x64" => $id])->field(true)->find(); goto SvDUW; yXNRO: JgqlK: goto Ep42S; B0KQi: if ($model) { goto Ezh4X; } goto CRLJF; CRLJF: exception("\346\x97\240\xe6\263\x95\xe6\x89\276\345\210\xb0\xe8\257\245\xe9\207\217\350\241\xa8"); goto VX2Ls; pBP6r: Xf0Db: goto ODQS9; VX2Ls: Ezh4X: goto BNeQo; NBMYM: $formData["\x72\x65\160\x6f\162\x74\x5f\145\154\145\x6d\x65\x6e\164\x73"] = implode("\x2c", $formData["\162\145\x70\157\162\x74\137\145\x6c\145\x6d\145\156\x74\x73"]); goto vyK_C; Ep42S: $formData["\162\x65\x70\x6f\x72\164\137\145\154\145\155\145\156\164\x73"] = ''; goto n6Wuu; ODQS9: } public function updateSubjectStandardMinMax($subjectId) { goto JYzBi; rPUtA: foreach ($latitudes as $standardId => $latitude) { goto RsAHn; XwYAc: goto tx2q3; goto l7hvr; fPCog: foreach ($records as $record) { goto HKZrX; GTnU4: t5l13: goto y6hAQ; KByJi: goto t5l13; goto AdCfE; PYahF: if ($items[$itemId]["\x74\x79\160\145"] == Defs::QUESTION_RADIO) { goto Rbxx3; } goto EMxFP; srdcH: $itemWeight = []; goto ak5xv; l1pJR: Rbxx3: goto KtSxj; hV46J: $itemWeight[] = round($items[$itemId][$field] / 100, 2); goto DxsrU; KtSxj: Tlc1m: goto HAc7w; pYUwj: $field = "\167\145\x69\147\150\164\137" . $i; goto uWDR6; ak5xv: $i = 1; goto HN0Dn; HuolV: sRpla: goto JJrCb; EMxFP: if (!($items[$itemId]["\164\171\160\145"] == Defs::QUESTION_CHECKBOX)) { goto l2C6Y; } goto yoydQ; HAc7w: $itemWeights[] = $itemWeight; goto GTnU4; r5OIt: goto sRpla; goto zsN6V; AdCfE: tr307: goto PYahF; S6MWR: if (!($i <= 12)) { goto sRpla; } goto pYUwj; phXeR: l2C6Y: goto RGOaz; HN0Dn: pTOpr: goto S6MWR; RGOaz: goto Tlc1m; goto l1pJR; yoydQ: $itemWeight[] = array_sum($itemWeight); goto phXeR; fc5YB: goto pTOpr; goto HuolV; uWDR6: if (!($items[$itemId][$field] === null)) { goto yvc1P; } goto r5OIt; JJrCb: if (!empty($itemWeight)) { goto tr307; } goto KByJi; DxsrU: $i++; goto fc5YB; HKZrX: $itemId = $record["\x69\x74\x65\x6d\137\x69\144"]; goto srdcH; zsN6V: yvc1P: goto hV46J; y6hAQ: } goto dSm9k; dSm9k: PfUkM: goto EKO4n; p347l: Db::table("\x73\x75\x62\x6a\145\143\164\137\x73\164\x61\156\x64\x61\x72\x64")->where(["\x73\165\142\x6a\x65\143\164\137\151\x64" => $subjectId, "\x69\x64" => $standardId])->update(["\163\164\x61\x74\x69\163\164\x69\143\137\x77\x65\x69\x67\x68\x74\137\155\151\x6e" => 0, "\163\164\x61\x74\x69\x73\164\x69\x63\x5f\x77\145\x69\147\x68\164\x5f\x6d\x61\x78" => 0]); goto XwYAc; ZmLNN: $points = $this->calculatePointsDirect($itemWeights); goto O17SB; JEHyw: tx2q3: goto wKjZH; cDm5u: Db::table("\x73\165\142\152\x65\x63\x74\x5f\x73\x74\141\156\x64\141\x72\144")->where(["\163\x75\142\152\145\143\x74\x5f\x69\144" => $subjectId, "\x69\x64" => $standardId])->update(["\163\164\141\x74\x69\x73\164\151\x63\137\x77\x65\151\x67\x68\164\137\155\151\156" => $weightMin, "\x73\164\141\164\x69\x73\164\x69\143\x5f\x77\x65\151\147\x68\x74\x5f\x6d\x61\170" => $weightMax]); goto JEHyw; O17SB: list($weightMin, $weightMax) = $points; goto cDm5u; EKO4n: if (!empty($itemWeights)) { goto aBJ2B; } goto p347l; RsAHn: $itemWeights = []; goto kB18d; kB18d: $records = Db::table("\x73\165\142\x6a\145\x63\x74\137\151\x74\x65\155\x5f\163\x74\141\x6e\x64\141\x72\144")->where(["\163\x75\142\152\145\x63\x74\x5f\151\x64" => $subjectId, "\163\164\x61\156\x64\141\162\144\x5f\x69\144" => $standardId, "\x69\164\x65\155\137\x69\x64" => ["\151\x6e", $itemIds]])->field("\151\164\145\155\x5f\151\144")->select(); goto fPCog; l7hvr: aBJ2B: goto ZmLNN; wKjZH: } goto A3nzh; C3yDJ: Db::table("\x73\165\x62\152\145\143\x74")->where(["\x69\x64" => $subjectId])->update(["\x69\x74\x65\x6d\163" => count($itemIds)]); goto l3B6_; NgwXI: foreach ($items as $item) { goto mbU8W; TckRa: htY2H: goto dNtui; mU1GX: if (!($item[$field] === null)) { goto N67uw; } goto lJ8YD; X5u93: N67uw: goto O_5mb; dNtui: if (!empty($itemWeight)) { goto x4a_v; } goto oLb3x; mvge5: if (!($i <= 12)) { goto htY2H; } goto vdSE8; GCa6T: goto fOKBK; goto TckRa; k1Jqi: $i = 1; goto xa7o3; CCXMq: XUrdv: goto JmBRE; O_5mb: $itemWeight[] = round($item[$field] / 100, 2); goto MJOMi; MJOMi: $i++; goto GCa6T; oLb3x: goto XUrdv; goto MhRp2; MhRp2: x4a_v: goto Vi_Gr; xa7o3: fOKBK: goto mvge5; mbU8W: $itemWeight = []; goto k1Jqi; Vi_Gr: $itemWeights[] = $itemWeight; goto CCXMq; lJ8YD: goto htY2H; goto X5u93; vdSE8: $field = "\x77\x65\x69\x67\150\164\x5f" . $i; goto mU1GX; JmBRE: } goto Vwg97; A3nzh: TuVCc: goto s7rpT; Vwg97: hNkRz: goto eJee4; JYzBi: $items = Db::table("\163\x75\x62\x6a\145\143\x74\x5f\151\x74\145\155")->where("\x73\x75\x62\152\145\x63\x74\x5f\x69\144", $subjectId)->column("\x69\x64\x2c\x20\164\x79\x70\145\54\x20\167\145\x69\x67\150\x74\137\x31\x2c\x77\x65\151\x67\x68\164\137\x32\54\x77\x65\151\147\x68\x74\137\x33\x2c\x77\x65\151\147\x68\164\137\64\54\167\145\151\x67\150\x74\137\x35\54\x77\x65\x69\x67\x68\x74\137\x36\x2c\167\145\151\147\x68\x74\137\67\x2c\167\x65\151\x67\x68\x74\137\70\54\167\x65\x69\147\x68\164\x5f\x39\54\x77\145\x69\147\x68\x74\137\61\x30\x2c\167\145\x69\147\150\x74\x5f\x31\61\54\x77\x65\151\x67\x68\x74\x5f\x31\x32"); goto ww9nZ; ww9nZ: $itemIds = array_keys($items); goto xEtz1; agtCL: list($weightMin, $weightMax) = $points; goto C3yDJ; l3B6_: Db::table("\x73\165\x62\152\x65\143\x74")->where(["\151\144" => $subjectId])->update(["\163\x74\x61\x74\151\x73\x74\x69\x63\x5f\167\145\151\147\x68\x74\x5f\x6d\151\156" => $weightMin, "\163\x74\141\164\x69\163\x74\x69\143\x5f\167\x65\151\147\x68\x74\137\x6d\141\170" => $weightMax]); goto HVE13; eJee4: $points = $this->calculatePointsDirect($itemWeights); goto agtCL; xEtz1: $itemWeights = []; goto NgwXI; HVE13: $latitudes = Db::table("\163\165\142\x6a\x65\143\x74\x5f\163\x74\141\x6e\144\141\x72\144")->where("\163\165\x62\x6a\x65\x63\x74\x5f\151\144", $subjectId)->order("\x73\x6f\162\x74\x20\x61\163\143\x2c\40\151\x64\x20\x61\x73\x63")->column("\154\141\x74\x69\164\x75\144\145", "\x69\x64"); goto rPUtA; s7rpT: } protected function calculatePointsDirect($itemWeights) { goto WCdyi; WCdyi: $pointMin = 0; goto MuHll; dvtYh: foreach ($itemWeights as $itemWeight) { goto vWWR9; SAYJ5: OTtR5: goto Fei7V; BvSIb: goto HlvwQ; goto SAYJ5; YgJQ3: $pointMax += max($itemWeight); goto wOWNa; Fei7V: $pointMin += min($itemWeight); goto YgJQ3; vWWR9: if (!empty($itemWeight)) { goto OTtR5; } goto BvSIb; wOWNa: HlvwQ: goto prGYA; prGYA: } goto GPv_D; GPv_D: VYtrv: goto WXukM; WXukM: return [$pointMin, $pointMax]; goto NtXqO; MuHll: $pointMax = 0; goto dvtYh; NtXqO: } public function loadLatitudes($subjectId, $standardId) { goto LGCMr; G_1Hv: foreach ($rows as &$row) { goto EOWLA; u5SnD: $row["\163\x74\x61\156\144\137\x64\145\x73\x63"] = ellipsisString($row["\x73\164\x61\x6e\x64\x5f\144\x65\x73\143"], 32); goto Cvvpv; dh0K3: H9rF2: goto NiemY; ftmkS: $row["\x65\x78\x70\162\145\163\x73\151\157\156"] = convertSubjectExpression($expression); goto u5SnD; EOWLA: $expression = $row["\x65\170\x70\x72\145\x73\x73\x69\x6f\156"]; goto ftmkS; Cvvpv: $row["\162\145\x6d\141\x72\153"] = ellipsisString($row["\x72\x65\x6d\x61\x72\x6b"], 32); goto dh0K3; NiemY: } goto Gj3nJ; Gj3nJ: IrPih: goto GZMd7; LGCMr: $rows = Db::table("\x73\x75\x62\x6a\x65\x63\164\x5f\x73\164\x61\156\144\141\x72\144\137\x6c\141\164\x69\x74\165\144\145")->where(["\x73\165\x62\152\x65\x63\x74\x5f\x69\144" => $subjectId, "\163\164\x61\x6e\144\x61\x72\x64\137\x69\x64" => $standardId])->order("\x73\164\141\x6e\x64\141\162\144\137\151\144\x20\141\x73\x63")->field("\52")->select(); goto G_1Hv; GZMd7: return $rows; goto qfPck; qfPck: } public function getLatitude($id) { $latitude = Db::table("\x73\x75\x62\x6a\145\143\164\x5f\x73\x74\x61\x6e\x64\x61\162\144\137\154\141\164\151\164\165\144\x65")->where("\x69\x64", $id)->field(true)->find(); return $latitude; } protected function convertExpressionJson2Value($obj, $expression) { goto K3sK6; toanY: foreach ($obj["\143\150\x69\154\x64\x72\145\x6e"] as $index => $objChild) { goto k8kB0; bzZG1: qBftL: goto dn10p; dfogY: $expression .= "\x29"; goto yyb2f; qdnHp: dLcLL: goto xZ3_A; dn10p: if (!(isset($objChild["\x6f\160"]) && isset($objChild["\143\x68\151\x6c\144\162\x65\x6e"]) && $objChild["\x63\x68\x69\x6c\x64\x72\x65\156"])) { goto ex7jQ; } goto wwqBg; pK1k4: ex7jQ: goto qdnHp; k8kB0: if (!(isset($objChild["\146\151\145\x6c\144"]) && $objChild["\x66\x69\x65\154\x64"] && isset($objChild["\x6f\160"]) && $objChild["\157\x70"] && isset($objChild["\166\x61\154\x75\x65"]))) { goto qBftL; } goto DHEfN; T7HRc: $expression .= $objChild["\157\x70"]; goto uOw8x; DHEfN: $expression .= $objChild["\146\151\145\154\x64"]; goto T7HRc; yyb2f: $expression .= $operator; goto pK1k4; B3Zoz: $expression .= $operator; goto hUowC; wwqBg: $expression .= "\x28"; goto NSNqQ; NSNqQ: $expression = $this->convertExpressionJson2Value($objChild, $expression); goto dfogY; hUowC: goto dLcLL; goto bzZG1; uOw8x: $expression .= $objChild["\166\141\154\x75\145"]; goto B3Zoz; xZ3_A: } goto EFjod; nl0v1: return $expression; goto Z1J23; K3sK6: $operator = "\x26\x26"; goto EOHTP; O5g5s: J1yca: goto toanY; EOHTP: if (!($obj["\x6f\x70"] == "\157\162")) { goto J1yca; } goto FsnhS; EFjod: RHMDI: goto q8ki1; q8ki1: $expression = rtrim($expression, $operator); goto nl0v1; FsnhS: $operator = "\x7c\174"; goto O5g5s; Z1J23: } public function saveLatitude($subjectId, $standardId, $id, $formData) { goto S0mCt; S0mCt: $formData["\145\x78\x70\162\x65\x73\163\151\157\156\137\152\163\x6f\156"] = htmlspecialchars_decode($formData["\145\x78\x70\x72\145\x73\x73\151\157\156\x5f\x6a\163\x6f\156"]); goto ylYgt; C9ypH: goto D6TUz; goto vN0V3; Ut0Al: if (!($latitude === null)) { goto Hhmh9; } goto E9xxe; IsObs: $formData["\163\165\x62\152\145\x63\164\137\151\x64"] = $subjectId; goto XuH6P; ylYgt: $expression = $this->convertExpressionJson2Value(json_decode($formData["\x65\170\160\x72\x65\x73\x73\x69\157\x6e\137\x6a\163\x6f\x6e"], true), ''); goto R1Ok3; QgSlz: $latitude = Db::table("\163\165\142\152\x65\143\x74\137\x73\164\x61\156\x64\141\x72\x64")->where(["\151\144" => $standardId])->value("\154\141\x74\x69\x74\x75\144\x65"); goto Ut0Al; DYxbg: Ghjyx: goto AOEOD; E9xxe: wexception("\346\x97\240\346\263\225\xe6\211\276\xe5\210\xb0\346\x89\200\345\xb1\236\xe7\x9a\x84\xe7\xbb\264\xe5\xba\xa6"); goto d4SJU; kPoly: $formData["\x6c\141\x74\151\164\165\144\x65"] = $latitude; goto C9ypH; CWsbD: Db::table("\163\x75\142\x6a\145\x63\164\x5f\163\164\x61\x6e\x64\141\x72\144\137\x6c\141\x74\x69\x74\x75\144\x65")->insert($formData); goto DYxbg; Xj7q1: Db::table("\163\165\142\152\x65\x63\x74\137\x73\x74\141\x6e\144\x61\162\x64\x5f\x6c\141\164\x69\164\x75\144\x65")->where("\151\x64", $id)->update($formData); goto ohEel; d4SJU: Hhmh9: goto kPoly; yJyXn: if (empty($id)) { goto V7r2d; } goto Xj7q1; rZf6z: if ($standardId == 0) { goto z3agL; } goto QgSlz; R1Ok3: $formData["\145\x78\160\162\x65\163\163\x69\157\156"] = $expression; goto IsObs; vN0V3: z3agL: goto OajNM; Y4a6K: D6TUz: goto yJyXn; XuH6P: $formData["\163\164\x61\156\144\141\162\x64\x5f\151\144"] = $standardId; goto rZf6z; ohEel: goto Ghjyx; goto N17ln; OajNM: $formData["\154\141\x74\x69\x74\x75\x64\x65"] = Defs::SUBJECT_WHOLE_STANDARD; goto Y4a6K; N17ln: V7r2d: goto CWsbD; AOEOD: } public function removeLatitude($id) { Db::table("\163\x75\142\152\x65\143\x74\137\163\164\141\156\x64\141\162\144\137\154\141\x74\151\x74\x75\144\x65")->where(["\x69\144" => $id])->delete(); } public function loadSubjectItems($subjectId) { goto rXgP4; ZfzVh: return $rows; goto pf2SH; nylGn: $items = Db::table("\163\165\x62\152\x65\x63\x74\x5f\x69\x74\145\155")->where(["\x73\x75\142\152\x65\x63\164\x5f\x69\x64" => $subjectId])->field(true)->order("\163\x6f\x72\164\40\141\x73\143\54\x20\151\144\x20\141\163\143")->select(); goto uDYqP; rXgP4: $rows = []; goto nylGn; uDYqP: foreach ($items as $index => $item) { goto NGr92; h4oTp: goto DpI2Z; goto y9SeJ; e7IWi: if (!$item["\151\x6d\141\x67\145"]) { goto hPAPC; } goto aQWfx; MzihJ: MPfMe: goto e7IWi; eVDqE: goto sUA4E; goto mWXlk; lVOJg: $row["\151\164\x65\x6d\x5f\157\160\x74\x69\x6f\156"] .= "\x3b\x20"; goto DnKkP; B0Yzc: DpI2Z: goto Qgn0B; aQWfx: $row["\x69\x6d\x61\147\145"] = "\74\x69\x6d\x67\x20\x63\x6c\x61\x73\x73\x3d\42\155\171\55\61\x22\40\x73\162\143\x3d\42" . generateThumbnailUrl($item["\x69\x6d\141\147\145"], 100, "\57\x73\164\x61\164\x69\x63\57\151\155\x67\57\x64\157\x74\x2e\160\156\147") . "\42\x20\x73\164\171\x6c\145\75\42\155\141\x78\x2d\x77\151\144\x74\x68\x3a\61\x30\x30\x70\x78\73\x22\76"; goto udiaP; JcmLA: Mxn8o: goto llSgv; cAGin: $optionIndex++; goto h4oTp; SG0cg: $latitudes = Db::table("\x73\x75\142\x6a\x65\143\x74\x5f\x69\164\x65\x6d\137\x73\164\141\x6e\x64\x61\x72\x64")->alias("\123\111\123")->join("\163\165\142\152\145\x63\164\137\x73\164\141\156\144\x61\x72\x64\x20\x53\x53", "\123\x49\x53\56\x73\x74\x61\156\x64\141\x72\x64\137\151\x64\75\x53\x53\56\151\144")->where(["\123\111\123\56\163\165\x62\152\x65\143\x74\137\151\144" => $subjectId, "\x53\x49\x53\x2e\x69\164\x65\x6d\x5f\x69\144" => $item["\151\144"]])->column("\x53\x53\x2e\154\x61\x74\x69\x74\165\x64\145"); goto uWeq9; ysli5: if (!$item["\x69\164\145\155\137\x32"]) { goto MPfMe; } goto lVOJg; y9SeJ: sUA4E: goto aSO0T; Qgn0B: if (!($optionIndex <= 12)) { goto sUA4E; } goto uOx2E; jWzZm: $natureField = "\x6e\x61\x74\x75\x72\145\x5f" . $optionIndex; goto OFWSY; Fz5N4: $optionIndex = 1; goto B0Yzc; udiaP: hPAPC: goto SG0cg; szEFu: $option = ["\x69\x64" => $item["\x69\144"] . "\x5f" . $optionIndex, "\x69\164\145\155\x5f\157\x70\164\x69\157\156" => strip_tags($item[$optionField]), "\167\x65\151\x67\150\164" => round($item[$weightField] / 100, 2), "\x6e\x61\x74\x75\162\145" => $item[$natureField]]; goto w6C96; NGr92: $row = ["\x69\144" => $item["\151\144"], "\151\164\145\x6d\137\157\160\164\x69\157\156" => $index + 1 . "\56\x20" . strip_tags($item["\x69\x74\x65\x6d"]), "\x63\x68\151\154\144\162\145\x6e" => [], "\x74\171\x70\145" => $item["\x74\x79\160\145"], "\x73\157\x72\164" => $item["\163\x6f\x72\x74"], "\x74\141\147" => $item["\164\141\x67"]]; goto ysli5; uOx2E: $optionField = "\157\x70\x74\151\x6f\156\137" . $optionIndex; goto eTjbA; OFWSY: $imageField = "\x69\x6d\141\x67\x65\137" . $optionIndex; goto A5hRg; uWeq9: $row["\x73\x74\141\x6e\144\141\x72\144\x73"] = implode("\54\40", $latitudes); goto Fz5N4; mWXlk: kE1N0: goto szEFu; DnKkP: $row["\151\x74\145\155\x5f\157\160\x74\151\157\156"] .= strip_tags($item["\x69\164\x65\155\137\x32"]); goto MzihJ; aSO0T: $rows[] = $row; goto XcKEj; w6C96: if (!$item[$imageField]) { goto Mxn8o; } goto CmYx7; CmYx7: $option["\x69\155\141\147\145"] = "\74\151\155\147\x20\x63\154\x61\x73\163\x3d\x22\155\171\x2d\x31\42\40\163\x72\x63\x3d\x22" . generateThumbnailUrl($item[$imageField], 100, "\x2f\163\x74\141\x74\151\x63\57\151\155\147\x2f\144\x6f\x74\56\160\156\147") . "\42\40\163\x74\x79\154\x65\x3d\42\x6d\x61\x78\55\167\x69\x64\x74\x68\x3a\x31\60\x30\160\x78\73\42\x3e"; goto JcmLA; llSgv: $row["\x63\150\x69\x6c\144\162\x65\156"][] = $option; goto cAGin; eTjbA: $weightField = "\x77\x65\151\x67\x68\164\x5f" . $optionIndex; goto jWzZm; XcKEj: a4AZz: goto mQlrI; A5hRg: if (!(empty($item[$optionField]) && empty($item[$imageField]))) { goto kE1N0; } goto eVDqE; mQlrI: } goto vgNsU; vgNsU: hr7kv: goto ZfzVh; pf2SH: } public function getSubjectItem($subjectId, $itemId) { goto PhI5z; SWODA: $item["\x73\164\141\x6e\144\x61\x72\x64\163"] = $standardIds; goto ONV8n; PRgRS: $item["\x6e\141\164\x75\162\x65\x5f" . $index] = 0; goto S3lTb; b9iYR: if (empty(trim($item[$optionField])) && empty(trim($item[$imageField]))) { goto XToxj; } goto i20gw; NkihD: jsIzY: goto ZECNN; MXDbu: $imageField = "\151\x6d\141\147\x65\137" . $index; goto b9iYR; ZECNN: if (!($index <= 12)) { goto nCQAl; } goto LClq2; VupkA: return null; goto D2Mkv; D2Mkv: mL4ua: goto NVGWf; gksxs: XToxj: goto aceAk; TPKv7: $standardIds = Db::table("\163\165\142\x6a\145\143\164\137\151\x74\145\155\x5f\163\164\x61\x6e\144\x61\x72\144")->where(["\x73\x75\x62\x6a\145\x63\x74\137\x69\144" => $subjectId, "\151\x74\145\x6d\137\x69\144" => $itemId])->column("\163\x74\x61\156\144\141\x72\144\137\151\x64"); goto X2Af2; aceAk: $item["\167\x65\x69\147\x68\x74\137" . $index] = ''; goto PRgRS; YrF2W: nCQAl: goto TPKv7; S3lTb: EdWU_: goto MaJmd; m827e: $standardIds = []; goto GRkBv; uJmdl: if ($item) { goto mL4ua; } goto VupkA; nBPjX: goto jsIzY; goto YrF2W; MaJmd: $index++; goto nBPjX; kRIsE: goto EdWU_; goto gksxs; NVGWf: $index = 1; goto NkihD; i20gw: $item["\x77\145\151\147\150\164\x5f" . $index] = round($item["\x77\x65\151\x67\x68\x74\137" . $index] / 100, 2); goto kRIsE; X2Af2: if ($standardIds) { goto c_f6L; } goto m827e; GRkBv: c_f6L: goto SWODA; ONV8n: return $item; goto wd3Om; PhI5z: $item = Db::table("\163\165\x62\152\145\143\x74\137\x69\x74\145\155")->where(["\151\x64" => $itemId])->field(true)->find(); goto uJmdl; LClq2: $optionField = "\x6f\160\164\151\x6f\156\x5f" . $index; goto MXDbu; wd3Om: } public function saveSubjectItem($subjectId, $itemId, $formData, $formOptionData, $standardIds) { goto bfN2P; K8f34: $indexSanitized++; goto sbwi4; uf15X: $formOptionDataSanitized["\x6f\x70\x74\x69\x6f\x6e\137" . $indexSanitized] = $formOptionData[$optionField]; goto XTYuz; MoX71: $formOptionDataSanitized["\x6e\141\x74\x75\x72\145\x5f" . $index] = null; goto vxqPn; H2K7Z: ibotZ: goto VW5Rf; OYNHb: $formOptionDataSanitized["\x6f\160\164\151\x6f\x6e\x5f" . $index] = ''; goto X8eVx; Asu65: YPnO3: goto RPs8Y; gD0D0: $itemId = Db::table("\x73\165\x62\152\x65\x63\x74\137\151\x74\145\x6d")->insertGetId($formData); goto ewzLV; A1lJP: $natureField = "\156\141\x74\165\x72\x65\x5f" . $index; goto I3qXt; AGcJM: $standardIds = []; goto S2blp; MrMYe: $formOptionDataSanitized["\x6f\160\164\151\157\156\x5f" . $indexSanitized] = ''; goto jTFtI; UOA2z: $standardIdsDb = Db::table("\163\x75\142\x6a\145\x63\164\x5f\151\x74\x65\x6d\137\x73\164\x61\156\x64\x61\162\x64")->where(["\163\165\x62\152\145\143\164\137\151\144" => $subjectId, "\x69\164\145\155\x5f\151\144" => $itemId])->column("\163\164\141\x6e\144\141\x72\144\x5f\x69\144"); goto cdjhL; eWYq5: kjELZ: goto AGcJM; t_rRS: W_kb8: goto EyERC; DDFs7: Db::table("\163\x75\142\152\145\143\164")->where(["\x69\x64" => $subjectId])->setInc("\x69\164\x65\155\137\166\145\162\x73\x69\x6f\x6e"); goto mmah_; cdjhL: $standardsAdd = array_diff($standardIds, $standardIdsDb); goto cGauP; CFo02: $subject = Db::table("\x73\165\142\x6a\145\x63\164")->where(["\151\144" => $subjectId])->field("\156\x61\x6d\145")->find(); goto YIFRS; S2blp: $index = 1; goto YFWZo; h80Ny: PV523: goto Id5sp; I3qXt: if (!(isset($formOptionData[$optionField]) && trim($formOptionData[$optionField]) || isset($formOptionData[$imageField]) && trim($formOptionData[$imageField]))) { goto DTt1P; } goto uf15X; FIvpY: $index++; goto fzwTK; kQ3M6: if (!($indexSanitized <= 12)) { goto YKM6a; } goto MrMYe; I8Ykt: $imageField = "\x69\x6d\x61\147\x65\x5f" . $index; goto KuWqJ; Szfrf: $formData["\163\x75\x62\152\x65\143\x74\x5f\151\x64"] = $subjectId; goto gD0D0; Bb_ah: $formOptionDataSanitized["\x77\145\151\x67\x68\x74\x5f" . $index] = null; goto MoX71; bfN2P: $formOptionDataSanitized = []; goto B7IZX; HHZ4Z: goto y1KRl; goto YWGQc; vxqPn: $index++; goto HHZ4Z; VLWTm: lZxQU: goto Szfrf; fzwTK: goto W_kb8; goto Asu65; Id5sp: if (empty($itemId)) { goto lZxQU; } goto tx8GQ; vukRu: $index = 1; goto a8YMq; dHptc: wexception("\346\227\240\346\xb3\x95\346\x89\xbe\xe5\x88\260\345\xaf\xb9\345\xba\x94\347\x9a\204\xe9\x87\217\350\241\xa8"); goto h80Ny; YWGQc: GPC9B: goto rfIgv; eBJ38: jKU49: goto UOA2z; ZsPJY: $standardsDel = array_diff($standardIdsDb, $standardIds); goto s3qIC; ewzLV: Db::table("\163\165\142\x6a\x65\143\164\137\x69\x74\x65\x6d")->where(["\x69\144" => $itemId])->update($formOptionDataSanitized); goto DDFs7; sbwi4: DTt1P: goto FIvpY; feV0c: $formOptionDataSanitized["\x6e\x61\x74\165\x72\145\137" . $indexSanitized] = $formOptionData[$natureField]; goto K8f34; VW5Rf: goto jKU49; goto VLWTm; f1Ghc: o6NbH: goto hGuwg; YFWZo: y1KRl: goto RF5A8; yfgin: if (!empty($subjectItem)) { goto o6NbH; } goto UXsjJ; KuWqJ: $weightField = "\167\145\x69\x67\x68\164\137" . $index; goto A1lJP; lXKec: Db::table("\163\x75\x62\152\145\x63\164")->where(["\x69\x64" => $subjectId])->setInc("\x69\x74\x65\x6d\137\x76\145\162\163\x69\157\x6e"); goto eF4yy; YIFRS: if (!empty($subject)) { goto PV523; } goto dHptc; IojOt: goto PGQS3; goto D7sPS; rfIgv: sryau: goto CFo02; a8YMq: $indexSanitized = 1; goto t_rRS; WRMzQ: if (!$updatedCount) { goto ibotZ; } goto lXKec; zkuiP: bZuJ2: goto ZsPJY; Qv6jP: $formOptionDataSanitized["\x77\145\x69\147\150\164\x5f" . $indexSanitized] = empty($formOptionData[$weightField]) ? 0 : $formOptionData[$weightField] * 100; goto feV0c; VG6xe: $formOptionDataSanitized["\x77\145\x69\147\150\164\137" . $indexSanitized] = null; goto OXSLl; XTYuz: $formOptionDataSanitized["\x69\155\x61\x67\145\137" . $indexSanitized] = $formOptionData[$imageField]; goto Qv6jP; HwGs3: $optionField = "\x6f\160\x74\x69\x6f\156\x5f" . $index; goto I8Ykt; jTFtI: $formOptionDataSanitized["\x69\155\141\147\145\x5f" . $indexSanitized] = ''; goto VG6xe; s3qIC: foreach ($standardsDel as $standardId) { Db::table("\163\x75\x62\x6a\145\143\164\x5f\x69\164\x65\155\137\x73\164\141\156\x64\141\162\x64")->where(["\163\165\x62\x6a\x65\x63\164\137\151\144" => $subjectId, "\151\164\x65\x6d\137\x69\144" => $itemId, "\163\x74\141\x6e\x64\x61\162\x64\137\x69\144" => $standardId])->delete(); ev0l2: } goto fw0xv; eF4yy: OperationLogs::I()->subjectLog("\344\xbf\256\346\224\271\351\207\217\350\xa1\xa8\xe9\241\xb9\347\x9b\xae\x20\55\40{$subject["\156\141\155\145"]}", $subjectItem["\x69\164\145\155"], OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto H2K7Z; RF5A8: if (!($index <= 12)) { goto GPC9B; } goto OYNHb; tx8GQ: $subjectItem = Db::table("\163\x75\x62\x6a\x65\x63\164\x5f\151\164\145\x6d")->where(["\151\x64" => $itemId])->find(); goto yfgin; D7sPS: YKM6a: goto baoNP; wgs82: $this->updateSubjectStandardMinMax($subjectId); goto Hh1Fo; hGuwg: $updatedCount = Db::table("\163\x75\142\152\145\x63\164\x5f\x69\164\145\x6d")->where(["\x69\144" => $itemId])->update(array_merge($formData, $formOptionDataSanitized)); goto WRMzQ; RPs8Y: PGQS3: goto kQ3M6; B7IZX: if ($formData["\x74\x79\160\x65"] == Defs::QUESTION_TEXT) { goto kjELZ; } goto vukRu; cGauP: foreach ($standardsAdd as $standardId) { Db::table("\x73\x75\x62\x6a\x65\x63\164\x5f\x69\164\x65\155\137\163\164\x61\156\144\x61\x72\144")->insert(["\x73\165\142\152\145\143\x74\137\x69\x64" => $subjectId, "\x69\x74\x65\155\x5f\x69\x64" => $itemId, "\163\164\x61\156\x64\141\162\x64\x5f\x69\x64" => $standardId]); sFbek: } goto zkuiP; OXSLl: $formOptionDataSanitized["\156\141\x74\x75\162\145\x5f" . $indexSanitized] = null; goto uQI1M; X8eVx: $formOptionDataSanitized["\x69\x6d\x61\x67\x65\137" . $index] = ''; goto Bb_ah; baoNP: goto sryau; goto eWYq5; uQI1M: $indexSanitized++; goto IojOt; mmah_: OperationLogs::I()->subjectLog("\xe5\xa2\236\xe5\212\xa0\xe9\207\217\350\xa1\250\351\241\xb9\347\233\256\40\x2d\x20{$subject["\x6e\x61\x6d\x65"]}", $formData["\151\x74\145\155"], OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto eBJ38; fw0xv: btPrZ: goto wgs82; UXsjJ: wexception("\xe6\x97\xa0\xe6\263\x95\346\x89\xbe\xe5\210\xb0\345\xaf\xb9\xe5\xba\x94\xe7\x9a\204\351\x87\x8f\xe8\241\250\351\241\xb9\347\233\xae"); goto f1Ghc; EyERC: if (!($index <= 12)) { goto YPnO3; } goto HwGs3; Hh1Fo: } public function removeSubjectItem($subjectId, $itemId) { goto ZbJsj; aGIsC: wexception("\346\x97\240\346\263\x95\xe6\x89\276\xe5\x88\xb0\xe5\xaf\xb9\345\272\x94\347\232\204\351\207\x8f\350\xa1\xa8"); goto jd14g; J8Xpa: Db::table("\163\165\142\x6a\x65\143\x74\x5f\151\164\x65\x6d\x5f\x73\x74\141\156\144\x61\x72\144")->where(["\x69\x74\x65\x6d\137\x69\x64" => $itemId])->delete(); goto Jb2MW; pBz6c: wexception("\346\x97\240\xe6\263\x95\346\x89\276\345\x88\xb0\345\xaf\271\345\xba\x94\xe7\232\x84\351\x87\217\xe8\241\xa8\351\xa1\xb9\xe7\x9b\xae"); goto GQRl6; akCjJ: $subjectItem = Db::table("\x73\165\142\x6a\x65\143\x74\x5f\151\164\x65\x6d")->where(["\151\144" => $itemId])->field(true)->find(); goto vYcqq; Q6HOq: Db::table("\163\165\142\x6a\145\143\164\137\x69\x74\145\x6d")->where(["\151\x64" => $itemId])->delete(); goto J8Xpa; LYrNe: OperationLogs::I()->subjectLog("\345\x88\240\xe9\231\244\xe9\x87\x8f\xe8\241\xa8\351\241\xb9\347\x9b\256\40\55\40{$subject["\x6e\x61\x6d\x65"]}", $subjectItem["\x69\x74\145\155"], OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto GJ8e1; E8DVT: $this->updateSubjectStandardMinMax($subjectId); goto LYrNe; GQRl6: jEfGC: goto Q6HOq; jd14g: birkY: goto akCjJ; ZbJsj: $subject = Db::table("\163\165\x62\x6a\x65\143\x74")->where(["\151\x64" => $subjectId])->field("\x6e\141\155\x65")->find(); goto ZXAHJ; vYcqq: if (!empty($subjectItem)) { goto jEfGC; } goto pBz6c; Jb2MW: Db::table("\163\x75\x62\152\145\x63\164")->where(["\151\x64" => $subjectId])->setInc("\151\164\145\x6d\x5f\x76\145\x72\x73\151\157\156"); goto E8DVT; ZXAHJ: if (!empty($subject)) { goto birkY; } goto aGIsC; GJ8e1: } public function addTagItem($subjectId, $tag) { goto HCE0U; HCE0U: if (isset(Defs::SUBJECT_ITEM_TAG_DEFS[$tag])) { goto ZRwDR; } goto xybSS; TmRZ5: tiPqI: goto RfFVQ; ipoJK: ekg1X: goto jko7U; yqKSV: $formData = ["\x73\165\x62\152\x65\143\164\137\x69\x64" => $subjectId, "\151\164\145\x6d" => "\346\202\xa8\347\232\x84\345\xb9\xb4\351\xbe\x84\x3f", "\164\x79\x70\x65" => Defs::QUESTION_TEXT, "\x73\x6f\x72\x74" => 0, "\164\141\147" => Defs::SUBJECT_ITEM_TAG_AGE]; goto qlskb; wKrNP: OperationLogs::I()->subjectLog("\345\xa2\236\345\x8a\240\351\x87\217\xe8\241\250\351\241\271\347\x9b\256\40\55\40{$subject["\156\x61\155\x65"]}", $formData["\x69\164\x65\x6d"], OperationLogs::OPT_UPDATE_TYPE, $subjectId); goto FuR18; EYjN7: if (!empty($subject)) { goto ekg1X; } goto YtHGa; LhVsc: Db::table("\x73\165\x62\x6a\145\143\164")->where(["\151\x64" => $subjectId])->setInc("\x69\x74\x65\x6d\x5f\166\x65\162\163\x69\x6f\x6e"); goto V8JwH; xybSS: wexception("\164\141\x67\xe5\x8f\x82\xe6\225\xb0\351\235\x9e\xe6\263\225"); goto BRrr1; YtHGa: wexception("\346\227\240\346\263\x95\346\211\xbe\xe5\210\xb0\345\xaf\271\xe5\xba\224\347\232\x84\351\x87\x8f\xe8\241\250"); goto ipoJK; V8JwH: $this->updateSubjectStandardMinMax($subjectId); goto wKrNP; RfFVQ: $formData = ["\x73\x75\x62\152\x65\143\x74\137\151\144" => $subjectId, "\x69\164\145\x6d" => "\346\202\250\xe7\x9a\x84\xe6\x80\xa7\xe5\210\253\77", "\164\171\x70\145" => Defs::QUESTION_RADIO, "\x6f\160\164\151\x6f\x6e\137\61" => "\347\224\xb7", "\157\x70\x74\x69\157\x6e\137\x32" => "\xe5\xa5\263", "\x77\x65\x69\147\x68\164\137\x31" => 0, "\x77\145\151\x67\150\x74\x5f\62" => 0, "\151\x6d\141\147\x65\x5f\61" => "\x2f\x73\164\141\x74\151\143\57\x69\x6d\x67\x2f\x6d\141\x6e\56\160\156\x67", "\x69\x6d\141\147\145\x5f\x32" => "\x2f\x73\164\x61\164\x69\x63\x2f\x69\155\147\x2f\x77\157\155\141\156\x2e\x70\156\x67", "\x6e\141\164\x75\x72\145\x5f\x31" => 0, "\156\x61\164\x75\162\145\x5f\x32" => 0, "\x73\157\x72\164" => 0, "\164\141\x67" => Defs::SUBJECT_ITEM_TAG_SEX]; goto LPe2a; qlskb: tFU6T: goto G87qC; jko7U: if ($tag == Defs::SUBJECT_ITEM_TAG_SEX) { goto tiPqI; } goto bz319; bz319: if (!($tag == Defs::SUBJECT_ITEM_TAG_AGE)) { goto tFU6T; } goto yqKSV; Y0MJU: $subject = Db::table("\163\x75\142\152\145\143\x74")->where(["\151\144" => $subjectId])->field("\156\141\x6d\145")->find(); goto EYjN7; baZoz: $itemId = Db::table("\163\x75\x62\152\145\143\x74\x5f\151\164\x65\x6d")->insertGetId($formData); goto LhVsc; G87qC: goto bCU8N; goto TmRZ5; LPe2a: bCU8N: goto baZoz; BRrr1: ZRwDR: goto Y0MJU; FuR18: } protected function convertOriginalToStandard($statistic_weight_min, $statistic_weight_max, $standard_weight_min, $standard_weight_max, &$weight) { goto FXJ1J; lIlef: if (!($weightStandard > $standard_weight_max)) { goto GFQHV; } goto Korop; WMKgL: jesGF: goto HwxCJ; C6atU: $weight = $weightStandard; goto Q_u5G; kk_rd: GFQHV: goto C6atU; Korop: $weightStandard = $standard_weight_max; goto kk_rd; oP9tB: $weightStandard = round(($weight - $statistic_weight_min) * $scale + $standard_weight_min, 2); goto lIlef; HwxCJ: return false; goto Elund; FXJ1J: if (!($standard_weight_min !== null && $standard_weight_max !== null && $statistic_weight_max && $standard_weight_max && $statistic_weight_max > $statistic_weight_min && $standard_weight_max > $standard_weight_min)) { goto jesGF; } goto AEkK2; Q_u5G: return true; goto WMKgL; AEkK2: $scale = ($standard_weight_max - $standard_weight_min) / ($statistic_weight_max - $statistic_weight_min); goto oP9tB; Elund: } public function generateTestResult($subjectId, $itemOptions) { goto eJ0l6; kQmu3: return call_user_func([$reporter, $subject["\162\x65\x70\157\x72\164\137\x67\x65\x6e\x65\x72\141\x74\x6f\x72"]], $subjectId, $itemOptions); goto kAzhn; xouhk: $file = ROOT_PATH . "\x72\x65\160\x6f\162\x74" . DS . "\x61\x6c\x67\157" . DS . basename($class) . "\x2e\160\x68\x70"; goto Eeq7O; k96Im: $rows = []; goto piXql; tG33h: $file = ROOT_PATH . "\x72\x65\x70\157\162\164" . DS . "\141\x6c\147\x6f" . DS . "\101\151\x2e\x70\x68\160"; goto YU1v6; swSoy: x3Myr: goto ZZtWo; ZZtWo: $standards = []; goto NsAFJ; Lt_AL: try { $this->downloadReportAlgo(); } catch (WException $e) { logEvent("\344\270\213\350\xbd\xbd\347\224\x9f\xe6\x88\x90\xe6\x8a\245\xe5\x91\x8a\347\x9a\204\347\256\227\xe6\xb3\225\xe6\x96\x87\344\273\266\345\xa4\261\xe8\xb4\xa5\54\40\x65\170\143\145\160\164\x69\x6f\156\72\40" . $e->getMessage(), EventLogsService::eSeverityError); return []; } goto NGJnz; LEaRn: W63FP: goto H2XO3; vXWXV: goto JDZT3; goto Ps3YH; eJ0l6: if (!empty($itemOptions)) { goto nSYt2; } goto ml_1g; XKWIe: try { $this->downloadReportAlgo(); } catch (WException $e) { logEvent("\344\270\213\xe8\xbd\275\347\x94\x9f\346\210\220\346\x8a\245\345\x91\x8a\xe7\232\204\347\256\x97\346\xb3\x95\xe6\226\207\344\273\266\345\244\xb1\xe8\xb4\245\x2c\x20\145\x78\143\145\x70\x74\x69\x6f\x6e\72\x20" . $e->getMessage(), EventLogsService::eSeverityError); return []; } goto gtav2; H2XO3: $subjectItems = Db::table("\163\165\142\x6a\x65\x63\164\137\151\x74\145\155")->where("\163\x75\142\x6a\x65\x63\x74\137\x69\144", $subjectId)->order("\163\157\162\x74\x20\x61\163\143")->column("\151\x64\x2c\40\15\12\40\x20\40\x20\x20\40\x20\x20\x20\40\40\40\x20\40\40\40\164\x79\160\145\x2c\15\12\40\x20\40\40\40\x20\x20\40\x20\40\40\x20\40\40\40\x20\x77\145\151\147\150\x74\x5f\61\54\15\12\40\x20\40\40\40\40\x20\40\40\40\40\40\x20\x20\40\x20\167\145\x69\147\150\164\x5f\62\54\15\12\40\40\40\x20\40\40\x20\40\x20\40\x20\40\x20\40\x20\x20\167\145\151\147\x68\x74\137\x33\54\xd\12\x20\40\40\40\x20\x20\40\40\40\40\x20\40\x20\x20\x20\40\167\145\x69\x67\x68\164\x5f\64\54\xd\12\40\x20\x20\40\40\x20\x20\40\40\x20\40\x20\x20\40\x20\40\x77\145\151\147\x68\x74\137\x35\x2c\xd\12\40\40\x20\40\x20\x20\40\x20\40\40\40\40\40\40\40\40\167\145\151\x67\x68\164\137\x36\x2c\15\12\40\40\x20\40\40\x20\x20\40\40\x20\x20\40\x20\x20\x20\x20\167\x65\151\147\150\164\137\67\x2c\15\xa\40\x20\x20\x20\40\x20\x20\x20\x20\40\40\40\x20\x20\40\40\167\x65\151\x67\x68\164\137\70\x2c\15\12\x20\40\x20\x20\x20\x20\x20\40\x20\x20\x20\x20\x20\x20\40\x20\x77\x65\x69\147\150\164\137\x39\x2c\xd\12\40\x20\40\40\x20\x20\x20\x20\x20\40\40\40\40\40\40\40\x77\145\151\x67\150\164\x5f\61\60\54\15\xa\40\40\x20\40\40\x20\x20\40\40\x20\x20\x20\x20\x20\40\40\x77\x65\x69\x67\150\x74\x5f\x31\x31\x2c\15\12\x20\x20\x20\x20\40\40\40\40\40\40\x20\40\x20\x20\40\40\167\145\x69\x67\150\164\x5f\61\62\54\15\12\x20\40\40\x20\x20\40\x20\x20\x20\x20\40\x20\x20\x20\x20\x20\156\x61\164\x75\162\x65\137\x31\54\xd\12\40\x20\40\x20\40\40\x20\40\40\x20\x20\x20\x20\x20\40\x20\156\141\x74\x75\x72\145\x5f\62\54\xd\xa\40\x20\40\x20\x20\x20\x20\x20\40\x20\40\x20\40\40\40\40\156\x61\164\165\162\x65\x5f\x33\54\15\12\x20\x20\x20\40\x20\x20\40\x20\40\40\x20\x20\40\40\40\x20\x6e\141\x74\x75\x72\145\137\x34\x2c\xd\xa\40\x20\x20\40\40\40\x20\x20\x20\x20\40\40\40\x20\40\40\x6e\141\x74\165\x72\x65\x5f\x35\54\xd\xa\40\x20\40\40\x20\40\40\x20\x20\40\x20\40\x20\x20\x20\40\x6e\x61\164\165\162\145\137\66\x2c\xd\12\40\x20\x20\x20\40\40\40\40\40\40\x20\40\x20\x20\x20\40\156\x61\164\x75\x72\145\137\x37\x2c\xd\xa\40\x20\x20\40\40\x20\x20\x20\40\x20\40\40\x20\x20\40\40\156\x61\x74\165\162\145\137\70\54\xd\xa\40\40\x20\x20\x20\40\40\40\40\40\40\40\40\40\40\x20\156\141\x74\165\162\x65\x5f\x39\54\15\12\40\40\x20\x20\x20\x20\x20\40\40\x20\x20\x20\x20\40\x20\40\x6e\141\x74\x75\x72\145\137\x31\x30\54\xd\xa\x20\x20\x20\40\x20\40\x20\x20\40\40\x20\x20\x20\x20\40\x20\x6e\141\164\165\x72\145\x5f\x31\61\x2c\xd\12\x20\x20\x20\40\x20\x20\40\40\x20\x20\x20\40\40\x20\40\x20\156\141\164\165\x72\145\x5f\x31\62\x2c\15\12\x20\x20\x20\x20\x20\40\40\40\x20\40\40\40\40\40\x20\x20\x74\x61\147"); goto Eu6Wb; XSs9s: bJrkC: goto z_NC7; bLCWT: $reporter = new AiAlgo(); goto kQmu3; z_NC7: if (!$subject["\x72\x65\160\157\x72\x74\x5f\147\145\156\x65\162\x61\164\x6f\162"]) { goto W63FP; } goto FMGBX; YU1v6: if (file_exists($file)) { goto WfCGi; } goto alRju; Eu6Wb: if (!empty($subjectItems)) { goto x3Myr; } goto eDTIS; eDTIS: return []; goto swSoy; ApiRy: nSYt2: goto THuX4; Ps3YH: pTBR2: goto tG33h; gtav2: YS6aD: goto Um7Ir; MjKKg: logEvent("\xe6\227\xa0\xe6\263\225\346\211\xbe\xe5\x88\xb0\347\224\x9f\xe6\x88\x90\xe6\x8a\xa5\xe5\x91\x8a\xe7\232\x84\347\xae\227\xe6\xb3\x95\346\226\207\344\273\266\x2c\40{$file}", EventLogsService::eSeverityError); goto XKWIe; bLWvz: list($class, $method) = explode("\x3a", $subject["\162\x65\x70\x6f\162\x74\x5f\147\x65\156\x65\x72\141\x74\157\162"]); goto xouhk; NsAFJ: $standards = Db::table("\x73\x75\x62\152\145\143\x74\x5f\163\x74\141\156\144\141\x72\144")->where("\x73\165\x62\152\x65\x63\x74\137\151\x64", $subjectId)->field("\x69\x64\40\x61\163\40\x73\164\x61\156\144\x61\162\144\137\151\144\x2c\40\154\x61\164\151\x74\x75\144\145\x2c\40\xd\xa\40\40\x20\40\x20\40\x20\40\40\x20\x20\x20\x20\x20\40\x20\163\164\141\164\x69\x73\164\x69\143\137\x77\145\151\147\150\164\x5f\155\151\156\54\x20\163\x74\141\164\x69\x73\164\x69\x63\x5f\x77\145\x69\147\x68\164\x5f\x6d\141\x78\54\x20\x73\164\x61\156\x64\x61\x72\x64\137\167\145\151\147\150\x74\137\x6d\151\x6e\x2c\x20\x73\x74\141\x6e\144\141\x72\x64\137\x77\145\x69\x67\x68\x74\x5f\155\141\x78")->order("\x73\157\x72\x74\40\141\x73\143\54\x20\151\144\x20\x61\x73\x63")->select(); goto gNICQ; ml_1g: return []; goto ApiRy; THuX4: $subject = Db::table("\x73\x75\x62\x6a\145\143\164")->where("\151\x64", $subjectId)->field("\x73\x6e\x2c\40\163\x74\141\x74\151\163\164\x69\143\x5f\x77\145\x69\147\x68\x74\137\x6d\x69\156\x2c\40\x73\164\141\x74\x69\x73\x74\x69\143\137\x77\145\x69\x67\150\x74\x5f\155\x61\170\54\40\163\164\x61\x6e\x64\141\162\x64\x5f\167\x65\151\x67\150\164\x5f\x6d\x69\x6e\54\40\163\164\141\x6e\144\141\x72\x64\x5f\167\145\x69\x67\x68\x74\x5f\155\141\x78\54\162\145\x70\157\162\x74\x5f\x67\145\x6e\145\162\141\x74\157\x72")->find(); goto JVYve; eHqGU: qoQHE: goto hKrvS; NGJnz: WfCGi: goto bLCWT; FMGBX: if (strpos($subject["\x72\x65\160\x6f\x72\164\x5f\147\x65\x6e\x65\x72\x61\164\157\162"], "\72") === false) { goto pTBR2; } goto bLWvz; Gszz_: return []; goto XSs9s; gNICQ: array_unshift($standards, ["\x73\164\x61\x6e\144\x61\162\144\137\x69\x64" => 0, "\x6c\x61\164\x69\x74\x75\x64\x65" => Defs::SUBJECT_WHOLE_STANDARD, "\163\x74\x61\164\x69\x73\164\151\143\x5f\x77\x65\x69\x67\x68\x74\x5f\155\x69\x6e" => $subject["\163\164\141\164\151\x73\x74\x69\143\137\167\x65\151\147\x68\164\137\x6d\151\x6e"], "\x73\164\x61\164\151\163\x74\x69\143\137\167\x65\x69\147\150\164\x5f\155\141\170" => $subject["\x73\x74\x61\x74\x69\x73\x74\x69\x63\x5f\x77\x65\x69\147\150\164\137\x6d\141\x78"], "\x73\x74\141\x6e\x64\141\162\x64\x5f\167\145\x69\x67\150\164\137\x6d\x69\x6e" => $subject["\x73\x74\141\156\x64\x61\162\x64\137\167\145\151\147\x68\x74\137\x6d\x69\156"], "\x73\164\141\156\144\141\x72\x64\137\x77\145\151\x67\x68\x74\x5f\155\141\x78" => $subject["\x73\164\x61\156\144\x61\x72\144\x5f\x77\145\151\x67\x68\164\137\155\141\170"]]); goto k96Im; hKrvS: return $rows; goto Rkqlo; Eeq7O: if (file_exists($file)) { goto YS6aD; } goto MjKKg; Um7Ir: return call_user_func([new $class(), $method], $subjectId, $itemOptions); goto vXWXV; JVYve: if (!empty($subject)) { goto bJrkC; } goto Gszz_; piXql: foreach ($standards as $standard) { goto I7WsU; H5zoI: $subjectItemIds = Db::table("\x73\165\x62\x6a\x65\x63\164\x5f\x69\x74\145\155\137\x73\164\141\x6e\x64\x61\x72\144")->where(["\163\165\142\152\145\143\164\137\151\144" => $subjectId, "\163\x74\x61\156\144\x61\x72\144\x5f\151\x64" => $standardId])->column("\x69\164\145\155\x5f\151\144"); goto wyVgG; WxWTy: foreach ($latitudes as $latitude) { goto tOLM9; HJ4qg: $expression = str_replace("\x24\173\101\x57\175", "\44\x61\166\x65\162\x61\147\145\x57\x65\151\147\150\x74", $expression); goto UAqcP; lUOoz: goto SODdT; goto JoUhx; zl8Rw: $i = 0; goto JRTU7; n1jdW: $matched = true; goto SCxHr; dzGHg: yIMIk: goto SG7qM; PlRko: $matchedDescs[] = $latitude["\163\164\x61\x6e\144\x5f\x64\x65\163\143"]; goto nz11h; zdBbf: if (!($i <= 6)) { goto CYC_K; } goto MtVOE; J9J1S: $warningLevel = $latitude["\167\141\162\156\151\156\x67\137\x6c\x65\166\145\x6c"]; goto dzGHg; MtVOE: $expression = str_replace("\x24\173\127\104" . $i . "\175", "\x24\x77\x65\x69\147\x68\x74\104\151\x73\x74\162\151\142\x75\164\151\157\156\x5b\x73\164\x72\166\x61\x6c\50" . $i . "\x29\135", $expression); goto iNizO; Gscaj: goto D1aa3; goto ajaFP; tOLM9: $weightType = $latitude["\167\x65\151\x67\x68\x74\x5f\164\171\x70\x65"]; goto jMop2; UUwvk: if ($weightType == Defs::LATITUDE_MEASURE_WEIGHT_STANDARD) { goto KSV03; } goto aWwEq; Yexhz: H8kyS: goto n1jdW; oST4B: $expression = str_replace("\44\173\101\127\x7d", "\44\141\166\145\x72\x61\x67\145\127\x65\x69\147\150\164\x53\x74\x61\156\144\141\162\144", $expression); goto ysCYv; OIjxk: D1aa3: goto UCTse; nzmv1: $expression = str_replace("\x24\x7b\x54\x57\x7d", "\44\164\x6f\x74\x61\154\x57\145\151\147\150\x74\x53\164\x61\156\x64\x61\162\144", $expression); goto oST4B; nz11h: if (!($latitude["\167\x61\x72\x6e\151\156\x67\x5f\154\x65\166\x65\154"] > $warningLevel)) { goto yIMIk; } goto J9J1S; SCxHr: I7mDv: goto VZQH8; j_f6m: Log::notice("\x65\170\x70\x72\145\163\163\x69\x6f\x6e\x3a\40{$expressionOriginal}\40\55\x3e\x20{$expression}"); goto ZpYoJ; SG7qM: if (!trim($latitude["\x72\145\x6d\x61\162\153"])) { goto H8kyS; } goto Qs7Tq; jMop2: if (!($weightType == Defs::LATITUDE_MEASURE_WEIGHT_STANDARD && $totalWeightStandard === null)) { goto Tkk37; } goto lUOoz; Qs7Tq: $matchedRemarks[] = $latitude["\x72\145\x6d\x61\x72\x6b"]; goto Yexhz; EfWwf: $expression = str_replace("\44\173\124\127\175", "\44\164\x6f\x74\x61\154\x57\145\151\147\150\x74", $expression); goto HJ4qg; mEu6P: CYC_K: goto DTrT2; LtPbr: $expressionOriginal = $latitude["\145\x78\160\x72\x65\x73\163\151\157\156"]; goto GvWvY; dNEEb: $matchedExpressions[] = $expressionOriginal; goto PlRko; ol3Kf: $expression = str_replace("\44\173\x4e\111\103\175", "\44\x6e\145\x67\141\x74\x69\166\145\111\x74\145\x6d\103\x6f\165\156\164", $expression); goto Knt90; RvG4V: XxYwi: goto EfWwf; XNuyK: if ($weightType == Defs::LATITUDE_MEASURE_WEIGHT_ORIGINAL) { goto XxYwi; } goto UUwvk; JRTU7: GSohZ: goto zdBbf; UliVt: $expression = str_replace("\44\x7b\x50\x49\103\175", "\44\160\157\163\151\164\x69\x76\x65\111\x74\145\x6d\103\x6f\165\156\x74", $expression); goto ol3Kf; Wy0Gn: if (!$result) { goto I7mDv; } goto dNEEb; UCTse: goto xwVse; goto RvG4V; Knt90: $expression = "\x72\x65\164\x75\x72\156\x20" . $expression . "\73"; goto j_f6m; JoUhx: Tkk37: goto LtPbr; ZpYoJ: try { $result = eval($expression); } catch (\ParseError $e) { $result = false; } goto Wy0Gn; UAqcP: $expression = str_replace("\44\x7b\x50\x41\127\175", "\44\160\x6f\163\x69\x74\x69\x76\145\x41\166\145\x72\x61\x67\x65\127\x65\151\x67\150\164", $expression); goto zl8Rw; DTrT2: xwVse: goto UliVt; GvWvY: $expression = preg_replace("\x2f\x5c\163\53\57", '', $expressionOriginal); goto XNuyK; iNizO: $i++; goto dS34V; aWwEq: goto SODdT; goto Gscaj; dS34V: goto GSohZ; goto mEu6P; ajaFP: KSV03: goto nzmv1; VZQH8: SODdT: goto fL7js; ysCYv: $expression = str_replace("\44\x7b\x50\x41\x57\175", "\x24\x70\x6f\163\x69\164\151\166\145\101\x76\145\162\141\147\145\x57\145\151\147\150\164\x53\164\141\x6e\144\x61\x72\144", $expression); goto OIjxk; fL7js: } goto gQiLM; TIZIN: EXc3W: goto YpJqF; YGgy4: $subjectItemIds = []; goto xVtrr; Afmq0: $tempWeight = $totalPositiveWeight; goto mUJ4s; vbMSR: $weightDistribution = []; goto P1bct; df0FP: $negativeItemCount = 0; goto MZsPD; cMARI: $totalWeightMin = 0; goto E_B57; XmGoB: $totalWeightStandard = $tempWeight; goto yGQh1; xVtrr: NkO2M: goto K73mZ; v4h3R: $matchedDescs = []; goto Ggmeo; AWczk: $positiveItemCount = 0; goto df0FP; mCk9Z: goto c0Fun; goto dAmfz; X6q8k: $matched = false; goto YReGk; Zs115: tHAoO: goto wSyl1; AYu88: $matchedExpressions = []; goto v4h3R; FJHjT: $averageWeightMinStandard = null; goto AWczk; LvTCE: TWf6P: goto AYu88; ZOaj2: $positiveAverageWeight = round($totalPositiveWeight / $positiveItemCount, 2); goto Afmq0; iTAo5: NEolW: goto LvTCE; wyVgG: if ($subjectItemIds) { goto NkO2M; } goto YGgy4; aEF9J: if (!($itemCount == 0)) { goto i_PEs; } goto YxAhq; K73mZ: goto TkQn6; goto zSoMz; E_B57: $averageWeight = 0; goto gwvhw; REy7r: $positiveAverageWeightStandard = 0; goto rv3hD; bLmi0: $totalWeight = 0; goto kucJO; o26TW: $averageWeightMin = round($totalWeightMin / $itemCount, 2); goto GNcen; sVA7G: Ah7eT: goto kNv3j; sFezY: goto qjLrQ; goto YsKn1; mUJ4s: $convertedResult = $this->convertOriginalToStandard($standard["\x73\164\x61\x74\151\163\x74\151\143\x5f\167\x65\x69\x67\150\x74\137\155\x69\156"], $standard["\x73\164\x61\x74\x69\163\x74\151\143\x5f\167\145\x69\147\150\x74\x5f\155\141\x78"], $standard["\163\164\x61\156\144\141\162\144\x5f\x77\145\151\147\150\164\x5f\155\x69\x6e"], $standard["\163\x74\x61\x6e\144\x61\x72\x64\137\x77\145\151\x67\150\x74\137\155\x61\x78"], $tempWeight); goto XJ50A; kECSd: $averageWeightMaxStandard = null; goto FJHjT; VGTu9: goto kItTF; goto p7DIN; w9VE3: foreach ($itemOptions as $itemId => $itemOption) { goto MdVX4; Eudz6: goto yJaZ4; goto doixB; CLyE2: $weightField = "\x77\145\x69\147\x68\x74\x5f" . $optionIndex; goto g4FeY; PAhel: $negativeItemCount += $subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_NEGATIVE ? 1 : 0; goto EbJcD; g4FeY: if (!isset($subjectItems[$itemId][$weightField])) { goto eZLYc; } goto Vacpj; EjjGQ: goto VVx_n; goto PdNLt; ZcKY3: hE__U: goto DESFs; azilK: fTfF2: goto lTKAg; kNBro: TI00W: goto d3M_t; zduVk: $weightDistribution[strval($itemWeight)]++; goto FcIry; i25KG: $totalWeight += $itemWeight; goto ggzZb; K0JP3: $itemCount++; goto kNBro; MdVX4: $itemType = $itemOption["\x74\x79\160\145"]; goto i7W2m; Hiww8: goto TI00W; goto xM8t1; lTKAg: if (in_array($itemId, $subjectItemIds)) { goto hE__U; } goto ZshHZ; Z2JqJ: if (!($subjectItems[$itemId]["\164\141\147"] != "\x6e\157\156\145")) { goto fTfF2; } goto zCzYS; i7W2m: $optionIndex = $itemOption["\166\141\154\x75\x65"]; goto MiBEx; zCzYS: goto TI00W; goto azilK; S6BF7: $natureField = "\156\x61\164\165\x72\145\x5f" . $optionIndex; goto cCzfb; tVggA: $positiveItemCount += $subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_POSITIVE ? 1 : 0; goto PAhel; doixB: yynic: goto IlIQZ; dwJY2: goto zAxTn; goto viVn9; fmgb5: foreach ($optionIndex as $optionIndexOne) { goto A4tfg; k7trF: HJ1PB: goto Q_5QO; BlOOz: if (!isset($subjectItems[$itemId][$weightField])) { goto HJ1PB; } goto Bc_jS; Q_5QO: ANs0X: goto AxQhK; A4tfg: $weightField = "\x77\x65\x69\x67\x68\164\x5f" . $optionIndexOne; goto BlOOz; Bc_jS: $itemWeight += round($subjectItems[$itemId][$weightField] / 100, 2); goto k7trF; AxQhK: } goto nHGwL; hUOQ9: lauTl: goto Eudz6; Vacpj: $itemWeight = round($subjectItems[$itemId][$weightField] / 100, 2); goto i25KG; ZshHZ: goto TI00W; goto ZcKY3; Tm2OM: t9K1y: goto me62C; IlIQZ: $itemWeight = 0; goto fmgb5; ZfhNa: VVx_n: goto aYTE7; DESFs: if (!($itemType == Defs::QUESTION_TEXT)) { goto t9K1y; } goto omY7r; fAYyq: eZLYc: goto S6BF7; cw5dH: bpm9b: goto a_iUt; omY7r: goto TI00W; goto Tm2OM; me62C: if (is_array($optionIndex)) { goto yynic; } goto CLyE2; PdNLt: fY_0e: goto B56Pi; ggzZb: if (isset($weightDistribution[strval($itemWeight)])) { goto WA9AP; } goto rUzkj; yul4T: $totalPositiveWeight += round($subjectItems[$itemId][$weightField] / 100, 2); goto QBflR; Drj9n: $totalWeight += $itemWeight; goto tzsbs; GI8zG: $weightDistribution[strval($itemWeight)] = 1; goto EjjGQ; viVn9: WA9AP: goto zduVk; a_iUt: yJaZ4: goto K0JP3; xM8t1: zKmyr: goto Z2JqJ; tzsbs: if (isset($weightDistribution[strval($itemWeight)])) { goto fY_0e; } goto GI8zG; FcIry: zAxTn: goto fAYyq; B56Pi: $weightDistribution[strval($itemWeight)]++; goto ZfhNa; cCzfb: if (!isset($subjectItems[$itemId][$natureField])) { goto lauTl; } goto tVggA; EbJcD: if (!($subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_POSITIVE)) { goto nwGi5; } goto yul4T; nHGwL: lkRW0: goto Drj9n; MiBEx: if (isset($subjectItems[$itemId])) { goto zKmyr; } goto Hiww8; QBflR: nwGi5: goto hUOQ9; aYTE7: foreach ($optionIndex as $optionIndexOne) { goto qS_s1; X7c1P: $positiveItemCount += $subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_POSITIVE ? 1 : 0; goto FZ22O; Hzt1H: goto wnTJL; goto RTlUp; RTlUp: ZI12Z: goto X7c1P; N3alT: if (isset($subjectItems[$itemId][$natureField])) { goto ZI12Z; } goto Hzt1H; YiGmm: if (!($subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_POSITIVE)) { goto aJ5h_; } goto TLfG6; GQTMn: aJ5h_: goto ozFFL; ozFFL: wnTJL: goto km2Eq; FZ22O: $negativeItemCount += $subjectItems[$itemId][$natureField] == Defs::SUBJECT_ITEM_OPTION_NATURE_NEGATIVE ? 1 : 0; goto YiGmm; TLfG6: $totalPositiveWeight += round($subjectItems[$itemId]["\167\145\151\x67\150\164\137" . $optionIndexOne] / 100, 2); goto GQTMn; qS_s1: $natureField = "\x6e\x61\x74\165\162\145\137" . $optionIndexOne; goto N3alT; km2Eq: } goto cw5dH; rUzkj: $weightDistribution[strval($itemWeight)] = 1; goto dwJY2; d3M_t: } goto QDoen; dKu2r: jMY0v: goto Hh7Ry; j_G7E: $totalWeightMin = $standard["\163\x74\141\164\x69\x73\x74\x69\x63\x5f\167\x65\151\x67\x68\x74\137\x6d\151\x6e"]; goto PoKfT; YsKn1: S4kNg: goto XmGoB; XlPyt: jjkFq: goto ZOaj2; mrWav: $weightDistribution[strval($i)] = 0; goto K0ykZ; NyN72: if ($positiveItemCount) { goto jjkFq; } goto n1iz4; zSoMz: xNgaA: goto JUzZO; BQLx1: $totalWeightMinStandard = $standard["\163\164\x61\156\x64\x61\x72\x64\x5f\167\x65\151\x67\150\x74\x5f\x6d\x69\156"]; goto Zdilf; gwvhw: $averageWeightMax = 0; goto a_QTL; N6n2r: $latitudes = Db::table("\163\165\142\152\x65\x63\x74\137\x73\164\141\x6e\144\x61\x72\x64\x5f\x6c\141\164\x69\x74\165\x64\x65")->where(["\x73\165\142\152\145\x63\x74\137\151\144" => $subjectId, "\x73\164\x61\x6e\x64\x61\162\144\137\x69\x64" => $standardId])->field(true)->select(); goto mCFFJ; MZsPD: $totalPositiveWeight = 0; goto lnaKC; kNv3j: ZEx_Z: goto iTAo5; YReGk: if (!($itemCount > 0)) { goto EXc3W; } goto WxWTy; ccZ2Y: kItTF: goto e2oec; Zdilf: $averageWeightStandard = round($totalWeightStandard / $itemCount, 2); goto ONO6m; SOm9_: $averageWeightStandard = null; goto kECSd; K0ykZ: sBsgg: goto jhYwR; PoKfT: $averageWeight = round($totalWeight / $itemCount, 2); goto v_WhF; rv3hD: goto Ah7eT; goto dKu2r; opeaJ: $averageWeightMinStandard = round($totalWeightMinStandard / $itemCount, 2); goto xzeAy; nJoE8: if ($positiveItemCount) { goto jMY0v; } goto REy7r; ONO6m: $averageWeightMaxStandard = round($totalWeightMaxStandard / $itemCount, 2); goto opeaJ; wSyl1: $itemCount = 0; goto w9VE3; Ueid7: $totalPositiveWeightStandard = null; goto g8Nl2; I8gJg: $latitudeText = $standard["\154\x61\164\x69\164\x75\x64\145"]; goto N6n2r; Efws1: $totalWeightStandard = null; goto hZXOk; HNTZ5: $warningLevel = Defs::MEASURE_WARNING_UNKOWN_LEVEL; goto X6q8k; SAnEV: F33A7: goto nJoE8; I7WsU: $standardId = $standard["\163\x74\141\x6e\x64\141\x72\x64\137\151\144"]; goto I8gJg; kucJO: $totalWeightMax = 0; goto cMARI; P1bct: $warningLevel = Defs::MEASURE_WARNING_UNKOWN_LEVEL; goto cXTiR; JUzZO: $subjectItemIds = array_keys($subjectItems); goto fUlIz; a_QTL: $averageWeightMin = 0; goto Efws1; Hh7Ry: $positiveAverageWeightStandard = round($tempWeight / $positiveItemCount, 2); goto sVA7G; JmFbJ: $totalWeightMax = $standard["\x73\x74\x61\164\151\x73\x74\x69\x63\x5f\x77\145\151\x67\x68\164\137\x6d\141\170"]; goto j_G7E; c31GR: $convertedResult = $this->convertOriginalToStandard($standard["\163\x74\141\x74\151\x73\164\151\143\x5f\167\145\151\x67\150\x74\x5f\x6d\x69\156"], $standard["\163\164\141\164\151\x73\x74\151\x63\137\167\x65\151\x67\x68\x74\137\155\141\x78"], $standard["\x73\164\141\x6e\x64\141\x72\144\137\x77\x65\x69\x67\150\x74\137\155\x69\156"], $standard["\x73\x74\141\x6e\x64\x61\x72\144\x5f\167\145\x69\147\x68\164\x5f\x6d\141\170"], $tempWeight); goto ALOFQ; YpJqF: $rows[] = ["\163\164\x61\156\144\x61\x72\144\137\151\144" => $standardId, "\154\141\x74\151\x74\165\x64\x65" => $latitudeText, "\x74\x6f\x74\x61\154\137\167\x65\151\x67\x68\x74" => $totalWeight, "\x74\x6f\164\x61\x6c\137\167\x65\151\x67\x68\x74\137\155\x61\170" => $totalWeightMax, "\x74\x6f\x74\x61\154\x5f\167\x65\151\x67\150\x74\137\155\x69\156" => $totalWeightMin, "\141\166\145\162\x61\x67\145\137\167\145\x69\x67\x68\164" => $averageWeight, "\x61\x76\145\x72\141\x67\145\x5f\167\x65\151\x67\150\164\137\155\x61\x78" => $averageWeightMax, "\141\x76\145\162\141\147\145\x5f\x77\145\x69\147\150\164\x5f\x6d\x69\x6e" => $averageWeightMin, "\x70\x6f\163\151\x74\151\x76\145\x5f\x61\166\x65\x72\x61\147\145\x5f\x77\145\x69\x67\x68\x74" => $positiveAverageWeight, "\x77\145\151\147\150\x74\x5f\144\x69\163\x74\162\x69\x62\165\164\x69\x6f\x6e" => $weightDistribution, "\164\157\164\141\154\x5f\x77\x65\151\x67\150\x74\137\x73\x74\141\x6e\144\141\162\x64" => $totalWeightStandard, "\164\x6f\164\141\154\137\167\x65\151\x67\x68\x74\137\x6d\141\x78\137\163\x74\x61\156\144\x61\x72\144" => $totalWeightMaxStandard, "\x74\157\164\x61\154\137\x77\x65\151\147\150\x74\137\155\151\x6e\x5f\x73\164\141\x6e\144\141\162\x64" => $totalWeightMinStandard, "\x61\x76\145\x72\x61\147\x65\x5f\167\145\151\x67\150\x74\x5f\x73\164\x61\x6e\x64\x61\x72\x64" => $averageWeightStandard, "\x61\166\145\x72\141\x67\x65\137\167\145\151\x67\x68\x74\137\155\141\170\x5f\x73\164\x61\x6e\144\x61\162\144" => $averageWeightMaxStandard, "\x61\166\x65\x72\141\147\145\137\x77\x65\151\147\150\164\137\155\151\x6e\137\163\x74\x61\156\x64\x61\x72\144" => $averageWeightMinStandard, "\x70\x6f\x73\x69\164\151\166\x65\137\x61\166\x65\x72\141\147\x65\x5f\167\145\x69\x67\x68\x74\x5f\x73\x74\141\156\x64\141\162\144" => $positiveAverageWeightStandard, "\x69\x74\145\x6d\137\143\157\x75\156\x74" => $itemCount, "\160\x6f\163\x69\x74\x69\x76\x65\x5f\x69\164\145\155\137\x63\157\165\156\164" => $positiveItemCount, "\x6e\x65\x67\x61\164\x69\166\x65\137\x69\164\145\x6d\137\x63\157\x75\156\164" => $negativeItemCount, "\155\x61\164\x63\150\x65\144" => $matched, "\x6d\141\x74\143\x68\145\144\137\145\170\x70\162\x65\x73\x73\151\157\156\163" => $matchedExpressions, "\155\x61\x74\x63\150\x65\144\x5f\144\x65\x73\143\x73" => $matchedDescs, "\155\x61\164\x63\150\145\144\x5f\162\145\155\x61\x72\153\x73" => $matchedRemarks, "\167\141\162\156\x69\156\147\137\154\145\166\x65\x6c" => $warningLevel]; goto ccZ2Y; lnaKC: $positiveAverageWeight = 0; goto Ueid7; VDlde: if (!($i <= 6)) { goto EO1VZ; } goto iVDix; vtuV1: if (!($itemCount > 0)) { goto TWf6P; } goto JmFbJ; GNcen: $tempWeight = $totalWeight; goto c31GR; Ggmeo: $matchedRemarks = []; goto HNTZ5; dAmfz: EO1VZ: goto aEF9J; cXTiR: if ($standardId == 0) { goto xNgaA; } goto H5zoI; ALOFQ: if ($convertedResult) { goto S4kNg; } goto sFezY; QDoen: X3FrD: goto VbQII; hZXOk: $totalWeightMaxStandard = null; goto vQpXV; xcAeo: if (!empty($subjectItemIds)) { goto tHAoO; } goto Zs115; vQpXV: $totalWeightMinStandard = null; goto SOm9_; v_WhF: $averageWeightMax = round($totalWeightMax / $itemCount, 2); goto o26TW; yGQh1: $totalWeightMaxStandard = $standard["\x73\x74\x61\x6e\144\141\162\144\x5f\167\x65\151\x67\x68\x74\x5f\155\141\x78"]; goto BQLx1; jhYwR: $i++; goto mCk9Z; xzeAy: qjLrQ: goto NyN72; p7DIN: s0iv0: goto bLmi0; XJ50A: if ($convertedResult) { goto F33A7; } goto Cj6fK; iVDix: if (isset($weightDistribution[strval($i)])) { goto sBsgg; } goto mrWav; VbQII: $i = 0; goto Q1WGi; Cj6fK: goto ZEx_Z; goto SAnEV; YxAhq: i_PEs: goto vtuV1; mCFFJ: if (!(empty($latitudes) && $standardId == 0)) { goto s0iv0; } goto VGTu9; n1iz4: goto NEolW; goto XlPyt; gQiLM: m3OVs: goto TIZIN; Q1WGi: c0Fun: goto VDlde; fUlIz: TkQn6: goto xcAeo; g8Nl2: $positiveAverageWeightStandard = null; goto vbMSR; e2oec: } goto eHqGU; alRju: logEvent("\346\227\xa0\xe6\263\225\xe6\x89\276\xe5\x88\xb0\xe7\x94\x9f\xe6\x88\220\346\212\245\xe5\221\x8a\xe7\x9a\x84\347\xae\227\xe6\263\x95\346\226\x87\344\273\266\x2c\x20{$file}", EventLogsService::eSeverityError); goto Lt_AL; kAzhn: JDZT3: goto LEaRn; Rkqlo: } public function downloadReportAlgo() { goto eBnDd; N4wUz: if (!empty($content)) { goto u0EpH; } goto gLks2; SWeK0: return; goto lDWEf; FAQ8o: jQyEl: goto MKqTh; eBnDd: $reportLocation = ROOT_PATH . DS . "\x72\145\160\157\162\164"; goto t5V7W; sOIc4: unlink($localSaveFile); goto FAQ8o; EZgN_: $number = $verInfo["\x6e\x75\155\142\x65\x72"]; goto zgmXz; zgmXz: W9eDw: goto BdpzO; IU1Sy: goto jQyEl; goto HQ_QL; Ct_J7: $result = file_put_contents($localSaveFile, $content); goto FWd0z; UyZ8r: wexception("\xe7\256\x97\xe6\263\x95\346\226\207\xe4\273\xb6\xe5\x86\231\xe5\x85\xa5\345\xa4\xb1\350\264\245"); goto PxLGH; Rty8c: $localSaveFile = $reportLocation . DS . basename($downloadUrl); goto cxjrX; y0F9e: u0EpH: goto Ct_J7; HQ_QL: IxUIc: goto OFgdg; M7cQx: if ($zip->open($localSaveFile) === TRUE) { goto IxUIc; } goto gUe3_; cxjrX: $content = file_get_contents($downloadUrl); goto N4wUz; CT9dC: if (!file_exists($reportLocation . DS . "\x76\x65\162\56\x70\150\x70")) { goto W9eDw; } goto DaJEV; BdpzO: $downloadUrl = WzyerService::I()->apiFetchReportAlgo($number); goto iBGDP; gLks2: wexception("\344\270\x8b\xe8\xbd\275\347\256\227\xe6\263\x95\xe6\x96\207\344\273\266\345\244\261\xe8\xb4\245"); goto y0F9e; OFgdg: $zip->extractTo($reportLocation . DS); goto Hk7Yj; Hk7Yj: $zip->close(); goto sOIc4; DaJEV: $verInfo = (include_once $reportLocation . DS . "\x76\145\162\x2e\x70\x68\160"); goto EZgN_; ZKrV2: $zip = new \ZipArchive(); goto M7cQx; gUe3_: wexception("\350\xa7\xa3\xe5\216\213\xe6\x96\207\xe4\xbb\xb6\xe5\244\xb1\xe8\264\245\x2c\x20{$localSaveFile}"); goto IU1Sy; PxLGH: L_LII: goto ZKrV2; FWd0z: if ($result) { goto L_LII; } goto UyZ8r; lDWEf: ADCb5: goto Rty8c; t5V7W: $number = ''; goto CT9dC; iBGDP: if (!empty($downloadUrl)) { goto ADCb5; } goto SWeK0; MKqTh: } public function importSubject($subjectId) { goto MqpRf; eKT80: $subject["\163\x75\142\152\x65\x63\x74\137\144\145\163\143"] = htmlspecialchars($subject["\x73\165\142\152\x65\143\164\137\144\145\x73\x63"]); goto IjVGi; h1MwO: $subject["\162\145\x70\x6f\x72\x74\x5f\x69\155\x61\147\x65\x36"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x72\x65\160\x6f\162\164\137\x69\x6d\x61\x67\x65\66"])); goto EtdY3; xr015: UHqd2: goto AytG9; nze5v: JMFXZ: goto Q9rAk; euZLW: $subjectStandards = $subjctData["\163\x75\142\152\145\143\164\x53\164\x61\x6e\x64\x61\x72\x64\163"]; goto XYTOP; Iaf5j: lxvkQ: goto aCtnO; tv6em: $subjectIdNew = Db::table("\163\165\142\x6a\x65\143\x74")->insertGetId($subject); goto ltyqI; mm5tY: foreach ($subjectStandardLatitudes as $subjectStandardLatitude) { goto XkxFW; dYUsQ: DNzOL: goto wEht1; EoW_A: $subjectStandardLatitude["\163\x74\141\156\x64\141\162\x64\137\151\x64"] = $subjectStandardsNew[$subjectStandardLatitude["\163\164\x61\x6e\144\141\x72\x64\x5f\151\x64"]]["\x69\144"]; goto dYUsQ; ZXY6V: if (!$subjectStandardLatitude["\163\164\141\156\144\x61\162\x64\137\x69\x64"]) { goto DNzOL; } goto EoW_A; wEht1: Db::table("\x73\x75\142\152\x65\x63\x74\x5f\x73\164\141\156\144\x61\162\x64\x5f\x6c\141\x74\x69\164\x75\144\145")->insert($subjectStandardLatitude); goto hPz6K; XkxFW: unset($subjectStandardLatitude["\151\x64"]); goto pwEfZ; pwEfZ: $subjectStandardLatitude["\163\165\x62\x6a\x65\143\x74\137\x69\144"] = $subjectIdNew; goto ZXY6V; hPz6K: AHcuz: goto W2OGV; W2OGV: } goto gaF63; MqpRf: $subjctData = WzyerService::I()->apiSubject($subjectId); goto HkKgg; gwg3d: Log::notice("\x73\x75\142\152\x65\143\164\x53\x74\141\156\x64\141\162\144\x73\x3a\40" . json_encode($subjectStandards)); goto Rshqp; IjVGi: unset($subject["\151\x64"]); goto tv6em; HxuD1: $subject["\142\141\x6e\156\145\x72\137\x69\155\x67"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\142\x61\156\156\x65\x72\x5f\x69\x6d\147"])); goto x9ARc; QjHCG: foreach ($subjectItemStandards as $subjectItemStandard) { goto e5nrn; e5nrn: unset($subjectItemStandard["\x69\x64"]); goto QxE3U; Q4ve6: Db::table("\x73\165\142\x6a\145\143\x74\x5f\x69\x74\x65\155\x5f\x73\164\141\x6e\x64\x61\x72\x64")->insert($subjectItemStandard); goto rM4zo; pItVF: $subjectItemStandard["\151\164\x65\155\x5f\151\144"] = $subjectItemsNew[$subjectItemStandard["\151\164\145\155\x5f\151\x64"]]["\x69\144"]; goto lbjpP; rM4zo: G1eE6: goto keFi1; lbjpP: $subjectItemStandard["\x73\x74\141\x6e\144\x61\x72\x64\137\x69\x64"] = $subjectStandardsNew[$subjectItemStandard["\163\x74\141\156\x64\x61\162\144\137\151\144"]]["\x69\x64"]; goto Q4ve6; QxE3U: $subjectItemStandard["\x73\165\142\152\x65\143\164\x5f\x69\144"] = $subjectIdNew; goto pItVF; keFi1: } goto nze5v; qs1wP: foreach ($subjectItems as $subjectItem) { goto qrkqj; Xaadl: $subjectItemIdNew = Db::table("\163\x75\142\x6a\145\143\x74\x5f\x69\x74\x65\155")->insertGetId($subjectItem); goto bd7Hg; z1bKS: $subjectItem["\151\155\141\147\145\x5f" . $i] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subjectItem["\x69\155\x61\x67\145\x5f" . $i])); goto jh8D0; E_gU3: $i = 1; goto mUegW; sc97x: $subjectItemsNew[$subjectItemId] = $subjectItem; goto HX1DX; HX1DX: CoWrH: goto c8OJz; VWsYK: if (!($i <= 12)) { goto dlTbE; } goto z1bKS; bd7Hg: $subjectItem["\151\144"] = $subjectItemIdNew; goto sc97x; mUegW: orgrY: goto VWsYK; qrkqj: $subjectItemId = $subjectItem["\151\144"]; goto KuSqT; KuSqT: unset($subjectItem["\151\144"]); goto CdkjI; dB8Tv: goto orgrY; goto SPbA8; mtpCY: $subjectItem["\x69\x6d\x61\147\145"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subjectItem["\x69\155\x61\147\x65"])); goto E_gU3; CdkjI: $subjectItem["\163\x75\142\152\145\143\x74\x5f\151\144"] = $subjectIdNew; goto mtpCY; SPbA8: dlTbE: goto Xaadl; jh8D0: $i++; goto dB8Tv; c8OJz: } goto R9Z0r; AytG9: $subject["\x73\165\142\152\x65\143\164\137\144\x65\x73\x63"] = htmlspecialchars_decode($subject["\x73\165\x62\x6a\145\x63\x74\137\x64\145\163\x63"]); goto wDPnm; a1n0q: $subjectItemStandards = $subjctData["\x73\165\x62\x6a\x65\143\x74\x49\164\145\x6d\123\x74\141\x6e\144\x61\x72\144\163"]; goto clWm8; Rshqp: $subjectStandardsNew = []; goto nErwF; wDPnm: $subject["\163\x75\142\x6a\145\x63\x74\x5f\x64\x65\x73\x63"] = preg_replace("\x2f\x3c\x5b\151\155\x67\174\x49\115\x47\135\x2e\52\77\163\162\143\x3d\133\47\x7c\134\42\135\x28\56\52\x3f\51\x5b\47\174\134\42\x5d\57", "\74\x69\155\x67\x20\163\162\x63\75\42\150\x74\164\x70\163\x3a\57\x2f\x77\167\167\56\x77\x7a\171\145\x72\56\143\157\155\x24\173\61\175\42", $subject["\163\x75\142\x6a\145\143\164\x5f\x64\x65\x73\x63"]); goto eKT80; wpy3E: $subject["\x72\145\160\x6f\x72\164\137\151\155\x61\147\145\64"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x72\145\x70\x6f\x72\x74\137\x69\155\x61\x67\x65\x34"])); goto fiASY; Ulc0t: $subject["\141\165\144\x69\x6f\x5f\x75\162\x6c"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x61\165\144\x69\x6f\137\x75\x72\x6c"])); goto isKim; dZiqx: $subject["\x72\145\x70\157\x72\164\x5f\x69\x6d\x61\147\145\x32"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\162\145\160\x6f\x72\x74\137\151\x6d\141\x67\x65\62"])); goto pY100; clWm8: $subject["\151\x6d\141\147\145\137\x75\x72\154"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\151\155\141\147\x65\x5f\x75\x72\x6c"])); goto HxuD1; isKim: if (!$subject["\x72\145\160\x6f\162\x74\x5f\x64\x65\155\x6f\137\x69\x6d\x61\x67\145\163"]) { goto UHqd2; } goto VK6hO; aCtnO: $subject["\x72\145\x70\x6f\162\x74\137\144\145\155\x6f\x5f\x69\x6d\x61\x67\x65\x73"] = implode("\x2c", $imagesLocal); goto xr015; EtdY3: $subject["\166\151\144\x65\157\137\165\162\x6c"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x76\x69\144\x65\x6f\137\x75\x72\x6c"])); goto Ulc0t; Q9rAk: OperationLogs::I()->subjectLog("\345\257\xbc\345\x85\xa5\xe9\x87\217\xe8\241\xa8\40\x2d\40{$subject["\156\x61\155\145"]}", beautifyLogArray($subject, [], "\x73\165\142\x6a\x65\x63\164"), OperationLogs::OPT_ADD_TYPE, $subjectIdNew); goto zd2LX; HTIic: $subjectItems = $subjctData["\163\x75\x62\x6a\145\143\164\111\x74\x65\155\163"]; goto euZLW; HkKgg: $subject = $subjctData["\x73\165\x62\x6a\145\143\164"]; goto HTIic; p97cL: Log::notice("\163\165\142\x6a\145\143\x74\123\164\x61\156\x64\141\162\144\x73\x4e\x65\x77\x3a\40" . json_encode($subjectStandardsNew)); goto mm5tY; Fdrpc: foreach ($images as $image) { goto GXHr4; tX3vW: if (!$imageLocal) { goto E33z8; } goto rbbec; rbbec: $imagesLocal[] = $imageLocal; goto CLtmo; CLtmo: E33z8: goto t24Wp; GXHr4: $imageLocal = downloadRemoteUploadFile(generateWzyerUploadFullUrl($image)); goto tX3vW; t24Wp: BrNp6: goto w7tsm; w7tsm: } goto Iaf5j; nErwF: foreach ($subjectStandards as $subjectStandard) { goto GoMcp; zqjij: unset($subjectStandard["\151\x64"]); goto f7Iv0; GoMcp: $subjectStandardId = $subjectStandard["\x69\144"]; goto zqjij; xT0Q0: $subjectStandardIdNew = Db::table("\x73\165\142\152\x65\x63\x74\x5f\x73\164\x61\156\144\141\x72\x64")->insertGetId($subjectStandard); goto IzRdl; y2Lch: $subjectStandardsNew[$subjectStandardId] = $subjectStandard; goto sZaqv; f7Iv0: $subjectStandard["\163\165\x62\x6a\145\143\164\137\x69\144"] = $subjectIdNew; goto xT0Q0; sZaqv: dBdhM: goto QYf6V; IzRdl: $subjectStandard["\x69\144"] = $subjectStandardIdNew; goto y2Lch; QYf6V: } goto b74_D; ltyqI: $subjectItemsNew = []; goto qs1wP; fiASY: $subject["\162\145\160\157\162\164\137\x69\x6d\x61\147\x65\x35"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\x72\145\160\157\162\164\x5f\x69\x6d\141\x67\x65\x35"])); goto h1MwO; b74_D: sWYmZ: goto p97cL; XYTOP: $subjectStandardLatitudes = $subjctData["\163\x75\x62\x6a\x65\143\164\x53\x74\141\156\x64\x61\162\x64\x4c\141\x74\151\x74\165\x64\x65\163"]; goto a1n0q; gaF63: BJKh7: goto QjHCG; VK6hO: $images = explode("\x2c", $subject["\x72\145\x70\157\x72\164\137\144\x65\155\x6f\x5f\151\155\141\x67\145\163"]); goto VZqkL; R9Z0r: nEEXN: goto gwg3d; VZqkL: $imagesLocal = []; goto Fdrpc; pY100: $subject["\162\145\160\x6f\x72\164\137\151\x6d\x61\x67\x65\x33"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\162\145\160\x6f\162\164\x5f\x69\155\141\147\145\63"])); goto wpy3E; x9ARc: $subject["\x72\x65\x70\x6f\x72\x74\137\151\x6d\x61\147\x65\61"] = downloadRemoteUploadFile(generateWzyerUploadFullUrl($subject["\162\145\160\157\162\x74\137\x69\155\141\x67\145\x31"])); goto dZiqx; zd2LX: } public function duplicateSubject($subjectId) { goto U_N1y; v3kAK: foreach ($subjectItemStandards as $subjectItemStandard) { goto H2nSO; b75ru: $subjectItemStandard["\163\164\x61\156\x64\141\x72\144\x5f\151\x64"] = $subjectStandardsNew[$subjectItemStandard["\x73\x74\141\x6e\x64\141\x72\144\x5f\x69\x64"]]["\x69\144"]; goto CZZH6; CZZH6: Db::table("\163\165\142\x6a\x65\x63\164\x5f\151\164\x65\x6d\137\x73\164\141\x6e\x64\141\x72\x64")->insert($subjectItemStandard); goto Ebo1m; SMaIF: $subjectItemStandard["\x69\x74\145\155\137\x69\144"] = $subjectItemsNew[$subjectItemStandard["\x69\x74\145\x6d\x5f\x69\x64"]]["\x69\144"]; goto b75ru; UF3W6: $subjectItemStandard["\163\165\142\x6a\145\x63\x74\x5f\x69\144"] = $subjectIdNew; goto SMaIF; H2nSO: unset($subjectItemStandard["\151\x64"]); goto UF3W6; Ebo1m: FU0qL: goto SFobQ; SFobQ: } goto YxNuG; VfEEm: foreach ($subjectStandardLatitudes as $subjectStandardLatitude) { goto LG1Hx; Rs50l: Db::table("\163\x75\x62\x6a\x65\x63\164\137\x73\x74\x61\x6e\144\141\162\x64\x5f\154\141\164\x69\164\x75\x64\x65")->insert($subjectStandardLatitude); goto qQ0RT; NCTuh: $subjectStandardLatitude["\163\165\x62\152\145\x63\x74\x5f\x69\x64"] = $subjectIdNew; goto iLJsE; LG1Hx: unset($subjectStandardLatitude["\151\144"]); goto NCTuh; qQ0RT: Q0wnV: goto I0EhB; iLJsE: $subjectStandardLatitude["\x73\x74\x61\156\x64\x61\162\x64\x5f\151\144"] = 0; goto Rs50l; I0EhB: } goto VE1N6; U_N1y: $subject = Db::table("\163\x75\142\x6a\145\143\164")->where("\151\144", $subjectId)->field("\52")->find(); goto SsHH7; FthzS: $subjectItemsNew = []; goto TzEbc; xWfVx: Amucd: goto U8qkj; spNuC: $subject["\x64\145\154\x65\164\x65\x5f\146\x6c\141\147"] = 0; goto Hxk2X; thNHI: OperationLogs::I()->subjectLog("\345\244\215\345\210\266\xe9\207\x8f\350\241\250\x20\55\x20{$subject["\x6e\141\x6d\x65"]}", beautifyLogArray($subject, [], "\x73\x75\142\x6a\x65\143\x74"), OperationLogs::OPT_ADD_TYPE, $subjectIdNew); goto Q133M; M8F1X: foreach ($subjectStandards as $subjectStandard) { goto RdPnr; hzBNF: $subjectStandardIdNew = Db::table("\x73\165\142\152\145\x63\164\x5f\x73\x74\x61\156\x64\x61\x72\x64")->insertGetId($subjectStandard); goto tcaxG; stdyS: $subjectStandardsNew[$subjectStandardId] = $subjectStandard; goto iZc6P; RdPnr: $subjectStandardId = $subjectStandard["\151\144"]; goto X95HU; iZc6P: Spqoc: goto zvuhF; X95HU: unset($subjectStandard["\x69\144"]); goto kbPbg; tcaxG: $subjectStandard["\x69\144"] = $subjectStandardIdNew; goto stdyS; kbPbg: $subjectStandard["\x73\165\x62\x6a\x65\x63\164\137\151\x64"] = $subjectIdNew; goto hzBNF; zvuhF: } goto DIwjT; z3CS3: foreach ($subjectStandardsNew as $subjectStandardId => $subjectStandardNew) { goto OCyjy; wbVG6: foreach ($subjectStandardLatitudes as $subjectStandardLatitude) { goto wH_yh; BPYtS: $subjectStandardLatitude["\163\165\x62\152\x65\x63\x74\137\x69\x64"] = $subjectIdNew; goto myIq5; g1i8c: ZAaCA: goto xkuL1; myIq5: $subjectStandardLatitude["\163\164\141\x6e\144\141\x72\144\x5f\x69\144"] = $subjectStandardNew["\151\x64"]; goto Q26wc; wH_yh: unset($subjectStandardLatitude["\151\144"]); goto BPYtS; Q26wc: Db::table("\x73\x75\x62\x6a\x65\143\164\137\163\x74\141\156\x64\141\x72\x64\137\x6c\141\164\151\x74\x75\x64\145")->insert($subjectStandardLatitude); goto g1i8c; xkuL1: } goto ImX1u; wNcWt: DEqmo: goto DZP02; OCyjy: $subjectStandardLatitudes = Db::table("\x73\x75\x62\x6a\x65\x63\x74\x5f\163\164\141\156\x64\141\x72\144\137\154\x61\164\x69\164\165\144\x65")->where(["\x73\165\142\x6a\x65\x63\164\137\x69\x64" => $subjectId, "\x73\164\141\156\x64\141\x72\144\x5f\151\144" => $subjectStandardId])->field("\52")->select(); goto wbVG6; ImX1u: TMcOr: goto wNcWt; DZP02: } goto xWfVx; IIBgc: $subject["\165\x6e\151\137\x61\160\x70"] = 0; goto FvBTh; tbGXq: $subjectStandards = Db::table("\163\165\x62\152\x65\x63\x74\137\x73\164\141\156\144\x61\x72\x64")->where("\163\x75\142\152\145\x63\164\137\151\x64", $subjectId)->field("\x2a")->select(); goto M8F1X; fXFaY: $subject["\x63\165\x72\x72\x65\156\164\137\160\x72\x69\x63\145"] = 0; goto FeOjM; tVha4: $subject["\x70\141\162\x74\x69\143\x69\160\141\156\164\163"] = 0; goto IATnf; DIwjT: dhT1F: goto gJlLC; SsHH7: if (!empty($subject)) { goto ja17C; } goto rF2Le; zu9mz: $subject["\x73\x74\141\x74\165\x73"] = IndexDefs::ENTITY_DRAFT_STATUS; goto GgIUO; pQUjG: ozpLF: goto KG1JJ; pk7Vj: unset($subject["\x63\x72\145\x61\x74\145\x5f\x74\x69\155\x65"]); goto aathQ; TzEbc: $subjectItems = Db::table("\x73\165\x62\152\145\143\x74\137\x69\164\x65\x6d")->where("\163\x75\x62\152\145\x63\164\x5f\151\144", $subjectId)->field("\52")->select(); goto m6LbN; IATnf: $subject["\x70\141\162\164\151\143\x69\x70\141\156\164\x73\x5f\163\x68\157\167"] = 0; goto tEVhQ; Hxk2X: $subject["\x71\x72\143\x6f\x64\145"] = ''; goto IIBgc; LuUvM: unset($subject["\x69\144"]); goto QtIy7; MC13S: ja17C: goto LuUvM; FvBTh: $subjectIdNew = Db::table("\x73\x75\142\152\145\x63\x74")->insertGetId($subject); goto FthzS; m6LbN: foreach ($subjectItems as $subjectItem) { goto Lcr5_; cltIy: $subjectItem["\x69\x64"] = $subjectItemIdNew; goto WXKxf; vfTKF: $subjectItem["\x73\x75\142\152\x65\143\164\137\151\x64"] = $subjectIdNew; goto RuWTs; wOssX: unset($subjectItem["\151\x64"]); goto vfTKF; RuWTs: $subjectItemIdNew = Db::table("\163\165\x62\152\x65\143\x74\137\151\164\x65\x6d")->insertGetId($subjectItem); goto cltIy; Lcr5_: $subjectItemId = $subjectItem["\x69\x64"]; goto wOssX; WXKxf: $subjectItemsNew[$subjectItemId] = $subjectItem; goto CqPhj; CqPhj: JyirJ: goto mg46y; mg46y: } goto pQUjG; tEVhQ: $subject["\x74\x6f\164\141\154\x5f\x61\155\157\165\x6e\x74"] = 0; goto spNuC; YxNuG: AMKpA: goto m63Av; rF2Le: exception("\346\227\xa0\346\xb3\225\346\x89\xbe\345\x88\260\xe9\207\x8f\xe8\241\xa8"); goto MC13S; m63Av: $subjectCategories = Db::table("\163\165\142\x6a\145\x63\x74\137\x63\x61\164\x65\x67\x6f\x72\x79\x5f\x72\x65\x6c\x61\164\x65")->where("\x73\165\142\152\x65\143\x74\x5f\x69\144", $subjectId)->field("\52")->select(); goto wV2k5; gJlLC: $subjectStandardLatitudes = Db::table("\x73\165\x62\152\145\x63\164\x5f\163\164\x61\156\144\x61\162\x64\x5f\154\141\x74\x69\x74\x75\144\145")->where(["\163\x75\142\x6a\145\x63\164\137\x69\144" => $subjectId, "\163\164\x61\x6e\x64\141\x72\x64\x5f\x69\144" => 0])->field("\x2a")->select(); goto VfEEm; KG1JJ: $subjectStandardsNew = []; goto tbGXq; QtIy7: $subject["\163\156"] = generateSubjectSn(); goto fXFaY; MY2EQ: kGE4v: goto thNHI; GgIUO: $subject["\154\141\x62\x65\154"] = ''; goto tVha4; U8qkj: $subjectItemStandards = Db::table("\163\x75\142\x6a\x65\143\164\137\x69\164\x65\155\x5f\163\164\x61\x6e\144\x61\162\144")->where("\x73\x75\142\152\145\x63\164\x5f\151\144", $subjectId)->field("\52")->select(); goto v3kAK; aathQ: unset($subject["\155\x6f\144\x69\146\171\x5f\x74\151\x6d\x65"]); goto zu9mz; wV2k5: foreach ($subjectCategories as $subjectCategory) { goto plLB8; plLB8: $subjectCategory["\x73\165\142\152\x65\x63\164\x5f\151\144"] = $subjectIdNew; goto B2v44; yrNJx: dgEO5: goto j8Hu7; B2v44: Db::table("\163\165\x62\152\x65\x63\164\137\143\x61\x74\x65\x67\x6f\162\x79\x5f\162\x65\154\x61\x74\145")->insert($subjectCategory); goto yrNJx; j8Hu7: } goto MY2EQ; VE1N6: w_88g: goto z3CS3; FeOjM: $subject["\x73\x6f\162\x74"] = 1000; goto pk7Vj; Q133M: } }
