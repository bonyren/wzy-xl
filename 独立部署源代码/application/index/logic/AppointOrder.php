<?php
 namespace app\index\logic; use app\index\model\Setting; use think\Debug; use think\Db; use think\Log; use think\Request; use think\Session; use app\Defs; use app\index\logic\Defs as IndexDefs; use app\index\service\EventLogs as EventLogsService; use app\index\model\AppointOrder as AppointOrderModel; use EasyWeChat\Factory; use app\index\service\RequestContext; use app\index\service\OperationLogs as OperationLogsService; class AppointOrder extends Base { protected function __construct() { parent::__construct(); } public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto vmXSO; DzDvl: $conditions["\103\56\156\151\x63\153\156\141\x6d\145"] = ["\x6c\151\153\x65", "\x25" . $search["\x6e\x69\x63\x6b\x6e\141\155\x65"] . "\45"]; goto sIfQF; spPZP: $conditions["\117\56\x73\164\x61\x74\x75\x73"] = $search["\x73\164\x61\x74\x75\163"]; goto EplQx; jQqCL: v_MRR: goto vbwbq; aKMw6: jBDu8: goto t3ny0; FRPyZ: dtaex: goto pkoLz; DMeEz: return ["\164\x6f\164\x61\x6c" => $totalCount, "\x72\157\167\x73" => $records]; goto dTmp7; nKC2x: if (emptyInArray($search, "\143\x65\154\154\x70\150\x6f\156\145")) { goto v_MRR; } goto RO3w6; acemL: if ($sort == "\x61\160\x70\x6f\151\x6e\x74\137\164\x69\155\x65\x5f\x66\x75\154\x6c") { goto o6ykG; } goto vXLNh; vXLNh: $order = "\x4f\56\157\162\x64\x65\162\137\164\x69\x6d\145\x20\x64\145\163\x63"; goto ALQQ1; vAfUW: $conditions["\x4f\56\157\162\x64\x65\162\137\156\157"] = $search["\157\x72\144\145\162\x5f\x6e\157"]; goto ZPWeQ; RO3w6: $conditions["\x4f\x2e\x63\x65\154\154\x70\x68\157\156\145"] = ["\154\x69\x6b\x65", "\45" . $search["\143\145\154\x6c\x70\150\x6f\x6e\145"] . "\x25"]; goto jQqCL; Igm4N: if (emptyInArray($search, "\145\x78\160\x65\162\x74\137\151\144")) { goto dtaex; } goto RIuFE; Ef6Au: $order = "\x4f\x2e\x61\x70\x70\x6f\151\156\x74\137\x64\141\x74\145\40" . $order . "\x2c\x20\x4f\56\141\x70\x70\157\x69\x6e\x74\x5f\x74\151\155\x65\40" . $order; goto aKMw6; yt2sm: o6ykG: goto Ef6Au; EplQx: Z3nLo: goto xlCjf; pkoLz: if (emptyInArray($search, "\143\x75\163\x74\x6f\x6d\145\x72\137\151\144")) { goto iH2Xr; } goto GdZC2; vbwbq: if (!(isset($search["\163\x74\141\x74\165\x73"]) && $search["\163\164\141\x74\x75\163"])) { goto Z3nLo; } goto spPZP; t3ny0: goto v_AEo; goto W1NAb; hXd0R: $records = Db::table("\x65\170\x70\145\162\x74\x5f\157\x72\144\x65\162")->alias("\x4f")->join("\145\170\x70\x65\162\164\40\x45", "\x4f\56\145\x78\x70\145\x72\x74\137\x69\x64\x3d\105\x2e\x69\x64")->join("\x63\165\163\164\157\x6d\x65\x72\40\x43", "\x4f\56\x63\x75\163\164\x6f\x6d\x65\162\x5f\151\144\75\103\56\151\144")->where($conditions)->page($page, $rows)->order($order)->field("\x4f\x2e\x2a\x2c\40\105\56\x72\145\x61\154\137\x6e\141\155\x65\40\x61\x73\40\x65\x78\160\x65\162\x74\137\162\145\x61\x6c\137\x6e\x61\155\x65\54\40\x45\x2e\143\145\x6c\x6c\160\150\157\x6e\145\x20\x61\163\40\x65\170\x70\145\162\x74\x5f\143\145\154\154\160\150\157\156\x65\54\40\x43\x2e\x6e\151\x63\153\156\141\x6d\x65\54\40\143\x6f\156\x63\x61\164\50\x4f\x2e\141\x70\x70\x6f\x69\156\x74\137\x64\x61\x74\145\x2c\40\47\40\x27\54\x20\117\x2e\141\x70\160\x6f\151\156\x74\137\x74\151\155\x65\x2c\x20\47\x28\47\54\40\117\x2e\141\160\160\x6f\151\x6e\164\x5f\x64\x75\162\141\164\151\x6f\x6e\x2c\40\47\51\47\x29\40\141\163\40\x61\160\160\157\x69\156\x74\137\144\x61\x74\x65\x5f\x74\151\x6d\145")->select(); goto syxp1; UyglP: $conditions["\x4f\x2e\154\x69\x6e\x6b\155\141\x6e"] = ["\154\151\153\145", "\x25" . $search["\x6c\151\156\153\x6d\141\x6e"] . "\45"]; goto jYCjV; qwXOl: x_3eG: goto Igm4N; vmXSO: if ($sort == "\x6f\162\x64\145\x72\x5f\164\x69\155\145") { goto ZukvP; } goto acemL; LHn2k: $conditions["\x45\56\162\x65\141\x6c\x5f\156\141\x6d\145"] = ["\x6c\151\x6b\145", "\45" . $search["\162\145\141\x6c\x5f\x6e\141\x6d\x65"] . "\45"]; goto qwXOl; MLzCi: $conditions["\x4f\x2e\160\x61\x79\137\x73\164\141\164\165\x73"] = $search["\160\141\x79\x5f\163\164\x61\x74\x75\163"]; goto OE2GI; sIfQF: uk0XI: goto ScfCw; ZCRT7: $conditions = []; goto oGC34; Bb3OA: if (emptyInArray($search, "\154\151\156\153\155\x61\x6e")) { goto SAOUn; } goto UyglP; JJHcl: v_AEo: goto ZCRT7; iX7Iv: if (emptyInArray($search, "\x6e\x69\143\153\x6e\x61\155\145")) { goto uk0XI; } goto DzDvl; cuKQi: $totalCount = Db::table("\x65\x78\x70\145\x72\x74\x5f\157\162\144\145\162")->alias("\x4f")->join("\x65\x78\160\x65\x72\x74\40\x45", "\x4f\56\x65\170\160\x65\162\164\137\x69\144\75\x45\x2e\151\144")->join("\x63\165\x73\x74\157\x6d\x65\x72\40\103", "\x4f\x2e\143\165\x73\x74\157\x6d\145\x72\x5f\151\144\x3d\103\56\151\x64")->where($conditions)->count(); goto hXd0R; syxp1: foreach ($records as &$record) { goto M0vX1; U8jws: IhY2Y: goto dF81j; Olxb0: $record["\x61\160\x70\157\151\x6e\164\137\164\151\x6d\145\x5f\146\165\x6c\x6c"] = $record["\141\160\x70\157\x69\156\164\x5f\144\141\x74\145"] . "\x20" . $showTime . "\x28" . $record["\141\160\160\x6f\151\156\164\137\144\x75\162\x61\164\151\x6f\156"] . "\345\210\206\xe9\x92\x9f\x29"; goto U8jws; M0vX1: $showTime = convertAppointTimesToShow($record["\x61\x70\160\x6f\151\x6e\164\x5f\164\151\155\x65"]); goto Olxb0; dF81j: } goto KT2VZ; ZPWeQ: Wr2rc: goto iX7Iv; oGC34: if (emptyInArray($search, "\157\162\x64\x65\162\x5f\156\x6f")) { goto Wr2rc; } goto vAfUW; W1NAb: ZukvP: goto zmEoW; zmEoW: $order = "\117\56\x6f\x72\x64\145\x72\137\164\x69\155\x65\40" . $order; goto JJHcl; ScfCw: if (emptyInArray($search, "\x72\x65\x61\154\137\x6e\141\x6d\x65")) { goto x_3eG; } goto LHn2k; OE2GI: Lukvb: goto cuKQi; xlCjf: if (!(isset($search["\160\x61\171\x5f\163\x74\x61\164\165\163"]) && $search["\160\x61\171\137\163\164\141\x74\x75\x73"])) { goto Lukvb; } goto MLzCi; ALQQ1: goto jBDu8; goto yt2sm; jYCjV: SAOUn: goto nKC2x; GdZC2: $conditions["\x4f\x2e\x63\165\163\164\x6f\155\145\162\x5f\151\144"] = $search["\143\x75\x73\164\x6f\155\x65\x72\x5f\151\x64"]; goto x0B4w; x0B4w: iH2Xr: goto Bb3OA; RIuFE: $conditions["\x4f\x2e\145\170\160\145\162\164\x5f\151\x64"] = $search["\x65\x78\x70\x65\x72\164\x5f\151\x64"]; goto FRPyZ; KT2VZ: VL41X: goto DMeEz; dTmp7: } public function getInfos($orderNo) { goto FD0IC; thYdG: $showTime = convertAppointTimesToShow($infos["\141\160\160\157\151\x6e\164\x5f\x74\151\x6d\x65"]); goto spgso; qD5EM: return null; goto QU46Q; bRk6S: return $infos; goto w0Iwq; QU46Q: X3gk3: goto thYdG; FD0IC: $infos = Db::table("\145\x78\x70\145\x72\x74\137\x6f\162\144\x65\162")->where("\x6f\162\144\145\x72\x5f\x6e\x6f", $orderNo)->field(true)->find(); goto SnsVf; spgso: $infos["\141\160\160\x6f\151\156\x74\137\164\151\x6d\145\137\x66\x75\x6c\x6c"] = $infos["\x61\x70\x70\x6f\151\156\164\137\x64\141\164\x65"] . "\40" . $showTime . "\50" . $infos["\141\x70\x70\157\x69\x6e\x74\137\144\165\162\x61\164\x69\157\x6e"] . "\345\x88\x86\351\x92\237\51"; goto bRk6S; SnsVf: if ($infos) { goto X3gk3; } goto qD5EM; w0Iwq: } public function getOrderInfos($customerId, $orderNo) { goto F7rW7; aHRFr: return null; goto ahERy; F7rW7: $infos = Db::table("\145\x78\x70\145\162\x74\137\x6f\162\144\145\162")->where(["\x63\165\163\164\x6f\155\145\x72\137\151\x64" => $customerId, "\x6f\x72\x64\x65\x72\x5f\x6e\x6f" => $orderNo])->field(true)->find(); goto wAD92; wAD92: if ($infos) { goto zjCbp; } goto aHRFr; ahERy: zjCbp: goto oxNuq; YFL7n: $infos["\x61\x70\x70\157\151\156\164\137\164\x69\x6d\145\137\x66\165\x6c\154"] = $infos["\x61\x70\x70\x6f\151\156\164\x5f\x64\141\x74\x65"] . "\40" . $showTime . "\x28" . $infos["\141\160\160\x6f\x69\x6e\x74\x5f\x64\x75\x72\141\x74\151\x6f\x6e"] . "\345\210\x86\xe9\x92\237\x29"; goto O7wg_; oxNuq: $showTime = convertAppointTimesToShow($infos["\x61\x70\160\157\151\156\x74\x5f\x74\151\155\145"]); goto YFL7n; O7wg_: return $infos; goto SHa9M; SHa9M: } public function getOrderInfosById($id) { goto GLotm; g1Zj7: return null; goto uy1zz; V77d3: return $infos; goto qEPqz; sMqrY: if ($infos) { goto SwuAm; } goto g1Zj7; Slq3k: $infos["\x61\160\160\x6f\151\156\164\x5f\x74\x69\155\145\137\146\x75\x6c\x6c"] = $infos["\141\160\160\157\151\156\164\x5f\144\x61\164\145"] . "\40" . $showTime . "\50" . $infos["\141\160\160\157\151\x6e\164\x5f\x64\x75\162\141\x74\x69\157\x6e"] . "\xe5\210\x86\xe9\222\237\x29"; goto V77d3; GLotm: $infos = Db::table("\x65\170\x70\x65\162\164\x5f\157\x72\144\x65\x72")->where(["\151\x64" => $id])->field(true)->find(); goto sMqrY; uy1zz: SwuAm: goto qk3pG; qk3pG: $showTime = convertAppointTimesToShow($infos["\141\x70\x70\157\151\156\164\x5f\164\x69\x6d\x65"]); goto Slq3k; qEPqz: } public function refreshOrderNo($customerId, $orderNo) { goto MfNvk; aj4dW: return false; goto TysEG; ZOg2Z: return $orderNoNew; goto tJy8T; eBbYx: Db::table("\145\x78\160\145\162\x74\137\x6f\162\144\145\x72")->where(["\143\165\x73\164\x6f\x6d\x65\x72\x5f\151\144" => $customerId, "\x6f\x72\144\145\x72\x5f\156\157" => $orderNo])->setField("\x6f\162\x64\x65\162\x5f\x6e\x6f", $orderNoNew); goto ZOg2Z; MfNvk: $infos = Db::table("\145\170\160\x65\x72\164\x5f\x6f\162\x64\145\162")->where(["\x63\165\163\164\x6f\x6d\145\162\137\x69\144" => $customerId, "\x6f\x72\144\145\162\x5f\156\157" => $orderNo])->field(true)->find(); goto Z1PAd; Z1PAd: if ($infos) { goto euM3R; } goto aj4dW; TysEG: euM3R: goto ouXel; ouXel: $orderNoNew = generateSequenceNo($customerId, Defs::APPOINT_ORDER_NO_SEQ_NUM_KEY, "\105"); goto eBbYx; tJy8T: } public function refreshOrderNoById($customerId, $id) { goto NGqvI; fcmG5: $orderNoNew = generateSequenceNo($customerId, Defs::APPOINT_ORDER_NO_SEQ_NUM_KEY, "\x45"); goto yoGGL; L8NH2: return $orderNoNew; goto c80lH; joA48: if ($infos) { goto hOT0F; } goto y2EYt; NGqvI: $infos = Db::table("\x65\170\160\x65\162\x74\137\x6f\162\x64\145\162")->where(["\151\144" => $id])->field(true)->find(); goto joA48; yoGGL: Db::table("\145\170\160\145\x72\x74\x5f\x6f\162\x64\x65\162")->where(["\x69\x64" => $id])->setField("\x6f\162\x64\145\x72\137\x6e\x6f", $orderNoNew); goto L8NH2; EwmPP: hOT0F: goto fcmG5; y2EYt: return false; goto EwmPP; c80lH: } public function getLinkmen($customerId) { $records = Db::table("\145\170\x70\145\162\x74\x5f\x6f\162\x64\x65\162")->distinct(true)->where(["\143\165\163\164\157\155\x65\162\137\151\x64" => $customerId])->field("\154\x69\156\153\x6d\x61\156\54\x20\143\x65\x6c\154\160\x68\x6f\x6e\x65")->order("\157\x72\144\145\162\137\x74\151\x6d\x65\40\144\x65\x73\x63")->select(); return $records; } public function finish($orderNo) { goto cxHuj; ZEG19: if (!empty($id)) { goto mdE9m; } goto x6xQY; rTKz3: $id = Db::table("\145\x78\x70\x65\x72\164\x5f\157\162\x64\145\x72")->where("\x6f\162\144\x65\162\x5f\156\x6f", $orderNo)->value("\151\x64"); goto ZEG19; wkF7j: return true; goto jE0nz; x6xQY: $id = 0; goto mzyw5; wd1yc: OperationLogsService::I()->orderLog("\351\xa2\204\347\272\xa6\xe8\256\xa2\xe5\x8d\225\345\256\x8c\346\x88\x90", "\350\xae\242\xe5\215\225\xe5\x8f\267\72\40" . $orderNo, OperationLogsService::OPT_UPDATE_TYPE, $id); goto wkF7j; mzyw5: mdE9m: goto wd1yc; cxHuj: Db::table("\x65\x78\x70\145\162\x74\x5f\157\x72\144\x65\x72")->where("\157\162\144\x65\162\137\x6e\157", $orderNo)->update(["\x66\x69\x6e\x69\x73\x68\x5f\164\151\155\145" => Db::raw("\x6e\157\x77\50\51"), "\x73\164\141\x74\165\x73" => IndexDefs::ORDER_FINISH_STATUS]); goto rTKz3; jE0nz: } public function cancel($orderNo) { goto wispP; flNnF: $id = Db::table("\x65\170\x70\x65\162\x74\x5f\157\162\x64\145\162")->where("\x6f\x72\144\145\x72\137\x6e\157", $orderNo)->value("\151\144"); goto x83CW; UD32r: $id = 0; goto xwQib; wispP: Db::table("\x65\170\160\145\x72\164\x5f\157\x72\144\x65\162")->where("\157\x72\144\145\x72\137\x6e\157", $orderNo)->update(["\163\x74\x61\164\x75\x73" => IndexDefs::ORDER_CANCELLED_STATUS]); goto flNnF; xwQib: aX0s9: goto ZiOj2; fTd4g: return true; goto kSnNF; ZiOj2: OperationLogsService::I()->orderLog("\351\242\204\347\xba\xa6\350\xae\xa2\345\215\x95\345\217\x96\xe6\xb6\210", "\xe8\xae\xa2\xe5\215\x95\345\217\xb7\72\40" . $orderNo, OperationLogsService::OPT_UPDATE_TYPE, $id); goto fTd4g; x83CW: if (!empty($id)) { goto aX0s9; } goto UD32r; kSnNF: } public function refund($orderNo) { goto ELDKT; ZmLx6: exception("\351\x80\x80\xe6\254\276\345\xa4\xb1\xe8\264\xa5\x3a\40" . var_export($result, true)); goto uM9zK; Z6pg6: wxPaySetting(); goto SYK5C; tuuMG: Log::notice("\351\242\x84\347\xba\xa6\351\x80\200\346\254\xbe\xe6\210\220\345\212\237\x3a\x20" . var_export($result, true)); goto f_szK; f_szK: Db::table("\x65\x78\160\x65\162\x74\x5f\157\x72\144\x65\x72")->where("\x6f\162\x64\145\162\137\x6e\157", $orderNo)->update(["\162\x65\146\165\x6e\144\137\157\x72\144\x65\162\137\x6e\157" => $refundOrderNo, "\162\145\x66\x75\156\144\x5f\141\155\157\x75\156\164" => $orderAmount, "\162\x65\x66\x75\156\144\137\164\151\155\x65" => date("\131\55\x6d\55\x64\x20\110\72\151\x3a\163"), "\160\x61\171\137\163\x74\141\164\x75\x73" => Defs::PAY_REFUND]); goto Xxh1f; JqKCw: OperationLogsService::I()->orderLog("\xe9\242\204\xe7\272\246\350\256\242\xe5\x8d\x95\xe9\x80\x80\xe6\254\276", "\xe8\256\242\345\215\x95\xe5\217\xb7\x3a\x20" . $orderNo, OperationLogsService::OPT_UPDATE_TYPE, $id); goto Kmxcw; BmtBr: if (!empty($order)) { goto q2AUg; } goto LPFWA; Kmxcw: return true; goto lK5yK; uM9zK: Vc1e6: goto tuuMG; OnpvT: if (!empty($id)) { goto Wc3DZ; } goto SoDxG; ELDKT: exception("\345\212\x9f\xe8\203\xbd\347\xa6\201\xe7\x94\250"); goto zZEH9; OPMha: logEvent("\345\222\xa8\xe8\xaf\242\351\242\204\347\272\246\350\256\xa2\xe5\x8d\225{$orderNo}\xe9\x80\x80\xe6\254\xbe\xe5\244\xb1\350\264\245", EventLogsService::eSeverityWarning); goto ZmLx6; ba1Aw: $orderAmount = $order["\157\x72\144\x65\x72\137\141\x6d\157\x75\156\164"]; goto Z6pg6; EXKEi: Wc3DZ: goto JqKCw; SYK5C: $app = Factory::payment(config("\x77\170\56\160\141\x79\x6d\x65\156\x74")); goto Kzh9P; LPFWA: exception("\346\227\xa0\xe6\xb3\225\346\x89\276\345\x88\xb0\350\xaf\xa5\350\256\242\345\215\x95"); goto SxNhR; Kzh9P: $refundOrderNo = generateSequenceNo($order["\143\x75\x73\x74\157\x6d\145\x72\x5f\x69\144"], Defs::APPOINT_ORDER_REFUND_NO_SEQ_NUM_KEY, "\105\x52"); goto PWx8F; zZEH9: $order = Db::table("\x65\170\160\145\x72\164\x5f\157\162\x64\x65\162")->where("\157\162\x64\145\x72\137\156\x6f", $orderNo)->field(true)->find(); goto BmtBr; SoDxG: $id = 0; goto EXKEi; SxNhR: q2AUg: goto ba1Aw; PWx8F: $result = $app->refund->byOutTradeNumber($orderNo, $refundOrderNo, $orderAmount * 100, $orderAmount * 100); goto KOio2; Xxh1f: $id = $order["\151\x64"]; goto OnpvT; KOio2: if (!empty($result)) { goto Vc1e6; } goto OPMha; lK5yK: } public function changeTime($orderNo, $appointDate, $appointTime) { goto kSAih; kSAih: Db::table("\145\170\160\145\x72\x74\x5f\x6f\162\x64\145\162")->where("\x6f\162\x64\145\x72\x5f\156\157", $orderNo)->update(["\141\160\160\x6f\151\x6e\x74\137\144\141\164\x65" => $appointDate, "\x61\x70\160\157\x69\156\164\137\164\x69\x6d\145" => $appointTime]); goto JTH3a; RO3j0: ICoJK: goto ZP_VF; ZP_VF: OperationLogsService::I()->orderLog("\351\xa2\204\xe7\xba\246\xe8\xae\242\xe5\215\x95\xe6\x9b\xb4\346\224\xb9\xe6\227\266\351\x97\264", "\xe8\256\xa2\xe5\215\x95\345\217\xb7\72\x20{$orderNo}\40\xe6\x9b\xb4\346\226\xb0\345\x90\216\x20{$appointDate}\40{$appointTime}", OperationLogsService::OPT_UPDATE_TYPE, $id); goto X2wtT; JTH3a: $id = Db::table("\145\170\x70\145\162\164\x5f\x6f\162\x64\x65\x72")->where("\157\162\144\x65\x72\x5f\x6e\157", $orderNo)->value("\x69\144"); goto fGhox; fGhox: if (!empty($id)) { goto ICoJK; } goto Trwyj; X2wtT: return true; goto o_mSt; Trwyj: $id = 0; goto RO3j0; o_mSt: } public function generateOrder($customerId, $expertId, $orderAmount, $appointDate, $appointTime, $appointDuration, $appointMode, $payStatus) { goto QjwRM; CD2EB: if ($existOrder) { goto L8jrB; } goto hMlTa; Xvjn3: MWH3M: goto bs3sS; QjwRM: $existOrder = Db::table("\x65\170\x70\x65\162\164\137\157\162\144\x65\162")->where(["\143\165\163\164\157\x6d\x65\162\x5f\x69\144" => $customerId, "\x65\170\160\145\162\164\137\151\144" => $expertId, "\141\160\160\x6f\151\156\164\x5f\144\x61\164\145" => $appointDate, "\x61\x70\160\x6f\x69\156\164\137\x74\151\155\145" => $appointTime])->find(); goto CD2EB; hMlTa: $orderNo = generateSequenceNo($customerId, Defs::APPOINT_ORDER_NO_SEQ_NUM_KEY, "\x45"); goto ZmN3w; ysrPw: L8jrB: goto BZQ6I; bs3sS: return $orderNo; goto XFP9S; O9lrq: Db::table("\145\170\x70\x65\x72\164\x5f\x6f\162\x64\145\162")->where(["\x6f\162\144\x65\162\x5f\x6e\157" => $orderNo])->update(["\157\162\x64\x65\x72\137\x61\x6d\x6f\165\156\164" => $orderAmount, "\157\162\x64\145\x72\137\x74\151\x6d\145" => date("\131\x2d\155\55\144\40\110\x3a\x69\x3a\163"), "\x61\160\x70\157\151\x6e\x74\137\144\x75\162\141\164\151\157\x6e" => $appointDuration, "\141\x70\x70\157\x69\156\164\137\155\157\144\145" => $appointMode]); goto Xvjn3; ZmN3w: Db::table("\x65\x78\160\145\x72\x74\137\x6f\x72\x64\x65\x72")->insert(["\157\x72\144\145\162\x5f\156\x6f" => $orderNo, "\143\x75\x73\164\x6f\155\145\162\x5f\151\144" => $customerId, "\145\170\x70\x65\x72\164\137\151\144" => $expertId, "\157\162\144\145\x72\x5f\141\x6d\x6f\165\x6e\x74" => $orderAmount, "\x6f\x72\x64\x65\162\x5f\164\151\x6d\145" => date("\x59\55\x6d\x2d\x64\40\110\72\x69\x3a\163"), "\141\160\160\x6f\x69\x6e\164\137\x64\x61\164\145" => $appointDate, "\141\x70\x70\157\x69\x6e\x74\137\x74\x69\155\145" => $appointTime, "\141\160\x70\157\x69\x6e\x74\137\144\165\162\141\x74\x69\157\x6e" => $appointDuration, "\x61\x70\160\x6f\151\156\164\x5f\155\x6f\144\145" => $appointMode, "\163\x74\141\164\165\x73" => IndexDefs::ORDER_PENDING_STATUS, "\x70\x61\x79\x5f\x73\164\x61\x74\165\163" => $payStatus]); goto Khkt1; BZQ6I: $orderNo = $existOrder["\157\162\144\145\162\x5f\x6e\x6f"]; goto O9lrq; Khkt1: goto MWH3M; goto ysrPw; XFP9S: } public function getOrders($customerId, $status = 0) { goto JaX5L; hUjYm: jKm7P: goto VrASN; AiOWT: if (!$status) { goto jKm7P; } goto mpU3k; tbE3J: G2ATw: goto axdWS; tG1J1: foreach ($records as &$record) { $record["\x73\x74\141\x74\x75\163\137\164\x65\170\x74"] = IndexDefs::$orderStatusDefs[$record["\163\x74\x61\164\x75\x73"]]; v14ZY: } goto tbE3J; mpU3k: $conditions["\x45\x4f\x2e\163\164\x61\164\x75\163"] = $status; goto hUjYm; JaX5L: $conditions = ["\105\x4f\56\143\165\x73\164\x6f\x6d\x65\x72\137\x69\144" => $customerId]; goto AiOWT; axdWS: return $records; goto F2ARD; VrASN: $records = Db::table("\x65\170\x70\145\162\x74\137\157\x72\144\145\162")->alias("\x45\x4f")->join("\x65\170\160\145\162\164\x20\x45", "\x45\117\x2e\145\x78\160\x65\x72\164\137\x69\144\75\105\56\151\144")->where($conditions)->field("\x45\x4f\x2e\x2a\54\40\105\x2e\x72\x65\x61\154\x5f\156\141\x6d\145\x20\141\163\40\x65\x78\160\x65\162\164\137\x6e\141\x6d\145\x2c\x20\105\x2e\167\157\162\x6b\x69\155\147\137\165\162\x6c\54\40\x45\56\x63\145\154\154\x70\150\x6f\x6e\145\x20\x61\163\x20\x65\170\x70\x65\162\164\x5f\143\145\154\x6c\160\x68\x6f\x6e\145\54\40\143\x6f\x6e\143\141\x74\x28\x45\x4f\56\x61\160\160\157\x69\x6e\164\137\144\x61\x74\x65\54\40\47\x20\x27\54\40\105\117\56\x61\x70\x70\157\x69\x6e\x74\x5f\x74\x69\155\145\x2c\40\x27\50\x27\54\x20\105\117\x2e\x61\160\x70\157\151\x6e\x74\137\x64\x75\x72\x61\x74\151\157\156\54\40\47\x29\47\51\x20\x61\163\x20\x61\160\160\157\x69\x6e\164\x5f\x64\141\x74\145\x5f\x74\151\x6d\x65")->order("\x45\x4f\x2e\157\x72\144\145\162\137\164\x69\155\145\40\x64\x65\163\143")->select(); goto tG1J1; F2ARD: } public function cancelOrder($id) { Db::table("\145\170\x70\145\x72\x74\x5f\x6f\162\x64\x65\162")->where("\x69\144", $id)->update(["\163\x74\141\164\x75\x73" => IndexDefs::ORDER_CANCELLED_STATUS]); return true; } }
