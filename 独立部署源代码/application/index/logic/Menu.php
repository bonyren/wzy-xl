<?php
 namespace app\index\logic; use think\Db; use think\Log; use app\index\service\RequestContext; class Menu extends Base { public function getRow($id) { $row = Db::table("\x6d\x65\x6e\165")->where("\151\144", $id)->field(true)->find(); return $row; } public function getDefaultRow() { return ["\156\141\155\x65" => '', "\154\x65\166\145\x6c" => 1, "\x70\151\x64" => 0, "\143" => '', "\141" => '', "\160\141\162\141\155\163" => '', "\151\143\x6f\x6e\137\143\x6c\x73" => '', "\x6f\x72\144\x65\x72\x5f\151\144" => 0]; } public function save($id, $data) { goto Li5kJ; xaFnQ: if (!empty($data["\156\141\x6d\145"])) { goto HlWQU; } goto E2xTx; y38KH: NmAvx: goto Ta5Zv; Ta5Zv: $data["\156\x61\155\x65"] = trim($data["\156\x61\x6d\x65"]); goto xaFnQ; Li5kJ: $data["\160\x69\144"] = intval($data["\x70\151\144"]); goto fYmku; n5bsG: if (!(isset($data["\156\x61\155\x65"]) && empty($data["\156\141\155\x65"]))) { goto wK4wb; } goto Esv9j; nrNfk: HlWQU: goto NKYtt; fYmku: if (empty($id)) { goto NmAvx; } goto n5bsG; LRQx7: Db::table("\155\145\x6e\x75")->where("\x69\x64", $id)->update($data); goto KeCs5; EsImq: UtIjm: goto xiReS; Esv9j: exception("\345\220\x8d\xe7\xa7\260\xe4\xb8\x8d\xe8\203\xbd\344\xb8\xba\347\251\xba"); goto mlc5m; KeCs5: goto UtIjm; goto y38KH; E2xTx: exception("\345\x90\215\xe7\247\260\344\270\x8d\xe8\203\xbd\344\270\272\347\xa9\xba"); goto nrNfk; NKYtt: $id = Db::table("\x6d\145\x6e\x75")->insert($data, false, true); goto EsImq; mlc5m: wK4wb: goto LRQx7; xiReS: return $id; goto xJPcu; xJPcu: } public function delete($id) { goto FBni8; dQhp7: exception("\xe8\xaf\245\350\217\234\345\x8d\x95\345\xad\230\345\x9c\250\345\xad\x90\350\x8f\234\345\215\225\xef\xbc\214\xe6\x97\xa0\xe6\xb3\225\347\x9b\xb4\xe6\x8e\xa5\xe5\210\xa0\351\x99\244"); goto elIaH; YaBPR: $result = Db::table("\155\145\156\165")->where("\x69\x64", $id)->delete(); goto pKiuu; pKiuu: Db::table("\x61\x64\155\151\x6e\137\x72\x6f\154\x65\137\155\145\x6e\x75")->where("\155\x65\x6e\165\x5f\151\144", $id)->delete(); goto venoE; hW0Lv: if (empty($child)) { goto nvAjH; } goto dQhp7; elIaH: nvAjH: goto YaBPR; venoE: return $result; goto AxKhH; FBni8: $child = Db::table("\155\145\156\165")->where("\160\151\x64", $id)->limit(1)->find(); goto hW0Lv; AxKhH: } public function loadLeftMenuRecursively($pid, $ptext, &$nodes, $loadAll = false, $roleId = null) { goto YGwZ_; BgmZo: return; goto rGkLA; YGwZ_: $conditions = ["\160\x69\x64" => $pid]; goto deFw7; EtoDq: foreach ($rows as $key => $value) { goto gt1k9; CIM7p: $node["\x74\145\170\x74"] = $value["\156\141\155\x65"]; goto LG1Eo; rqDkI: $node["\165\162\x6c"] = url($value["\x63"] . "\x2f" . $value["\x61"], $params); goto dWAP9; vo1pv: if (!$value["\x70\x61\x72\141\x6d\163"]) { goto KNcUh; } goto rrhSi; Zo2No: $node["\160\x61\162\x61\155\x73"] = $value["\160\x61\x72\x61\155\163"]; goto p2lfY; kQTK4: if (empty($subNodes)) { goto dLdyl; } goto izv_n; I6jKa: $this->loadLeftMenuRecursively($id, $breadcrumb, $subNodes, $loadAll, $roleId); goto kQTK4; hlmRV: if (!(!empty($value["\x63"]) && !empty($value["\x61"]))) { goto Zi44b; } goto f_mHF; LG1Eo: $node["\x63"] = $value["\x63"]; goto TeYRD; PLFh6: $node = array(); goto O4R92; TeYRD: $node["\141"] = $value["\x61"]; goto Zo2No; aIgeG: goto QXo9l; goto EUXQG; fyloK: $node["\x69\143\x6f\x6e\103\154\x73"] = $value["\x69\x63\x6f\x6e\137\143\154\163"]; goto NQRRb; LCUiI: $breadcrumb = empty($ptext) ? $value["\x6e\x61\155\145"] : $ptext . "\x20\x26\x67\x74\73\40" . $value["\x6e\141\155\145"]; goto Ps3mC; U498R: KNcUh: goto rqDkI; NQRRb: $subNodes = array(); goto I6jKa; K0i3w: $node["\156\x61\155\x65"] = $value["\x6e\x61\155\145"]; goto CIM7p; Ps3mC: $node["\141\x74\x74\162\151\x62\165\x74\x65\x73"] = ["\x62\x72\x65\141\144\143\x72\165\x6d\x62" => $breadcrumb]; goto hlmRV; rrhSi: $params .= "\x26"; goto JIz2k; p2lfY: $node["\157\x72\144\x65\162\x5f\151\x64"] = $value["\x6f\162\x64\145\x72\x5f\151\144"]; goto LCUiI; gt1k9: $id = $value["\151\144"]; goto Bph9v; izv_n: $node["\143\150\x69\154\x64\162\145\x6e"] = $subNodes; goto ZJdEw; f_mHF: $params = "\x6c\145\146\164\x4d\x65\x6e\165\111\144\x3d{$id}"; goto vo1pv; Bph9v: if (!(!$loadAll && !$this->checkIfSelectedRecursively($id, $roleId))) { goto QCHYy; } goto aIgeG; HoePZ: QXo9l: goto GUm4t; cSDwa: $nodes[] = $node; goto HoePZ; JIz2k: $params .= $value["\160\x61\x72\141\x6d\163"]; goto U498R; ZJdEw: dLdyl: goto cSDwa; EUXQG: QCHYy: goto PLFh6; dWAP9: Zi44b: goto fyloK; O4R92: $node["\x69\144"] = $id; goto K0i3w; GUm4t: } goto H47vO; DrByZ: return; goto ygXUb; ygXUb: Y8loD: goto EtoDq; H47vO: EWMKq: goto BgmZo; UbDwo: if (!empty($rows)) { goto Y8loD; } goto DrByZ; deFw7: $rows = Db::table("\x6d\x65\156\x75")->where($conditions)->field("\151\144\54\160\x69\144\54\x6c\145\166\145\154\x2c\x6e\141\155\x65\54\151\143\x6f\156\x5f\143\154\x73\54\143\54\141\54\160\141\x72\x61\155\x73\x2c\157\162\144\x65\162\137\x69\x64")->order("\x6f\162\x64\x65\x72\137\151\x64\40\x41\123\103")->select(); goto UbDwo; rGkLA: } protected function checkIfSelectedRecursively($id, $roleId) { goto LERWj; mXacN: if (!$roleMenu) { goto Rs3Qn; } goto ZxNJd; uroCi: return false; goto YlVXE; LERWj: $roleMenu = Db::table("\x61\x64\x6d\x69\156\137\162\x6f\154\x65\x5f\155\x65\x6e\165")->where(array("\x72\x6f\x6c\x65\137\151\x64" => $roleId, "\x6d\145\x6e\165\x5f\x69\144" => $id))->find(); goto mXacN; MbHCL: $subIds = Db::table("\155\x65\x6e\x75")->where(array("\160\x69\x64" => $id))->field("\x69\x64")->select(); goto t0XRr; e5Pwa: foreach ($subIds as $key => $value) { goto Ys9Gq; AK7uQ: $result = $this->checkIfSelectedRecursively($subId, $roleId); goto bpa_a; nnCe9: am0DY: goto nLakm; kU2Jr: lcHuI: goto nnCe9; Ys9Gq: $subId = $value["\x69\x64"]; goto AK7uQ; KJF8c: return true; goto kU2Jr; bpa_a: if (!$result) { goto lcHuI; } goto KJF8c; nLakm: } goto vj_Ve; t0XRr: if (!empty($subIds)) { goto x0X6c; } goto G9EyN; ZxNJd: return true; goto m8TT3; TtP9e: x0X6c: goto e5Pwa; m8TT3: Rs3Qn: goto MbHCL; vj_Ve: zpQND: goto uroCi; G9EyN: return false; goto TtP9e; YlVXE: } public function wxLoadMenus() { goto PTrE5; HbnrD: if (!empty($rows)) { goto gD3Y3; } goto lCJug; flgSa: return array_values($rows); goto umOJ0; W3B1y: gD3Y3: goto owL17; bBhlD: bUYC6: goto flgSa; lCJug: $rows = []; goto W3B1y; owL17: foreach ($rows as $id => $v) { goto MqWYR; MqWYR: $rows[$id]["\151\x63\x6f\156\x43\x6c\163"] = "\146\x61\40\x66\141\x20\x66\141\55\143\x69\x72\x63\154\x65"; goto uDMVR; uDMVR: if (!empty($rows[$id]["\x70\x69\x64"])) { goto UYpce; } goto VgkGx; xqbjD: UYpce: goto UJCUA; Fb_1j: unset($rows[$id]); goto xWAqC; xWAqC: qFTSo: goto z7_3o; UJCUA: $rows[$v["\160\x69\144"]]["\143\150\x69\154\x64\x72\x65\156"][] = $rows[$id]; goto Fb_1j; VgkGx: goto qFTSo; goto xqbjD; z7_3o: } goto bBhlD; PTrE5: $rows = Db::table("\x77\170\x5f\x6d\x65\x6e\165\163")->order("\160\151\144\40\144\145\163\143\54\163\x6f\162\164\x20\141\x73\x63\x2c\x69\144\x20\x61\x73\143")->column("\x69\x64\x2c\160\151\144\54\x73\x6f\162\164\x2c\x6e\141\155\145\x2c\x74\x79\160\x65\54\153\x65\171\x2c\x75\162\154\x2c\x61\x70\160\151\144\54\x70\x61\x67\145\160\141\x74\150"); goto HbnrD; umOJ0: } public function wxMenuSave($id, $pid, $formData) { goto Q0_Pg; zH7gK: $count = Db::table("\x77\170\x5f\x6d\145\156\x75\x73")->where(["\x70\151\144" => ["\x67\x74", 0]])->count(); goto iFj7w; VGC2p: if (empty($data["\160\151\144"])) { goto E2euY; } goto qlE06; k8ObI: goto YiUWc; goto Z2uVy; nEo_M: Ka7u9: goto W6rcW; rvncR: Db::table("\167\170\137\155\145\156\x75\x73")->where(["\151\x64" => $id])->update($formData); goto OwyAX; j5kvW: $max = 3; goto EN6DL; OiXh8: $type = "\xe4\272\214\347\xba\247\xe8\x8f\234\xe5\x8d\x95"; goto zH7gK; EN6DL: $type = "\344\xb8\200\347\xba\xa7\xe8\x8f\x9c\345\x8d\x95"; goto Vl3jF; Z2uVy: tRec1: goto rvncR; mnPj3: wexception("\346\x9c\200\xe5\xa4\x9a\xe6\267\xbb\345\212\xa0{$max}\344\xb8\252{$type}"); goto nEo_M; OwyAX: YiUWc: goto l982v; Q0_Pg: if ($id) { goto tRec1; } goto VGC2p; W6rcW: $id = Db::table("\167\x78\137\155\145\156\165\163")->insertGetId($formData); goto k8ObI; qlE06: $max = 5; goto OiXh8; gjCJQ: ValFQ: goto jE__m; jE__m: if (!($count == $max)) { goto Ka7u9; } goto mnPj3; Vl3jF: $count = Db::table("\x77\x78\x5f\155\145\x6e\x75\x73")->where(["\x70\x69\x64" => 0])->count(); goto gjCJQ; iFj7w: goto ValFQ; goto oqtI9; oqtI9: E2euY: goto j5kvW; l982v: } public function wxMenuSync() { goto OeeLt; uAe1u: T8KXV: goto kgKsM; ILPrL: try { goto nVx0y; zlXTz: return $res; goto fj3hJ; jFAI6: $res = $app->menu->create($rows); goto zlXTz; nVx0y: $app = \EasyWeChat\Factory::officialAccount(config("\167\170\x2e\x6f\146\x66\151\x63\x69\141\x6c\x5f\141\x63\x63\x6f\x75\156\x74")); goto jFAI6; fj3hJ: } catch (\Exception $e) { wexception("\xe5\x90\x8c\346\xad\xa5\345\xa4\261\xe8\xb4\xa5\xef\xbc\x9a" . $e->getMessage()); } goto h3Znt; OeeLt: if (systemSetting("\x57\130\137\117\106\106\111\103\x45\137\x41\103\103\117\x55\x4e\x54\x5f\x41\x50\120\x5f\x49\x44")) { goto wz6g_; } goto ySuBS; sf1cM: if (!empty($rows)) { goto T8KXV; } goto uhTeC; zZu0C: $rows = Db::table("\167\170\x5f\155\145\156\165\x73")->order("\160\151\144\x20\x44\105\123\x43\54\x73\x6f\x72\x74\40\101\x53\103\x2c\151\x64\x20\x41\x53\x43")->column("\151\144\x2c\x70\x69\144\54\156\141\x6d\145\54\x74\171\x70\145\x2c\153\x65\171\x2c\165\x72\154\54\x61\160\160\x69\x64\54\160\141\x67\145\160\x61\x74\150"); goto sf1cM; iTLVa: xGIcA: goto aU5dE; kgKsM: foreach ($rows as $id => $v) { goto hwnb5; XITt3: if ($pid) { goto ZB8up; } goto y2iQT; EJxRr: lG9D0: goto is1Rs; U_8RF: $menu["\163\165\142\137\142\x75\x74\164\157\x6e"] = $rows[$id]["\x73\x75\x62\137\142\165\164\164\157\156"]; goto kgDnq; kgDnq: erngj: goto joGvP; joGvP: $rows[$id] = $menu; goto C6tnA; M0LmV: unset($rows[$id]); goto N_9ye; J5444: Pdk7U: goto W_F11; is1Rs: $pid = $v["\160\151\144"]; goto XITt3; C6tnA: goto RfgKz; goto XQE4j; fkGRy: switch ($v["\164\171\x70\x65"]) { case "\166\x69\x65\x77": goto g0vxD; g0vxD: $menu["\x74\171\160\145"] = $v["\x74\x79\x70\145"]; goto zw8jp; av6JP: goto lG9D0; goto p4A3Z; zw8jp: $menu["\165\x72\x6c"] = $v["\165\162\154"]; goto av6JP; p4A3Z: case "\x6d\x69\156\x69\160\162\157\147\162\141\155": goto pzzgn; ZOM5y: goto lG9D0; goto H14Mg; Kv30T: $menu["\x75\162\154"] = $v["\x75\162\154"]; goto mnnj5; mnnj5: $menu["\x61\x70\x70\x69\144"] = $v["\141\x70\160\151\144"]; goto AyH5M; pzzgn: $menu["\x74\171\x70\x65"] = $v["\164\x79\160\x65"]; goto Kv30T; AyH5M: $menu["\x70\141\147\x65\160\141\164\150"] = $v["\x70\x61\147\145\x70\x61\164\150"]; goto ZOM5y; H14Mg: case "\x63\154\151\x63\153": goto vmNPW; vmNPW: $menu["\x74\x79\160\145"] = $v["\164\171\x70\x65"]; goto rFG4G; rFG4G: $menu["\x6b\145\171"] = $v["\153\x65\x79"]; goto EI_pL; EI_pL: goto lG9D0; goto ZRUjr; ZRUjr: } goto yxKCM; W_F11: $rows[$pid]["\x73\x75\x62\137\142\x75\x74\x74\x6f\156"][] = $menu; goto M0LmV; N_9ye: RfgKz: goto SVScf; hwnb5: $menu = ["\x6e\x61\x6d\x65" => $v["\156\141\155\145"]]; goto fkGRy; W7jLZ: $rows[$pid]["\163\x75\x62\137\142\165\x74\164\157\156"] = []; goto J5444; y2iQT: if (!(isset($rows[$id]["\x73\165\x62\137\x62\165\164\x74\x6f\156"]) && $rows[$id]["\163\x75\x62\x5f\x62\165\x74\164\x6f\156"])) { goto erngj; } goto U_8RF; XQE4j: ZB8up: goto zOxpo; zOxpo: if (isset($rows[$pid]["\x73\x75\142\137\142\x75\x74\x74\x6f\x6e"])) { goto Pdk7U; } goto W7jLZ; SVScf: PTbJ5: goto f1nYB; yxKCM: Cr6E1: goto EJxRr; f1nYB: } goto iTLVa; muKUR: Log::notice("\167\170\40\x63\157\156\x66\151\x67\x3a\40" . var_export(config("\167\170\56\157\x66\x66\151\x63\151\x61\154\137\141\x63\143\157\x75\156\164"), true)); goto ILPrL; IxqZM: wz6g_: goto zZu0C; ySuBS: wexception("\345\220\x8c\346\xad\xa5\345\xa4\xb1\350\264\xa5\357\xbc\x9a\xe6\x9c\xaa\351\205\215\347\xbd\256\345\205\254\344\xbc\227\345\x8f\xb7\345\x8f\x82\xe6\x95\xb0"); goto IxqZM; aU5dE: $rows = array_values($rows); goto muKUR; uhTeC: wexception("\xe6\x97\240\xe8\xa6\x81\xe5\220\x8c\346\255\245\347\x9a\204\xe8\x8f\x9c\xe5\x8d\225\xe6\x95\260\346\x8d\256"); goto uAe1u; h3Znt: } }
