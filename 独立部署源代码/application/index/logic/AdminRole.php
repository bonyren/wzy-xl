<?php
 namespace app\index\logic; use app\index\model\AdminRole as AdminRoleModel; use think\Log; use think\Db; use app\index\service\RequestContext; use app\index\logic\Defs as IndexDefs; use app\index\service\OperationLogs; class AdminRole extends Base { public function load($search = array(), $page = 1, $rows = DEFAULT_PAGE_ROWS, $sort = '', $order = '') { goto cWksC; aJ6Kk: QzpGu: goto voela; cszY6: $conditions = []; goto n3Ut_; voela: $totalCount = Db::table("\x61\144\x6d\151\x6e\x5f\x72\157\154\145")->where($conditions)->count(); goto ncchd; SbUwJ: foreach ($records as &$record) { $record["\x70\162\151\166\151\x6c\145\147\145\163"] = $this->getAuthText($record["\x72\157\154\145\137\151\x64"]); bE2b_: } goto Fozxz; e7BG8: UMaN2: goto JG59I; ncchd: $records = Db::table("\141\144\x6d\x69\156\137\x72\157\154\x65")->where($conditions)->page($page, $rows)->order($order)->field(true)->select(); goto SbUwJ; yg4GL: goto q6Ykc; goto e7BG8; cWksC: if ($sort == "\x72\157\154\145\x5f\151\144") { goto UMaN2; } goto zS86I; JG59I: $order = "\x72\157\x6c\x65\137\151\144\x20" . $order; goto cD5Bn; cD5Bn: q6Ykc: goto cszY6; Fozxz: RGH5f: goto pH2mb; zS86I: $order = "\162\x6f\154\145\137\151\x64\40\x61\163\x63"; goto yg4GL; n3Ut_: if (emptyInArray($search, "\162\x6f\154\145\137\x6e\x61\x6d\145")) { goto QzpGu; } goto YRSEA; pH2mb: return ["\x74\x6f\164\x61\x6c" => $totalCount, "\x72\157\167\163" => $records]; goto yXoQb; YRSEA: $conditions["\162\157\x6c\x65\137\156\141\x6d\145"] = ["\154\x69\153\145", "\45" . $search["\x72\157\x6c\x65\x5f\x6e\x61\155\x65"] . "\x25"]; goto aJ6Kk; yXoQb: } public function save($roleId, $infos) { goto IQf0n; CMT6o: $adminsRoleTable = "\x61\x64\x6d\151\x6e\x5f\x72\157\154\x65"; goto VrQBC; ATrxn: $model = new AdminRoleModel(); goto YbmIm; lXKf5: OperationLogs::I()->systemLog("\xe4\277\256\xe6\x94\xb9\347\256\xa1\347\220\x86\xe5\221\230\xe8\xa7\x92\350\211\xb2", beautifyLogArray($infos, [], $adminsRoleTable), OperationLogs::OPT_UPDATE_TYPE, $roleId); goto mKCWw; RKDeB: mSTP2: goto B3q9K; FsJ3a: if (!$result) { goto cGwcL; } goto lXKf5; Qr1E1: $result = $model->allowField(true)->save($infos); goto FsJ3a; mKCWw: cGwcL: goto K1uOg; K1uOg: goto mSTP2; goto yr3Hn; sistI: $model->allowField(true)->save(); goto dR2Vp; dR2Vp: OperationLogs::I()->systemLog("\346\226\260\345\242\236\347\256\241\347\x90\x86\xe5\x91\230\350\xa7\x92\xe8\x89\xb2", beautifyLogArray($infos, [], $adminsRoleTable), OperationLogs::OPT_ADD_TYPE, $model->role_id); goto RKDeB; WK2p9: $model->data($infos); goto sistI; YbmIm: $adminsRoleTable = "\141\144\x6d\151\156\137\x72\x6f\x6c\145"; goto WK2p9; fV118: exception("\346\x97\xa0\xe6\xb3\x95\xe6\211\276\345\x88\260\350\257\xa5\xe8\247\222\xe8\211\xb2"); goto iigV1; iigV1: hfg9D: goto Qr1E1; VrQBC: if ($model) { goto hfg9D; } goto fV118; yr3Hn: LII5J: goto ATrxn; u4BH1: $model = AdminRoleModel::get($roleId); goto CMT6o; IQf0n: if (!$roleId) { goto LII5J; } goto u4BH1; B3q9K: } public function delete($roleId) { goto FZNYr; sl5mq: Db::table("\x61\144\155\151\x6e\x73")->where("\x72\157\x6c\x65\137\x69\144", $roleId)->setField("\x72\157\x6c\145\x5f\151\144", 0); goto LSWI_; cNDnB: exception("\346\227\xa0\346\263\225\xe6\211\276\xe5\210\xb0\xe8\257\245\xe8\247\x92\350\x89\262"); goto PvGRO; rTH7K: if ($model) { goto WTZ60; } goto cNDnB; FZNYr: $model = AdminRoleModel::get($roleId); goto rTH7K; LSWI_: Db::table("\141\x64\x6d\x69\x6e\x5f\x72\x6f\154\145\137\x6d\x65\x6e\165")->where("\x72\157\x6c\x65\137\151\144", $roleId)->delete(); goto JWXOl; JWXOl: OperationLogs::I()->systemLog("\345\210\xa0\xe9\x99\xa4\347\xae\xa1\xe7\220\206\345\x91\x98\xe8\xa7\x92\350\211\262", $model->role_name, OperationLogs::OPT_DELETE_TYPE, $roleId); goto Sw8i9; PvGRO: WTZ60: goto pPcxu; pPcxu: AdminRoleModel::destroy($roleId); goto sl5mq; Sw8i9: } public function get($roleId) { goto nNmTh; nNmTh: $record = Db::table("\x61\144\x6d\151\156\x5f\162\x6f\154\145")->where("\162\157\x6c\x65\137\x69\144", $roleId)->field(true)->find(); goto zFWu5; IKIW4: return $record; goto Ynjzn; he23P: GuDA6: goto IKIW4; odZBu: return null; goto he23P; zFWu5: if ($record) { goto GuDA6; } goto odZBu; Ynjzn: } public function getDefault() { return ["\162\x6f\x6c\145\x5f\x6e\141\155\145" => '', "\144\145\163\x63\162\x69\160\x74\151\157\156" => '']; } protected function getAuthText($roleId) { goto InsLO; VDK30: $menuTable = "\x6d\145\x6e\165"; goto H746O; GpzNT: $rows = Db::table($adminRoleMenuTable)->where(array("\x72\157\154\x65\x5f\x69\x64" => $roleId))->field("\x6d\x65\156\x75\137\x69\x64\x2c\40\164\x79\160\145")->select(); goto iXzxu; H746O: $adminRoleMenuTable = "\141\144\155\x69\x6e\137\x72\x6f\154\x65\x5f\x6d\145\x6e\165"; goto GpzNT; KC3M7: k3oyY: goto P9exx; InsLO: $texts = []; goto VDK30; P9exx: return implode("\x3b\40", $texts); goto DEXdq; iXzxu: foreach ($rows as $row) { goto KU0xf; gxJxA: JAva1: goto X7iAY; RAUPm: $menu = Db::table($menuTable)->where(array("\151\x64" => $menuId))->field("\151\144\54\x20\x70\151\144\54\40\156\141\x6d\145")->find(); goto IJwLH; N57_O: if (!$text) { goto rfo_T; } goto OheFJ; f7QfS: $pid = $menu["\160\151\x64"]; goto c80LT; KU0xf: $text = ''; goto c3I1r; UDHB5: goto N_VSC; goto ndo9s; kXv_D: yZdkP: goto coRFe; Bzpcu: N_VSC: goto hHg6D; EyJhm: $menuName = $menu["\156\141\x6d\x65"]; goto gMsxQ; OheFJ: $texts[] = $text; goto ivTqy; coRFe: $menuName = $menu["\x6e\x61\155\x65"]; goto f7QfS; ivTqy: rfo_T: goto gxJxA; D5qkD: $text = "\74\x73\164\x72\157\156\147\x20\x63\154\x61\x73\163\x3d\42\x74\145\x78\164\55\163\x65\x63\157\156\x64\141\162\171\40\146\157\156\164\55\151\x74\x61\x6c\x69\143\42\x3e" . $menuName . "\x28" . IndexDefs::AUTHORIZE_TYPE_DEFS[$type] . "\51\x3c\x2f\163\164\x72\x6f\156\147\x3e"; goto Bzpcu; gMsxQ: $pid = $menu["\x70\x69\x64"]; goto D5qkD; ndo9s: L6NeP: goto N57_O; c80LT: $text = $menuName . "\x3e" . $text; goto UDHB5; LdzCd: if (!empty($menu)) { goto yZdkP; } goto D1TUW; wTr4s: uvOoT: goto EyJhm; am9b7: $menu = Db::table($menuTable)->where(array("\x69\x64" => $pid))->field("\151\144\54\x20\160\151\x64\54\x20\156\141\x6d\145")->find(); goto LdzCd; IJwLH: if (!empty($menu)) { goto uvOoT; } goto vxv4l; hHg6D: if (!$pid) { goto L6NeP; } goto am9b7; c3I1r: $menuId = $row["\x6d\x65\x6e\x75\137\x69\144"]; goto X_zRR; D1TUW: goto L6NeP; goto kXv_D; X_zRR: $type = $row["\164\171\160\145"]; goto RAUPm; vxv4l: goto JAva1; goto wTr4s; X7iAY: } goto KC3M7; DEXdq: } }
