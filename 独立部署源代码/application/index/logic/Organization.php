<?php
 namespace app\index\logic; use think\Db; use think\Log; use app\Defs; use app\index\service\RequestContext; class Organization extends Base { public function loadTreeDatas() { goto CQAIA; fsTWm: $treeDatas[] = $this->loadTreeDataRecursively(0); goto tyVyD; tyVyD: return $treeDatas; goto HcsCi; CQAIA: $treeDatas = []; goto fsTWm; HcsCi: } protected function loadTreeDataRecursively($id = 0, $parentId = 0, $breadcrumbParent = '') { goto y9lhP; bJO99: $treeNodeDatas = ["\151\x64" => $id, "\x70\141\162\x65\x6e\x74\x5f\x69\x64" => $parentId, "\164\x65\170\x74" => $text, "\x69\x63\x6f\x6e\x43\154\163" => "\x69\143\x6f\156\x73\55\x70\x6f\151\156\x74", "\x73\x74\x61\164\145" => "\x6f\x70\x65\x6e", "\x63\x68\x69\154\144\162\145\156" => [], "\142\162\145\141\144\x63\x72\x75\x6d\x62" => $breadcrumb]; goto L_uSk; tjl15: return null; goto gL09G; ZSVCw: C9heJ: goto Pcdw7; l50Yt: h7qti: goto pM046; gL09G: F83Zg: goto yIIA_; yIIA_: $breadcrumb = empty($breadcrumbParent) ? $text : $breadcrumbParent . "\x20\46\x67\164\73\40" . $text; goto bJO99; wh794: foreach ($childOrganizations as $childOrganization) { goto omxi9; UhapC: YK6DO: goto nQ1BC; WjYSv: KQmzI: goto UhapC; VQBuc: if (!$childNodeDatas) { goto KQmzI; } goto VYwKg; omxi9: $childNodeDatas = $this->loadTreeDataRecursively($childOrganization["\151\144"], $id, $breadcrumb); goto VQBuc; VYwKg: $treeNodeDatas["\x63\x68\x69\x6c\144\x72\x65\x6e"][] = $childNodeDatas; goto WjYSv; nQ1BC: } goto GfWz6; o8TEa: $text = Db::table("\157\162\147\x61\x6e\x69\172\141\164\151\157\156")->where(["\151\144" => $id])->value("\x6e\141\x6d\145"); goto TpsbX; YgbOs: return $treeNodeDatas; goto zInto; TpsbX: if (!($text === null)) { goto F83Zg; } goto tjl15; y9lhP: if ($id == 0) { goto h7qti; } goto o8TEa; pM046: $text = "\346\210\221\xe7\232\x84\347\xbb\x84\xe7\273\x87"; goto LT4wR; L_uSk: goto C9heJ; goto l50Yt; zelwA: $treeNodeDatas = ["\x69\x64" => 0, "\160\x61\x72\x65\156\164\137\151\144" => 0, "\164\145\x78\x74" => $text, "\151\143\157\156\103\x6c\x73" => "\146\x61\x20\146\141\55\143\151\162\143\x6c\x65", "\163\164\x61\164\x65" => "\157\x70\145\156", "\x63\x68\x69\154\144\162\145\156" => [], "\142\x72\x65\141\144\143\x72\165\x6d\x62" => $breadcrumb]; goto ZSVCw; Pcdw7: $childOrganizations = Db::table("\x6f\x72\x67\141\156\x69\x7a\x61\164\151\x6f\156")->where(["\160\141\x72\x65\x6e\164\x5f\151\144" => $id])->field("\151\144\x2c\156\x61\155\x65\x2c\160\x61\x72\145\x6e\164\x5f\x69\144")->order("\157\162\144\145\162\40\x61\163\143\x2c\x20\151\x64\40\x61\163\143")->select(); goto wh794; LT4wR: $breadcrumb = empty($breadcrumbParent) ? $text : $breadcrumbParent . "\x20\x26\x67\x74\x3b\x20" . $text; goto zelwA; GfWz6: GbXUu: goto YgbOs; zInto: } public function loadComboDatas($id = 0, $prefix = '', $datas = array()) { goto OgYJZ; o2SUL: $nextPrefix = ''; goto AYEK9; MzSy4: AqfyN: goto NrFvu; iXZ57: goto UuD0r; goto TFbvK; E2ApV: $text = Db::table("\157\x72\x67\x61\x6e\151\172\141\164\151\x6f\x6e")->where(["\151\144" => $id])->value("\156\141\x6d\x65"); goto mIHri; AYEK9: UuD0r: goto lGOfA; mB6HY: $prefix .= "\x3e"; goto MzSy4; TFbvK: p6LWb: goto fSP3q; lGOfA: $childOrganizations = Db::table("\x6f\162\x67\141\x6e\151\x7a\x61\x74\151\157\156")->where(["\160\141\162\145\156\x74\x5f\151\144" => $id])->field("\x69\144\54\x6e\141\155\145\x2c\160\x61\162\x65\x6e\x74\x5f\151\x64")->order("\157\x72\x64\x65\x72\x20\x61\x73\x63\x2c\x20\x69\x64\40\x61\x73\143")->select(); goto GhzHZ; GhzHZ: foreach ($childOrganizations as $childOrganization) { $datas = $this->loadComboDatas($childOrganization["\151\x64"], $nextPrefix, $datas); jw0Vx: } goto MFvUT; mIHri: if (!$prefix) { goto AqfyN; } goto mB6HY; MFvUT: AaQV3: goto ez99Z; ez99Z: return $datas; goto RV7O1; NrFvu: $datas[$id] = $prefix . $text; goto TkMxC; OgYJZ: if ($id == 0) { goto p6LWb; } goto E2ApV; fSP3q: $datas[$id] = "\55\xe8\xaf\xb7\351\x80\211\346\x8b\251\55"; goto o2SUL; TkMxC: $nextPrefix = $prefix . $text; goto iXZ57; RV7O1: } public function loadComboDatasLeaf($id = 0, $prefix = '', $datas = array()) { goto GZ0b6; MxWNj: $nextPrefix = ''; goto QXpa3; mO4DX: DdfFN: goto aMdkN; QXpa3: Jnq_4: goto gS5np; gS5np: $childOrganizations = Db::table("\x6f\162\147\141\x6e\x69\172\141\x74\x69\x6f\x6e")->where(["\160\141\162\145\x6e\x74\x5f\151\144" => $id])->field("\151\x64\54\x6e\x61\155\x65\54\x70\x61\162\x65\156\164\137\x69\x64")->order("\157\x72\x64\145\x72\40\141\163\143\x2c\x20\x69\144\x20\x61\x73\143")->select(); goto KJ8wy; aMdkN: return $datas; goto hdMyZ; GZ0b6: if ($id == 0) { goto tftJB; } goto SoRtl; lJW3o: tftJB: goto z7Kz1; la2o_: LVACq: goto JBPun; YJ76Q: $datas[$id] = $prefix . $text; goto mMJrp; z7Kz1: $datas[$id] = "\x2d\xe8\257\267\xe9\x80\x89\xe6\213\xa9\55"; goto MxWNj; XB9WC: goto Jnq_4; goto lJW3o; JBPun: $childCount = Db::table("\157\x72\147\x61\x6e\151\x7a\141\x74\x69\157\156")->where(["\x70\x61\162\x65\156\164\x5f\151\144" => $id])->count(); goto gbYy0; SoRtl: $text = Db::table("\x6f\162\147\141\x6e\151\x7a\141\164\151\x6f\156")->where(["\x69\x64" => $id])->value("\x6e\x61\155\145"); goto hQQJh; ull2O: $nextPrefix = $prefix . $text; goto XB9WC; V9Kbc: $prefix .= "\x3e"; goto la2o_; hQQJh: if (!$prefix) { goto LVACq; } goto V9Kbc; KJ8wy: foreach ($childOrganizations as $childOrganization) { $datas = $this->loadComboDatasLeaf($childOrganization["\x69\x64"], $nextPrefix, $datas); LLhqn: } goto mO4DX; mMJrp: n3TGb: goto ull2O; gbYy0: if (!($childCount == 0)) { goto n3TGb; } goto YJ76Q; hdMyZ: } public function loadFullText($id, $suffix = '') { goto EiVhn; aMAHq: rIjle: goto gdKcM; gdKcM: $organization = Db::table("\x6f\x72\x67\x61\156\x69\172\x61\164\x69\x6f\x6e")->where(["\151\144" => $id])->field("\156\141\155\145\x2c\40\160\x61\162\x65\156\164\x5f\151\x64")->find(); goto iA772; WPgDh: ftTvR: goto TNhEQ; w2pGw: QnJRj: goto PmvCX; iA772: if (!empty($organization)) { goto QnJRj; } goto Yg6kH; Yg6kH: return $suffix; goto w2pGw; rn81O: $fullText .= "\x20\46\147\164\73\x20" . $suffix; goto WPgDh; PmvCX: $fullText = $organization["\x6e\x61\x6d\x65"]; goto LCyxC; e_SdV: return $suffix; goto aMAHq; j15es: return $fullText; goto D6tyg; TNhEQ: $fullText = $this->loadFullText($organization["\x70\x61\162\x65\156\x74\137\x69\x64"], $fullText); goto j15es; LCyxC: if (!$suffix) { goto ftTvR; } goto rn81O; EiVhn: if (!($id == 0)) { goto rIjle; } goto e_SdV; D6tyg: } public function isEmpty() { $count = Db::table("\157\162\147\x61\156\x69\x7a\141\x74\151\157\156")->where(["\160\x61\162\x65\x6e\164\137\x69\144" => 0])->count(); return $count ? false : true; } public function add($name, $parentId) { goto okyHV; PqXeT: Db::table("\x6f\162\147\141\x6e\x69\x7a\141\x74\151\x6f\x6e")->where(["\x69\x64" => $id])->setField("\157\x72\x64\145\x72", $id); goto CL256; CL256: return true; goto UDV5R; okyHV: $data = array("\156\141\x6d\x65" => $name, "\160\x61\162\x65\156\164\x5f\x69\144" => $parentId); goto wmsZA; wmsZA: $id = Db::table("\157\162\x67\x61\156\151\x7a\141\164\151\157\156")->insertGetId($data); goto PqXeT; UDV5R: } public function update($id, $name) { goto mvRxA; nVUoX: return true; goto Pj0hL; sJPoz: Db::table("\x6f\162\147\x61\156\x69\172\x61\164\x69\157\156")->where("\151\x64", $id)->update($data); goto nVUoX; mvRxA: $data = array("\x6e\x61\x6d\x65" => $name); goto sJPoz; Pj0hL: } public function delete($id) { goto xpLvb; NC5JX: return $result != 1 ? false : true; goto cEdaW; xpLvb: Db::table("\x63\x75\163\164\157\x6d\x65\162")->where(["\157\x72\147\141\x6e\151\172\x61\164\x69\157\x6e\x5f\x69\x64" => $id])->setField("\157\x72\147\x61\156\151\x7a\141\164\151\157\156\x5f\x69\x64", 0); goto zH8Ko; zH8Ko: $result = Db::table("\157\x72\x67\x61\156\151\172\x61\x74\x69\157\156")->where("\x69\x64", $id)->delete(); goto NC5JX; cEdaW: } public function up($id) { goto mxn8U; LWGjS: if (!($i == 0)) { goto UUeET; } goto HHhpt; rFnEq: $orderPre = $siblingOrganizations[$i - 1]["\157\162\x64\145\x72"]; goto T9nD6; OZS4L: wJK7p: goto G7GwC; ghp2w: lgRkT: goto JG3gG; Th5Ik: Db::table("\157\162\147\141\x6e\x69\172\x61\x74\x69\157\x6e")->where(["\151\x64" => $siblingOrganizations[$i - 1]["\x69\x64"]])->setField("\157\162\144\x65\162", $order); goto LUrSc; JG3gG: if (!($siblingOrganizations[$i]["\151\144"] == $id)) { goto lgpqX; } goto LWGjS; G7GwC: if (!(count($siblingOrganizations) <= 1)) { goto ik6vk; } goto JSb1g; l2cSr: if (!empty($siblingOrganizations)) { goto wJK7p; } goto xdkWK; LUrSc: lgpqX: goto cFsRN; xswyv: n1RUR: goto nGf9b; hXN3F: $order = $siblingOrganizations[$i]["\x6f\x72\x64\145\x72"]; goto rFnEq; HHhpt: goto n1RUR; goto BcjJQ; JSb1g: return; goto z09H6; z09H6: ik6vk: goto nHZbO; nHZbO: $i = 0; goto ghp2w; DEzCB: $siblingOrganizations = Db::table("\x6f\x72\147\141\x6e\151\172\x61\x74\151\x6f\156")->where(["\160\141\162\145\x6e\164\137\151\144" => $parentId])->field("\151\144\54\x6e\141\x6d\145\54\160\x61\x72\x65\156\164\137\x69\x64\x2c\x6f\162\144\x65\162")->order("\x6f\162\144\145\x72\x20\x61\x73\x63\x2c\40\151\144\x20\141\163\143")->select(); goto l2cSr; BcjJQ: UUeET: goto hXN3F; T9nD6: Db::table("\x6f\x72\x67\x61\x6e\x69\x7a\x61\164\x69\157\156")->where(["\x69\144" => $id])->setField("\157\x72\144\x65\x72", $orderPre); goto Th5Ik; xdkWK: return; goto OZS4L; mxn8U: $parentId = Db::table("\157\x72\x67\141\x6e\x69\x7a\141\164\151\x6f\156")->where(["\151\144" => $id])->value("\x70\x61\162\x65\156\x74\137\x69\144"); goto DEzCB; n02bO: if ($i < count($siblingOrganizations)) { goto lgRkT; } goto xswyv; cFsRN: $i++; goto n02bO; nGf9b: } public function down($id) { goto jF4oi; UgaYP: $i = 0; goto FDWKK; TajOJ: Db::table("\x6f\162\147\x61\x6e\151\x7a\x61\164\x69\157\x6e")->where(["\151\x64" => $id])->setField("\x6f\x72\144\145\162", $orderNext); goto U7_7Z; MegJY: cJaaO: goto n_BPt; oygrB: $orderNext = $siblingOrganizations[$i + 1]["\x6f\x72\x64\x65\162"]; goto TajOJ; J0HTG: if (!($siblingOrganizations[$i]["\151\x64"] == $id)) { goto cJaaO; } goto QyGZo; n_BPt: $i++; goto zJekp; JQaW0: GpqPP: goto UgaYP; jxdjm: $siblingOrganizations = Db::table("\157\162\147\141\x6e\x69\x7a\x61\164\x69\x6f\x6e")->where(["\160\141\x72\x65\x6e\x74\x5f\x69\x64" => $parentId])->field("\x69\x64\54\x6e\x61\x6d\x65\54\160\141\162\145\156\164\137\x69\x64\x2c\x6f\162\x64\145\162")->order("\x6f\162\x64\x65\162\x20\x61\163\143\x2c\40\x69\x64\40\x61\x73\x63")->select(); goto ot1BO; nUsHC: $order = $siblingOrganizations[$i]["\157\x72\x64\145\162"]; goto oygrB; FYwFP: return; goto JQaW0; jTgvB: if (!(count($siblingOrganizations) <= 1)) { goto GpqPP; } goto FYwFP; jF4oi: $parentId = Db::table("\x6f\162\147\141\156\x69\x7a\x61\x74\151\x6f\156")->where(["\x69\x64" => $id])->value("\160\141\162\x65\x6e\164\x5f\151\x64"); goto jxdjm; jOHlo: goto ExAfV; goto PAMyG; c2LCP: ExAfV: goto JDW8t; zJekp: if ($i < count($siblingOrganizations)) { goto jPd6e; } goto c2LCP; ot1BO: if (!empty($siblingOrganizations)) { goto C5qZp; } goto DV9H2; FDWKK: jPd6e: goto J0HTG; QyGZo: if (!($i == count($siblingOrganizations) - 1)) { goto I0s7a; } goto jOHlo; DV9H2: return; goto wMVbg; U7_7Z: Db::table("\157\162\147\x61\x6e\151\172\141\x74\x69\157\x6e")->where(["\x69\x64" => $siblingOrganizations[$i + 1]["\x69\144"]])->setField("\157\162\x64\145\162", $order); goto MegJY; PAMyG: I0s7a: goto nUsHC; wMVbg: C5qZp: goto jTgvB; JDW8t: } public function changeLevel($id, $parentId) { Db::table("\157\162\x67\141\x6e\151\x7a\x61\x74\x69\x6f\156")->where("\151\x64", $id)->setField("\160\141\x72\x65\156\x74\x5f\x69\x64", $parentId); return true; } }
